/*******************************************************************************
    The Kingdoms of Chaos - An online browser text game - <http://www.tkoc.net>
    Copyright (C) 2011 - Administrators of The Kingdoms of Chaos

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

    Contact Information:
    Petros Karipidis  - petros@rufunka.com - <http://www.rufunka.com/>
    Anastasios Nistas - tasosos@gmail.com  - <http://tasos.pavta.com/>

    Other Information
    =================
    The exact Author of each source file should be specified after this license
    notice. If not specified then the "Current Administrators" found at
    <http://www.tkoc.net/about.php> are considered the Authors of the source
    file.

    As stated at the License Section 5.d: "If the work has interactive user
    interfaces, each must display Appropriate Legal Notices; however, if the
    Program has interactive interfaces that do not display Appropriate Legal
    Notices, your work need not make them do so.", we require you give
    credits at the appropriate section of your interface.
********************************************************************************/
Object.extend=function(C,B){for(var A in B){C[A]=B[A]}return C};var px={action:{},util:{},ui:{},io:{},Proto:null,Statics:null,Class:{__registry:{},define:function(E,D){var C;if(!D){D={}}if(D.construct){C=D.construct}else{C=function(){}}this.createNamespace(E,C);if(D.extend){var B=function(){};B.prototype=D.extend.prototype;var A=new B;C.prototype=A;C.base=C.superclass=D.extend;A.constructor=C}if(D.destruct){C.$$destructor=D.destruct}C.classname=C.prototype.classname=E;px.Statics=C;px.Proto=C.prototype;return C},createNamespace:function(B,G){var E=B.split(".");var D=window;var C=E[0];for(var F=0,A=E.length-1;F<A;F++,C=E[F]){if(!D[C]){D=D[C]={}}else{D=D[C]}}if(D[C]!=undefined){alert("An object of the name \""+name+'" aready exists')}D[C]=G;return C}}};px.Class.define("px.core.Object",{extend:Object,destruct:function(){}});Object.extend(px.Statics,{dispose:function(){for(var A in this){switch(typeof this[A]){case undefined:case"object":case"function":delete this[A];break}}}});Object.extend(px.Proto,{base:function(A){if(arguments.length===1){return A.callee.base.call(this)}else{return A.callee.base.apply(this,Array.prototype.slice.call(arguments,1))}},dispose:function(){if(this.__bDisposed){alert(this.classname+" already disposed");return }this.__bDisposed=true;pxp.log("Dispose "+this.classname);var A=this.constructor;while(A.superclass){if(A.$$destructor){A.$$destructor.call(this)}A=A.superclass}if(px.dev){px.dev.MemoryLeak.check(this)}},_disposeFields:function(){for(var B=0,A=arguments.length;B<A;B++){var C=arguments[B];if(this[C]==null){continue}if(!this.hasOwnProperty(C)){alert(this.classname+" has no own field "+name);continue}this[C]=null}},_disposeObjects:function(){for(var C=0,A=arguments.length;C<A;C++){var B=arguments[C];if(this[B]==null){continue}if(!this.hasOwnProperty(B)){alert(this.classname+" has no own field "+name);continue}this[B].dispose();this[B]=null}},_disposeContents:function(){for(var E=0,C=arguments.length;E<C;E++){var D=arguments[E];if(this[D]==null){continue}if(!this.hasOwnProperty(D)){alert(this.classname+" has no own field "+name);continue}if(this[D] instanceof Array){for(var F=0,A=this[D].length;F<A;F++){this[D][F].dispose();this[D][F]=null}}else{if(this[D] instanceof Object){for(var B in this[D]){this[D][B].dispose();this[D][B]=null}}}this[D]=null}}});var pxp={oTypes:null,oActions:null,oData:null,oDocs:null,_bInitialized:false,bStop:false,sShare:null,oParentNode:null,oMainBar:null,aClipboard:[],oClipboardSourceShare:null,sUser:null,bDebug:false,bDevelopment:false,sEncoding:"UTF-8",iNewFileCount:1,sUrl:"./action.php",oShareview:null,_oSplitview:null,bAltDown:false,bShiftDown:false,bDragging:false,sDragType:null,oSelectedControl:null,bIe:document.all&&navigator.userAgent.toLowerCase().indexOf("opera")==-1,bHold:false,init:function(B){if(this.bStop){return }this.oParentNode=B;this.oData=px.io.Request.get("sAction=openIndexData&sShare="+this.sShare);if(this.oData==false){alert("Could not open index data")}this.bDebug=this.oData.bDebug;this.bDevelopment=this.oData.bDevelopment;this.sUser=this.oData.sUser;this.initMainBar();this.resizeMain();this.oGlobalView=new px.ui.Actionview();this.oGlobalView.sClass="globalBar";this.oGlobalView.sIcon="globalview.png";this.oGlobalView.sDropDownIcon="dropDownDark.png";this.oGlobalView.addAction("home",oTranslation["action.pxGlobal_openHome"],px.action.pxGlobal_openHome,true,pxConst.sGraphicUrl+"/home.png");this.oGlobalView.addAction("doc",oTranslation["documentation"],px.action.pxFiles__openInline,false,pxConst.sGraphicUrl+"/help.png",{sPath:"./docType.php"});if(this.oData.bContact){this.oGlobalView.addAction("contact",oTranslation["contact"],px.action.pxFiles__openInline,false,pxConst.sGraphicUrl+"/mail.png",{sPath:"./action.php?sAction=openContact"})}if(this.bDevelopment&&this.oData.sUser=="root"){this.oGlobalView.addAction("development",oTranslation["development"],px.action.pxFiles__openInline,false,pxConst.sGraphicUrl+"/development.png",{sPath:"./../development.php"})}if(this.bDebug){this.oGlobalView.addAction("phpInfo",oTranslation["action.pxGlobal_openPhpInfo"],px.action.pxFiles__openInline,false,pxConst.sGraphicUrl+"/phpInfo.png",{sPath:"./action.php?sAction=openPhpInfo"})}this.oShareview=new px.ui.Actionview();this.oShareview.sClass="shareBar";this.oShareview.sIcon="shares.png";this.oShareview.sTitle=oTranslation["sShare"];this.oShareview.iMenuType=pxConst.MENU_BUTTON;this.oShareview.bHighlightLoaded=true;for(var C in this.oData.aBookmarks){var A=oTranslation["share."+C]||this.oData.aBookmarks[C]||C;this.oShareview.addAction(C,A,px.action.pxGlobal___openShareview,C==this.oData.sDefaultBookmark,pxConst.sGraphicUrl+"/pxShare.png")}this._oSplitview=new px.ui.Splitview(true,"0.24",true);this._oSplitview.sId="pxSplitGlobal";this._oSplitview.sSnapIcon="Dark";this._oSplitview.iSnapSize=320;this._oSplitview.oActionview=this.oGlobalView;this._oSplitview.aPersistentButtons=["doc"];this._oSplitview.oChild1=this.oGlobalView;this._oSplitview.oChild2=this.oShareview;this._oSplitview.init(this.oParentNode);if(pxp.sRelPathIn!="/"){var F=this.oShareview.oSelected.oActionviewFiles;F.addAction(pxp.sRelPathIn,pxp.sRelPathIn,px.action.pxGlobal___openEditorview,true,"types/pxObject",{sPath:pxp.sRelPathIn,sType:"pxObject",_sCalledAction:"pxObject_editProperties"});F.showAction(pxp.sRelPathIn);var E=this.getListview();E.oParameters.sPath=pxp.sRelDir;E.update()}var D=$("debugLog");if(D){D.setAttribute("wrap","off")}px.Event.addListener(window,"resize",px.lang.Function.bind(this.resize,this));px.Event.addListener(document,"mouseup",pxp._bodyMouseUp);px.Event.addListener(document,"keyup",pxp._bodyKeyUp);px.Event.addListener(document,"keydown",pxp._bodyKeyDown);px.ui.ContextMenu.init();this._bInitialized=true},dispose:function(){if(!this._bInitialized){return }this.oMainBar.dispose();this._oSplitview.dispose();delete this.oData;delete this.oTypes;delete this.oActions;delete this.oDocs;this.oParentNode=null;this.oMainBar=null;this.aClipboard=null;this.oShareview=null;this._oSplitview=null;this.oGlobalView=null},showLogin:function(){if(!this._oLogin){this._oLogin=document.createElement("div");this._oLogin.id="login";document.body.appendChild(this._oLogin);var B=document.createElement("label");B.appendChild(document.createTextNode(oTranslation["property.sUsername"]));this._oLogin.appendChild(B);var A=document.createElement("input");A.type="text";A.id=A.name="pxAuthUser";this._oLogin.appendChild(A);var B=document.createElement("label");B.appendChild(document.createTextNode(oTranslation["property.sPassword"]));this._oLogin.appendChild(B);oInputPassword=document.createElement("input");oInputPassword.type="password";oInputPassword.id=oInputPassword.name="pxAuthPassword";this._oLogin.appendChild(oInputPassword);this.oButtonLogin=document.createElement("button");this._oLogin.appendChild(this.oButtonLogin);this.oButtonLogin.appendChild(document.createTextNode(oTranslation["action.pxGlobal_openLogin"]));this.oButtonLogin=document.createElement("button");this._oLogin.appendChild(this.oButtonLogin);this.oButtonLogin.appendChild(document.createTextNode(oTranslation["guestAccess"]))}this.showOverlay(false);this._oLogin.style.display=""},log:function(B){if(this.bDebug){var A=$("debugLog");if(A){A.value=B+"\r\n"+A.value}}},setActiveControl:function(A){if(this.oSelectedControl&&A!=this.oSelectedControl&&this.oSelectedControl.clearSelection){this.oSelectedControl.clearSelection()}this.oSelectedControl=A},showError:function(C){if(oTranslation["error."+C.sId]){var B=oTranslation["error."+C.sId]}else{if(C.sId){var B=C.sId}else{var B=C}}if(C.aValues){for(var A=0;A<C.aValues.length;A++){B=B.replace("%s",C.aValues[A])}}else{B=B.replace(/%s/g,"")}B=B.replace(/<br\/>/g,"\r\n");if(this.bDebug){if(C.sFileIn){B+=" - "+C.sFileIn+" on line "+C.sLine}pxp.log(oTranslation["error"]+": "+B);px.action.pxGlobal_openInfo.run("debugPane")}else{alert(B)}},resizeMain:function(){px.util.setMaxHeight($("main"))},resize:function(B){this.resizeMain();this._oSplitview.resize(true);for(var A in this.oActions){if(px.action[A]&&px.action[A].resize){px.action[A].resize()}}},showOverlay:function(A){var B=$("overlay");if(this.bIe){if(!B.style.filter){B.style.filter=pxConst.ALPHA_IMAGE_START+pxConst.sGraphicUrl+"/overlay.png"+pxConst.ALPHA_IMAGE_SCALE_STOP}px.html.Element.hideElements("select");document.body.ondragstart=px.lang.Function.cancelEvent}B.style.display="block";if(A){$("loading").style.display="inline"}if(!B.onclick){B.onclick=px.lang.Function.bind(this.hideOverlay,this)}},hideOverlay:function(){if(px.action.pxFiles_openPreview.oActiveImage){px.action.pxFiles_openPreview.oActiveImage.onload=null}$("loading").style.display="none";$("overlay").style.display="none";$("lightbox").style.display="none";$("infoBox").style.display="none";if($("login")){$("login").style.display="none"}if(this.bIe){px.html.Element.showElements("select");document.body.ondragstart=null}},logout:function(){top.location.href="./action.php?sAction=openLogout";return false},startDrag:function(B){var A=px.lang.Function;this.sDragType=B;this.bDragging=true;document.body.onselectstart=A.cancelEvent;document.body.ondragstart=A.cancelEvent;if(document.body.addEventListener){document.body.addEventListener("draggesture",A.cancelEvent,false);px.html.Element.addClassName(document.body,"noSelect")}},stopDrag:function(){this.bDragging=false;document.body.onselectstart=null;document.body.ondragstart=null;if(document.body.removeEventListener){document.body.removeEventListener("draggesture",px.lang.Function.cancelEvent,false);px.html.Element.removeClassName(document.body,"noSelect")}},getExtendedType:function(A,C){var B=pxp.oTypes[A];if(C){return A+((C&&C!=A)?"_"+C:"")}if(B.aExtensions[0]&&B.sId!=B.aExtensions[0]&&!B.bAbstract){return A+"_"+B.aExtensions[0]}else{return A}},addValidExtension:function(G,D){var B=this.oTypes[D];if(B.aExtensions&&B.aExtensions.length){var A=false;for(var F=0;F<B.aExtensions.length;F++){var E=B.aExtensions[F];var C=G.lastIndexOf("."+E);if(C>-1&&C==(G.length-E.length-1)){A=true}}if(!A&&B.aExtensions[0]&&B.aExtensions[0]!=""){G+="."+B.aExtensions[0]}}return G},showDoc:function(B){this.oGlobalView.showAction("doc");var A=B.split("/");if(A[0]=="type"){this.oGlobalView.oActions["doc"].oIframe.src="./docType.php?sType="+A[1]}else{if(A[0]=="action"){}else{}}this._oSplitview.showFirst();return false},editDoc:function(F,D){var E=pxp.oData.sUserLanguage;switch(F){case"type":var C="./modules/"+pxp.oTypes[D].sModule+".pxm/documentation/"+E+"/types/"+D+".xml";break;case"action":break}var B="pxTextFiles_edit";var A=pxp.oShareview.oSelected.oActionviewFiles;if(!A.oActions[C]){A.addAction(C,C.indexOf("/")==0?C.substr(1):C,px.action.pxGlobal___openEditorview,true,"types/pxHtml",{sShare:"phpXplorer",sPath:C,sType:"pxHtml",_sCalledAction:B})}A.showAction(C)},refreshView:function(A){this.oShareview.oSelected.refreshView(A)},getListview:function(){return this.oShareview.oSelected.oActionviewList.oSelected.oChild},initMainBar:function(){this.oMainBar=new px.ui.toolbar.Toolbar(this,$("mainBar"));var B=this.oData.oProfile.sFullName;if(!B){B=this.oData["sUser"]}else{B=this.translateTitle(B)}var A=B;if(B!=this.sUser){A+=" ("+this.sUser+")"}this.oMainBar.addButton({sId:"title",sLabel:this.oData.sTitle,sIcon:"logoIcon.png",sClass:"pxTb pxTitle pxBarButton",oOnClick:pxp.openTitleLink,bDisabled:pxp.oData.sTitleLink==""});this.oMainBar.addButton({sId:"subTitle",bLabel:true,sLabel:this.oData.sSubTitle,bDisabled:true});this.oMainBar.addButton({sId:"login",sLabel:oTranslation["toolbar.logInOut"],sIcon:"keyGrey.png",oOnClick:pxp.logout,bRight:true});if(this.sUser!="everyone"){this.oMainBar.addButton({sId:"user",sIcon:"user.png",sLabel:A,oOnClick:px.action.pxGlobal_openHome._editProfile,bRight:true})}this.oMainBar.addButton({sId:"contact",sLabel:oTranslation["contact"],oOnClick:px.lang.Function.bind(pxp.showGlobalAction,this,"contact"),sIcon:"mail.png",bRight:true})},translateTitle:function(A){if(A&&A.indexOf("~")==0){return oTranslation[A.substr(1)]||A.substr(1)}else{return A}},openTitleLink:function(){window.open(pxp.oData.sTitleLink);return false},showGlobalAction:function(A){this._oSplitview.showFirst(null,true,A);return false},_bodyMouseUp:function(A){var A=A||window.event;document.onmousemove=null;px.ui.ContextMenu.hide();if(pxp.bDragging){if(pxp.oSelectedControl&&pxp.oSelectedControl.dragCleanup){pxp.oSelectedControl.dragCleanup(A)}pxp.stopDrag()}},_bodyKeyDown:function(A){var A=window.event||A;if(A.keyCode){switch(A.keyCode){case 16:pxp.bShiftDown=true;break;case 17:pxp.bAltDown=true;break}}},_bodyKeyUp:function(B){var B=window.event||B;if(B.keyCode){switch(B.keyCode){case 16:pxp.bShiftDown=false;break;case 17:pxp.bAltDown=false;break;case 27:var A=$("overlay");if(A&&A.style.display=="block"){pxp.hideOverlay()}px.ui.ContextMenu.hide();break;case 119:px.action.pxGlobal_openInfo.run();break;case 113:px.action.pxObject_editRename.run(pxp.oSelectedControl);break;case 72:if(pxp.bAltDown){alert(pxp.oShareview.oSelected.oChild)}break}}}};var pxConst={EMPTY:"",EMPTY_FUNCTION:function(){},DUMMY_LINK:"#",ALPHA_IMAGE_START:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\"",ALPHA_IMAGE_STOP:'")',ALPHA_IMAGE_SCALE_STOP:'", sizingMethod="scale")',MENU_TABS:0,MENU_BUTTON:1,TOOLBAR_HORIZONTAL:0,TOOLBAR_VERTICAL:1,TOOLBAR_BUTTON_LINK:0,TOOLBAR_BUTTON_INPUT:1};px.util={trim:function(A){return A.replace(/^\s+/,"").replace(/\s+$/,"")},tagFirstChar:function(A,B){return"<"+B+">"+A.substr(0,1)+"</"+B+">"+A.substr(1)},dirname:function(B){var A=String(B).lastIndexOf("/");var B=B.substr(0,A);if(B==""){return"/"}return B},basename:function(B){var A=String(B).lastIndexOf("/");if(A!=-1){return B.substr(A+1)}else{return B}},buildPath:function(){var B="";for(var A=0;A<arguments.length;A++){if(B.lastIndexOf("/")==B.length-1){if(arguments[A].substr(0,1)=="/"&&arguments[A]!="/"&&A!=0){B+=arguments[A].substr(1)}else{B+=arguments[A]}}else{if(arguments[A].substr(0,1)=="/"){B+=arguments[A]}else{B+="/"+arguments[A]}}}return B},getRandomId:function(){return"px"+String(Math.random()).substr(2)},addLeadingZero:function(A){var B=String(A);if(B.length==1){B="0"+B}return B},parseDateTime:function(G){var M=G.split(" ");var L=[];var K=[];for(var A=0;A<M.length;A++){var J=px.util.trim(M[A]);if(J!=""){if(L.length==0){var L=J.split("-");continue}var K=J.split(":");break}}var I=Number(L[0]);var H=Number(L[1]);H--;var F=Number(L[2]);var E=Number(K[0]);if(isNaN(E)){E=0}var D=Number(K[1]);if(isNaN(D)){D=0}var C=Number(K[2]);if(isNaN(C)){C=0}var B=new Date(I,H,F,E,D,C);return B.getTime()/1000},sleep:function(C){var B=new Date();var A=B.getTime()+C;while(true){dNow=new Date();if(dNow.getTime()>A){return }}},checkFilename:function(A,D){var B=[String.fromCharCode(92),":","*","?","<",">","|",".."];if(!D){B.push("/")}else{B.push("//")}for(var C=B.length-1;C>=0;C--){if(A.indexOf(B[C])>-1){return false}}if(D){if(px.util.trim(A.replace(/\//g,""))==""){return false}}return true},getNewFilename:function(C,B,D){var A=C||"";while(A!=null){A=prompt(oTranslation["newName"],A);if(A!=null){if(px.util.checkFilename(A,D)){A=pxp.addValidExtension(A,B);if(px.util.trim(A)!=""){break}}alert(oTranslation["error.invalidFilename"])}}return A},previewCheck:function(B,A){if(A&&px.lang.Array.contains(A,B)){return true}return px.lang.Array.contains((pxp.oShareview.oSelected.oShare.iImageLibrary==1?pxp.oData.aImageMagickExtensions:pxp.oData.aGdExtensions),B)},getLength:function(C){if(C instanceof Array){return C.length}else{var A=0;for(var B in C){A++}return A}},getLastProperty:function(B){var A;for(var C in B){A=C}return A},getFirstProperty:function(A){for(var B in A){return B}},setMaxHeight:function(A){if(A){A.style.height=A.parentNode.offsetHeight-A.offsetTop+"px"}}};px.Class.define("px.util.Format");Object.extend(px.Statics,{number:function(C){var B=String(C);var A=new RegExp("(-?[0-9]+)([0-9]{3})");while(A.test(B)){B=B.replace(A,"$1.$2")}return B},datetime:function(C){var D=new Date();D.setTime(C*1000);var B=D.getFullYear()+"-";var A=px.util.addLeadingZero;B+=A(D.getMonth()+1)+"-";B+=A(D.getDate())+" ";B+=A(D.getHours())+":";B+=A(D.getMinutes())+":";B+=A(D.getSeconds());return B}});px.Class.define("px.io.RemoteView",{extend:px.core.Object,construct:function(B,A){this.oParent=B;this.oParentNode=A;this.oActiveItem;this.bControl=true;this.oResults={};this.oSettings={};this.oParameters=new px.io.RequestParameters();this.iObjectsPerPage=50;this._sOrderBy="sName";this._sOrderDirection="asc";this._bBuild=false},destruct:function(){this._disposeFields("oParent","oParentNode","oParameters","oActiveItem")}});Object.extend(px.Statics,{dragCleanup:function(){var A=$("dragable");if(A){while(A.firstChild){A.removeChild(A.firstChild)}document.body.removeChild(A)}},sortActions:function(B,A){if(B.sBaseAction==A.sBaseAction){return(B.sTitle>A.sTitle)?1:-1}else{return(B.sBaseAction<A.sBaseAction)?1:-1}}});Object.extend(px.Proto,{_clientSort:function(B){var A=this.oParameters.getPath();var D=B.substr(B.indexOf("_")+1);var C=this.oResults[A].sort;if(C){this.oResults[A].sort(this.getSortFunction(D))}if(D==this._sOrderBy){if(this._sOrderDirection=="asc"){this._sOrderDirection="desc";if(C){this.oResults[A].reverse()}}else{this._sOrderDirection="asc"}}else{this._sOrderDirection="asc"}this._sOrderBy=D;this._fill(0)},getSortFunction:function(A){return function(C,B){if(C.bDirectory==B.bDirectory){if(C[A]==B[A]){return 0}else{return C[A]<B[A]?-1:1}}else{return C.bDirectory?-1:1}}},update:function(A){if(!this._bBuild&&this.build){this.build();this._bBuild=true}if(A){this.oParameters.set(A)}if(!this.oParameters._bReload){this.oParameters.iOffset=0}new px.io.Request({sParameters:this.oParameters.getUrl(),onComplete:px.lang.Function.bind(this._updateCallback,this)})},_updateCallback:function(_90){try{var _91=eval("("+_90.responseText+")")}catch(e){pxp.showError(_90.responseText);return }if(_91.bError){pxp.showError(_91);return }var _92=_91.sDirectory;var _93=this.oParameters;if(_93._bReload){if(px.util.getLength(_91.mResult)==0){delete this._bReloading;delete this._bPopulating;delete _93._bReload;return false}this.oResults[_92]=this.oResults[_92].concat(_91.mResult);Object.extend(this.oSettings[_92].aAllowedActions,_91.oSettings.aAllowedActions);Object.extend(this.oSettings[_92].oOptions,_91.oSettings.oOptions)}else{this.oResults[_92]=_91.mResult;this.oSettings[_92]=_91.oSettings}_93.sSearchQuery=_91.sSearchQuery;if(this.oResults[_92].length>1&&this.oResults[_92].sort){this.oResults[_92].sort(this.getSortFunction(this._sOrderBy));if(this._sOrderDirection=="desc"){this.oResults[_92].reverse()}}window.setTimeout(px.lang.Function.bind(this._update,this,_92),10);if(!_93._bReload&&this.oParent.updateInterface){this.oParent.updateInterface()}if(_91.iPhpRuntime){}},_save:function(A,D){if(this.oForm){px.html.Form.disable(this.oForm)}if(A){this.oParameters.set(A)}var C="sShare="+encodeURIComponent(this.oParameters.sShare)+"&sAction="+this.oParameters.sAction+"&sPath="+encodeURIComponent(this.oParameters.getPath(false));if(this.oParameters.sType){C+="&sType="+encodeURIComponent(this.oParameters.sType)}if(D){C+="&"+D}else{C+="&"+px.html.Form.serialize(this.oForm)}var B=px.io.Request.post(C);if(B.bOk){delete this.oParent.oParent.oDefaultParameters._bNew}if(this.oForm){px.html.Form.enable(this.oForm)}return B},resize:function(){},showContextMenu:function(C,B,H,G){var F=px.lang.Array;var A=px.ui.ContextMenu;A.clear();var E=pxp.oTypes[H];var D=[];for(var L=0;L<E.aActions.length;L++){var K=E.aActions[L];var J=pxp.oActions[K][2];if(!F.contains(G,K)||J=="create"||K.substr(K.indexOf("_")+1,1)=="_"||(E.bDirectory&&(J=="open"||J=="batch"||J=="select"))||(K=="pxFiles_openPreview"&&!px.util.previewCheck(C.getExtension()))){continue}D.push({sId:K,sTitle:oTranslation["action."+K],sBaseAction:J,sModule:pxp.oActions[K][0]})}if(C.bDirectory){A.addItem("__open",oTranslation["open"],pxConst.sModuleUrl+"/System.pxm/graphics/types/pxDirectories.png");A.addDivider()}D.sort(px.io.RemoteView.sortActions);if(D.length>0){var I=D[0].sBaseAction;for(var L=0;L<D.length;L++){if(I!=D[L].sBaseAction){I=D[L].sBaseAction;A.addDivider()}A.addItem(D[L].sId,D[L].sTitle,pxConst.sModuleUrl+"/"+D[L].sModule+".pxm/graphics/actions/"+D[L].sId+".png")}A.addDivider()}A.addItem("__docLink",oTranslation["documentation"],pxConst.sModuleUrl+"/System.pxm/graphics/actions/pxGlobal___openDoc.png");delete D;A.show(B,20)},callAction:function(J,I){var G=px.lang.Array;if(!J){var E=this.oActiveItem.getType();var C=pxp.oTypes[E];for(var A=0;A<C.aDefaultActions.length;A++){var L=C.aDefaultActions[A];if(pxp.oActions[L][2]=="edit"){var J=L;break}}if(!J){var K=this.oSettings[this.oParameters.getPath()].aAllowedActions[E];if(G.contains(K,"pxObject_editProperties")){var J="pxObject_editProperties"}else{var J=C.aDefaultActions[0]}}}if(J=="__docLink"){pxp.showDoc("type/"+this.oActiveItem.getType());return }if(J=="__open"){this.oActiveItem.fileClick(I);return }if(px.action[J]&&px.action[J].run){px.action[J].run(this);return }if(!px.action[J]){alert("Action \""+J+'" does not exist');return }var E=J.substr(0,J.indexOf("_"));if(pxp.oTypes[E].aSupertypes instanceof Array){var H=pxp.oTypes[E].aSupertypes.concat(Array(E))}else{var H=Array(E)}for(var F in this.oSelected){var E=this.oSelected[F].getType();var D=F;var B=pxp.oShareview.oSelected.oActionviewFiles;if(!B.oActions[D]){B.addAction(D,D.indexOf("/")==0?D.substr(1):D,px.action.pxGlobal___openEditorview,true,"types/"+E,{sPath:D,sType:E,_sCalledAction:J})}B.showAction(D)}return false},dirUp:function(A){this.oParameters.sPath=px.util.dirname(this.oParameters.sPath);this.oParameters.sSearchQuery=null;this.update(0);if(this.onDirChange){this.onDirChange()}return false},setAllowSelection:function(A){if(A){px.html.Element.removeClassName(this.oParentNode,"noSelect")}else{px.html.Element.addClassName(this.oParentNode,"noSelect")}},_reloadCheck:function(F,E,D){if(this._bPopulating&&!D){return -1}this._bPopulating=true;if(E==null){E=this._iOffset}var C=this.oResults[F];if(!C){return -1}if(C.length>=this.iVisibleItems){var B=C.length;if(this._iX){var A=Math.round(B/this._iX+0.4555555);B=A*this._iX}if(E+this.iVisibleItems>B){E=B-this.iVisibleItems+(this._iX||1)}}else{E=0}delete this._bReloading;delete this.oParameters._bReload;if(this.iObjectsPerPage&&C.length>0&&C.length%this.iObjectsPerPage==0){if(C.length<this.iVisibleItems||E+this.iVisibleItems>C.length-5){this._bReloading=true;this.update({iOffset:C.length,_bReload:true})}}if(E==0){if(C.length>this.iVisibleItems){this._oScrollBar.scrollTop=0}}return E}});px.Class.define("px.io.RequestParameters",{extend:px.core.Object,construct:function(){this.sShare;this.sAction="_openJson";this.sPath="/";this.aNames=[];this.aTypes=[];this.bFull;this.sOrderBy="sName";this.sOrderDirection="asc";this.sSearchQuery;this.bOnlyDirectories;this.bFillOptions;this.bOsPermissions;this.bFilesize;this.bHierarchical;this.bRecursive;this.bRecursiveFlat;this.iOffset=0;this.bFile}});Object.extend(px.Proto,{set:function(A){if(A){for(var B in A){this[B]=A[B]}}},sync:function(A){this.sPath=A.sPath;this.sSearchQuery=A.sSearchQuery;this.sOrderBy=A.sOrderBy;this.sOrderDirection=A.sOrderDirection},getUrl:function(){var B=[];for(var D in this){if(D.indexOf("_")==0||D=="classname"){continue}switch(typeof this[D]){case"object":if(this[D]&&this[D].length){var A=[];for(var C=0;C<this[D].length;C++){A.push(encodeURIComponent(this[D][C]))}B.push(D+"="+A.join("|"))}break;default:if(this[D] instanceof Function){continue}if(this[D]!=null&&this[D]!=undefined){B.push(D+"="+encodeURIComponent(this[D]))}break}}return B.join("&")},getPath:function(B){var A="";if(B!=false){A+=this.sShare+":"}A=px.util.buildPath(A,this.sPath);if(this.aNames.length>0){A=px.util.buildPath(A,this.aNames[0])}return A}});px.Class.define("px.io.Request",{extend:px.core.Object,construct:function(A){this.oTransport=this.getTransport();this.oOptions={sUrl:pxp.sUrl,sMethod:"get",bAsync:true,sContentType:"application/x-www-form-urlencoded",sParameters:""};Object.extend(this.oOptions,A||{});this.request()},destruct:function(){}});Object.extend(px.Statics,{aEvents:["Uninitialized","Loading","Loaded","Interactive","Complete"],get:function(D,C,B,A){return this._request("get",D,C,B,A)},post:function(D,C,B,A){return this._request("post",D,C,B,A)},exists:function(B,A){return this.get("sShare="+encodeURIComponent(B)+"&sAction=_editExists&sPath="+encodeURIComponent(A),true,null,false)},_request:function(_cc,_cd,_ce,_cf,_d0){var _d1=new px.io.Request({bAsync:false,sMethod:_cc,sParameters:_cd});if(_d0&&!_d1.success()){pxp.log("XmlHttpRequest failed ("+_d1.oTransport.status+")");return false}var _d2=_d1.oTransport.responseText;if(_ce!=false){if(_d2!=""){try{var _d3=eval("("+_d2+")")}catch(e){pxp.showError(_d2);return false}if(_d3.bError&&_d0!=false){pxp.showError(_d3);return false}else{return _d3}}else{var _d3={bOk:true}}return _d3}else{return _d2}}});Object.extend(px.Proto,{getTransport:function(){if(typeof XMLHttpRequest!="undefined"){return new XMLHttpRequest()}else{try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(A){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(A){}}}},_complete:false,request:function(){var C=this.oOptions;this.sUrl=C.sUrl;this.sMethod=C.sMethod;var B=C.sParameters;if(B!=""){if(this.sMethod=="get"){this.sUrl+=(this.sUrl.indexOf("?")>-1?"&":"?")+B}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){B+="&_="}}}try{this.oTransport.open(this.sMethod.toUpperCase(),this.sUrl,C.bAsync);this.oTransport.onreadystatechange=px.lang.Function.bind(this.onStateChange,this);this.setRequestHeaders();this.body=this.sMethod=="post"?(C.postBody||B):null;this.oTransport.send(this.body);if(!C.bAsync&&this.oTransport.overrideMimeType){this.onStateChange()}}catch(A){pxp.showError("Could not send XmlHttp request")}},onStateChange:function(){var A=this.oTransport.readyState;if(A>1&&!((A==4)&&this._complete)){this.respondToReadyState(A)}},setRequestHeaders:function(){var B={"X-Requested-With":"XMLHttpRequest","Accept":"text/javascript, text/html, application/xml, text/xml, */*"};if(this.sMethod=="post"){B["Content-type"]=this.oOptions.sContentType+"; charset="+pxp.sEncoding}if(this.oTransport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){B["Connection"]="close"}for(var A in B){this.oTransport.setRequestHeader(A,B[A])}},success:function(){return !this.oTransport.status||(this.oTransport.status>=200&&this.oTransport.status<300)},respondToReadyState:function(A){var C=px.io.Request.aEvents[A];if(C=="Complete"){try{(this.oOptions["on"+this.oTransport.status]||this.oOptions["on"+(this.success()?"Success":"Failure")]||pxConst.EMPTY_FUNCTION)(this.oTransport);this._complete=true}catch(B){}try{(this.oOptions["on"+C]||pxConst.EMPTY_FUNCTION)(this.oTransport)}catch(B){}if(C=="Complete"){this.oTransport.onreadystatechange=pxConst.EMPTY_FUNCTION}}}});px.Class.define("px.ui.ContextMenu");Object.extend(px.Statics,{oMenu:null,bActive:false,bOverMode:false,init:function(){this.oMenuShadow=document.createElement("div");this.oMenuShadow.id="contextMenu";this.oMenuShadow.className="pxCMShadow";document.body.appendChild(this.oMenuShadow);this.oMenu=document.createElement("div");this.oMenu.className="pxCM";this.oMenuShadow.appendChild(this.oMenu);this.hide()},dispose:function(){if(this.oMenuShadow){this.clear();px.core.Object.dispose.call(this)}},clear:function(){while(this.oMenu.firstChild){if(this.oMenu.firstChild.onclick){this.oMenu.firstChild.onclick=null}this.oMenu.removeChild(this.oMenu.firstChild)}},addItem:function(C,G,F,E,B,D){var A=document.createElement("a");A.id="pxCM_"+C;this.oMenu.appendChild(A);if(!E){A.href=pxConst.DUMMY_LINK;A.onclick=px.lang.Function.bindEvent(this._onItemClick,this)}if(D){A.title=D}if(B){A.className=B}if(F!=""){px.html.Element.appendImage(A,F)}if(G!=""){A.appendChild(document.createTextNode(G))}return A},addDivider:function(){var A=document.createElement("div");A.className="pxCMDivider";this.oMenu.appendChild(A)},show:function(B,A){var H=A?true:false;var A=A||0;var F=px.Event.element(B);if(F.nodeName.toLowerCase()=="img"){F=F.parentNode}var E=px.html.Element.getTopOffset(F)+F.offsetHeight-1;var D=px.html.Element.getLeftOffset(F)-1;this.oMenuShadow.style.visibility="hidden";this.oMenuShadow.style.display="block";if(H){var D=B.clientX;var E=B.clientY}var C=document.all?document.body.offsetWidth:window.innerWidth;var G=document.all?document.body.offsetHeight:window.innerHeight;if(B.clientX+this.oMenuShadow.offsetWidth>C){D=D-(B.clientX+this.oMenuShadow.offsetWidth-C)-24}if(B.clientY+this.oMenuShadow.offsetHeight>G){E=E-(B.clientY+this.oMenuShadow.offsetHeight-G)-1}this.oMenuShadow.style.left=D+A+1+"px";this.oMenuShadow.style.top=E+1+"px";this.oMenuShadow.style.visibility=""},hide:function(){if(this.oMenu){this.oMenuShadow.style.display="none"}},_onItemClick:function(E){var D=px.Event.element(E);if(D.nodeName.toLowerCase()=="img"){D=D.parentNode}var A=D.id;var C=A.substr(A.indexOf("_")+1);var B=pxp.oSelectedControl;if(B.callActionSub){B.callActionSub(C,E)}else{B.callAction(C,E)}return false}});px.Class.define("px.ui.Actionview",{extend:px.core.Object,construct:function(A){this.oParent=A;this.sClass;this.sIcon;this.sDropDownIcon;this.oActions={};this.oToolbars={};this.oActionData={};this.oDefaultParameters;this.bTitleOnly=false;this.bHighlightLoaded=false;this._oToolbarNode;this.sDefault;this.oSelected;this.oPrevious;this.oLabel;this.oTabview;this.oToolbar;this.oActionSelect;this.aAllowedActions;this.bSyncParameter=false;this.bInitialized=false;this.bToolbarFirst=false;this.iMenuType=pxConst.MENU_BUTTON;this.iToolbarType=pxConst.TOOLBAR_HORIZONTAL;this.sLabelDrop;this.iIconSize=16},destruct:function(){switch(this.iMenuType){case pxConst.MENU_TABS:this.oTabview.dispose();break;case pxConst.MENU_BUTTON:this.oLabel.onclick=null;if(this.sLabelDrop){this.oLabel.onmouseover=null;this.oLabel.onmouseout=null;this.oLabel.onmouseup=null}break}this._disposeFields("oParent","oParentNode","oDefaultParameters","_oToolbarNode","sDefault","oSelected","oLabel","oPrevious","oTabview","oActionSelect","aAllowedActions");this._disposeContents("oActions","oToolbars","oActionData")}});Object.extend(px.Proto,{addAction:function(A,K,J,H,F,E){if(F){var D=F.indexOf("/");if(D>-1){var C=F.substr(0,D);var B=F.substr(D+1);var I=pxConst.sModuleUrl+"/";switch(C){case"types":var G=I+pxp.oTypes[B].sModule+".pxm/graphics/types/"+B+".png";break;case"actions":var G=I+pxp.oActions[B][0]+".pxm/graphics/actions/"+B+".png";break}}if(!G){var G=F}}this.oActionData[A]={oAction:J,oParameters:E,sTitle:K,sIcon:G,dispose:function(){this.oAction=null;this.oParameters=null}};if(H){this.sDefault=A}if(this.bInitialized){switch(this.iMenuType){case pxConst.MENU_TABS:if(this.oTabview.iTabCount>0){this.oTabview.oInsertBefore=this.oTabview.oParentNode.firstChild}else{delete this.oTabview.oInsertBefore}this.oTabview.addTab(A,K,true);break;case pxConst.MENU_BUTTON:this._setIconState();break}}},changeAction:function(A){this.showAction(A,this.oDefaultParameters);return false},showAction:function(A,D){var C=this.oActions;var B=this.oActionData;if(!B[A]){alert("There is no action \""+A+"\"");return false}if(this.oSelected){if(this.oSelected.sId==A){return true}if(this.oSelected.oDiv){this.oSelected.oDiv.style.display="none";this.oToolbars[this.oSelected.sId].oDiv.style.display="none"}}if(!C[A]){this.oToolbars[A]=new px.ui.toolbar.Toolbar(this,this._oToolbarNode);this.oToolbars[A].iIconSize=this.iIconSize;C[A]=new B[A].oAction(A,this,this.oParentNode,B[A].oParameters||this.oDefaultParameters);C[A].sIcon=B[A].sIcon;this.oSelected=C[A];C[A].bInitialized=true}else{this.oSelected=C[A];if(this.bSyncParameter){if(D){C[A].oChild.oParameters.set(D)}else{if(this.oPrevious&&C[A].oChild){C[A].oChild.oParameters.sync(this.oPrevious.oChild.oParameters)}}C[A].oChild.update()}if(D&&D._sCalledAction&&C[A].oChild&&C[A].oChild.changeAction){C[A].oChild.changeAction(D._sCalledAction)}C[A].oDiv.style.display="block";this.oToolbars[A].oDiv.style.display="block";this.resize(true)}this.updateMenu();this.oPrevious=C[A];px.html.Element.removeClassName(this._oToolbarNode,"pxBarDisabled");return false},resize:function(A){if(this.oSelected&&this.oSelected.bInitialized){this.oSelected.resize(A)}},init:function(E,D){var C=px.lang.Function;var B=px.html.Element;this.oParentNode=E;if(D){this.oDefaultParameters=D}this._oToolbarNode=document.createElement("div");this._oToolbarNode.className="pxBar "+(this.iToolbarType==pxConst.TOOLBAR_HORIZONTAL?"pxTbHorizontal":"pxTbVertical")+(this.sClass?" "+this.sClass+"Menu":"")+(px.util.getLength(this.oActionData)==0?" pxBarDisabled":"");this.oParentNode.appendChild(this._oToolbarNode);switch(this.iMenuType){case pxConst.MENU_TABS:this.oTabview=new px.ui.tabview.Tabview(this,this._oToolbarNode);for(var A in this.oActionData){this.oTabview.addTab(A,this.oActionData[A].sTitle,A==this.sDefault)}this.oTabview.onTabClick=px.lang.Function.bind(this.changeAction,this);break;case pxConst.MENU_BUTTON:this.oLabel=document.createElement("a");B.addClassName(this.oLabel,"pxTb");B.addClassName(this.oLabel,"pxBarButton");this.oLabel.href=pxConst.DUMMY_LINK;this._oToolbarNode.appendChild(this.oLabel);if(this.sIcon){var F=B.appendImage(this.oLabel,pxConst.sGraphicUrl+"/"+this.sIcon,null,this.iIconSize);B.addClassName(F,"icon")}else{var F=B.appendImage(this.oLabel,pxConst.sGraphicUrl+"/dummy16.png",null,this.iIconSize)}this.oLabel.appendChild(document.createTextNode(this.sTitle||""));this.oLabel.title="";this.oLabel.onclick=C.bindEvent(this.showContextMenu,this);if(this.sLabelDrop){this.oLabel.onmouseover=C.bindEvent(this._labelMouseOver,this);this.oLabel.onmouseout=C.bindEvent(this._labelMouseOut,this);this.oLabel.onmouseup=C.bindEvent(this._labelMouseUp,this)}this._setIconState();break}if(!this.sDefault){for(var A in this.oActionData){this.sDefault=A;break}}if(this.sDefault){this.showAction(this.sDefault,this.oDefaultParameters)}this.bInitialized=true},showContextMenu:function(E){var B=px.lang.Array;if(px.util.getLength(this.oActionData)>1){pxp.setActiveControl(this);var D=px.ui.ContextMenu;D.clear();for(var A in this.oActionData){if(this.aAllowedActions){if(!B.contains(this.aAllowedActions,A)){continue}}var F=this.oActionData[A].sIcon;var C;if(this.bHighlightLoaded){if(this.oActions[A]==this.oSelected){var C="pxCMSelected"}else{if(this.oActions[A]){var C="pxCMLoaded"}else{var C=null}}if(C){F=F.replace(".png","Loaded.png")}}D.addItem(A,this.oActionData[A].sTitle,F,false,C)}if(this.addAdditionalMenuItems instanceof Function){this.addAdditionalMenuItems()}D.show(E)}return false},callAction:function(A){this.changeAction(A)},saveNew:function(J){if(this.oDefaultParameters._bNew){var I=this.oDefaultParameters.sPath;var H=J.oChild.oForm;if(H&&H.px_sRelDir){var G=H.px_sRelDir;var F=G.options[G.selectedIndex].value}else{var F=px.util.dirname(I)}var E=this.oDefaultParameters.sType;var D=px.util.getNewFilename(px.util.basename(I),E);if(D!=null){var C=px.util.buildPath(F,D);var B=pxp.getListview();var A=px.io.Request.exists(B.oParameters.sShare,C);if(A.bOk){if(A.bDirectory){alert(oTranslation["error.objectExists"]);return false}else{if(!confirm(oTranslation["allowOverwrite"])){return false}}}if(I!=C){this.oParent.oParent.renameAction(I,C,C)}}else{return false}}return true},renameAction:function(E,D,C){if(!this.oActions[E]){return false}if(this.oActions[D]){alert("Action \""+D+'" already exists');return false}this.oToolbars[D]=this.oToolbars[E];var B=this.oActions[D]=this.oActions[E];var A=this.oActionData[D]=this.oActionData[E];B.sId=D;A.sTitle=(A.sTitle.indexOf("*")===0?"*":"")+C;B.rename();delete this.oActions[E];this.updateMenu()},removeAction:function(){if(!this.bInitialized){return false}if(this.oSelected.bChanged){if(!confirm(oTranslation["discardChanges"])){this.oSelected.showChanged();return false}}var C=this.oSelected.sId;var A;A=this.oToolbars[C].oDiv;this.oToolbars[C].dispose();this._oToolbarNode.removeChild(A);A=this.oActions[C].oDiv;this.oActions[C].dispose();this.oActionData[C].dispose();this.oParentNode.removeChild(A);delete this.oSelected;delete this.oActions[C];delete this.oActionData[C];delete this.oToolbars[C];switch(this.iMenuType){case pxConst.MENU_TABS:this.oTabview.removeTab(C);if(this.oTabview.iTabCount>0){this.oTabview.setSelected(this.oTabview.oTabs[px.util.getLastProperty(this.oTabview.oTabs)].sId)}break;case pxConst.MENU_BUTTON:if(px.util.getLength(this.oActions)>0){this.changeAction(px.util.getLastProperty(this.oActions))}else{var B=(this.sTitle?this.sTitle+": ":"");this.oLabel.title=B;this.oLabel.childNodes[1].nodeValue=this.bTitleOnly?this.sTitle:B}this._setIconState();break}if(px.util.getLength(this.oActionData)==0){px.html.Element.addClassName(this._oToolbarNode,"pxBarDisabled")}return false},updateMenu:function(){var C=px.html.Element;var A=this.oSelected.sId;switch(this.iMenuType){case pxConst.MENU_TABS:this.oTabview.setSelected(A);break;case pxConst.MENU_BUTTON:var B=(this.sTitle?this.sTitle+": ":"")+this.oActionData[A].sTitle;this.oLabel.title=B;this.oLabel.childNodes[1].nodeValue=this.bTitleOnly?this.sTitle:B;break}},addActions:function(F,E){var D=px.lang.Array;var B=E.sType;if(pxp.oTypes[B].aSupertypes instanceof Array){var A=pxp.oTypes[B].aSupertypes.concat(Array(B))}else{var A=Array(B)}var J;for(var H=0;H<pxp.oTypes[B].aDefaultActions.length;H++){var G=pxp.oTypes[B].aDefaultActions[H];if(D.contains(F,pxp.oActions[G][2])){var J=G}}var J=E._sCalledAction||J;for(var I in pxp.oActions){if(I.indexOf("__")>-1&&I!=J){continue}var C=I.substr(0,I.indexOf("_"));if(D.contains(F,pxp.oActions[I][2])&&D.contains(A,C)){if(px.action[I]&&!px.action[I].run){this.addAction(I,oTranslation["action."+I],px.action[I],I==J,"actions/"+I)}}}},_labelMouseOver:function(A){if(pxp.bDragging&&pxp.sDragType==this.sLabelDrop){px.html.Element.addClassName(this.oLabel,"drop")}},_labelMouseOut:function(A){px.html.Element.removeClassName(this.oLabel,"drop")},_labelMouseUp:function(A){if(px.html.Element.hasClassName(this.oLabel,"drop")){pxp.oSelectedControl.callAction(null,A)}},_setIconState:function(A){if(px.util.getLength(this.oActionData)>1){if(!this.oLabel.childNodes[2]){px.html.Element.appendImage(this.oLabel,pxConst.sGraphicUrl+"/"+(this.sDropDownIcon||"dropDown.png"))}}else{if(this.oLabel.childNodes[2]){this.oLabel.removeChild(this.oLabel.childNodes[2])}}}});px.Class.define("px.ui.ListItem",{extend:px.core.Object,type:"abstract"});Object.extend(px.Proto,{getFilename:function(){return px.util.basename(this.sFilename)},getDirname:function(){return px.util.dirname(this.sFilename)},getPath:function(){if(this.oParent.oParameters.sSearchQuery||this.oParent.oParameters.bRecursiveFlat){return this.oParent.oParameters.getPath()}else{return px.util.buildPath(this.oParent.oParameters.sShare+":",this.getDirname())}},getType:function(){if(this.sFilename=="/"){return"pxDirectory"}return this.oParent.oResults[this.getPath()][this.iIndex].sType},getExtension:function(){return this.oParent.oResults[this.getPath()][this.iIndex].sExtension},getShare:function(){return this.oParent.oParameters.sShare},move:function(E){var D=$("dragable");if(!D){D=document.createElement("ul");D.id="dragable";document.body.appendChild(D);for(var C in this.oParent.oSelected){var A=this.oParent.oSelected[C];var B=document.createElement("li");D.appendChild(B);B.appendChild(document.createTextNode(A.getFilename()))}}D.style.top=E.clientY+10+"px";D.style.left=E.clientX+10+"px";D=null},mouseDown:function(A){A.cancelBubble=true;if(pxp.bHold){return false}this.selectItem(A,px.Event.element(A).nodeName.toLowerCase()=="a"&&this.oParent.oSelected[this.sFilename]&&!A.ctrlKey);this.oParent.oActiveItem=this;pxp.setActiveControl(this.oParent);pxp.startDrag("item");document.onmousemove=px.lang.Function.bindEvent(this.move,this)},itemClick:function(B){B.cancelBubble=true;var A=this.oParent;if(A.bChecklist){return false}var D=this.getPath();var C=A.oResults[D][this.iIndex].sType;A.showContextMenu(this,B,C,A.oSettings[D].aAllowedActions[C])},itemDblClick:function(A){px.ui.ContextMenu.hide();this.fileClick(A)},fileClick:function(B){B.cancelBubble=true;if(pxp.bHold){return false}var A=this.oParent;if(!B.ctrlKey&&(!A.bChecklist||this.bDirectory)){pxp.bHold=true;if(this.bDirectory){A.oSelected={};A.oParameters.sPath=this.sFilename;A.oParameters.sSearchQuery=null;A.update({_bReload:false});if(A.onDirChange){A.onDirChange()}}else{this.selectItem(B);A.callAction(pxp.oTypes[this.getType()].aDefaultActions[0],B)}window.setTimeout("pxp.bHold=false",250)}return false}});px.Class.define("px.ui.Textview",{extend:px.io.RemoteView,construct:function(A,B){this.base(arguments,A,B);this.oParameters.sAction="edit";this.oForm=document.createElement("form");this.oForm.className="pxTextview";this.oForm.method="post";this.oForm.action=pxp.sUrl;B.appendChild(this.oForm);this.oTextarea=document.createElement("textarea");this.oTextarea.name="sContent";this.oTextarea.className="pxTextview";this.oTextarea.setAttribute("wrap","off");this.oTextarea.style.overflow="auto";this.oForm.appendChild(this.oTextarea);this.oTextarea.onchange=px.lang.Function.bind(this.onTextChange,this)},destruct:function(){this.oTextarea.onchange=null;this._disposeFields("oParent","oParentNode","oForm","oTextarea")}});Object.extend(px.Proto,{onTextChange:function(){this.oParent.setChanged(true)},save:function(){var A=this._save({sAction:"edit"});if(A.bOk){pxp.refreshView(px.util.dirname(this.oParameters.sPath));this.oParent.setChanged(false)}return false},_update:function(){this.oTextarea.value=this.oResults[this.oParameters.getPath()];px.html.Form.enable(this.oForm);this.oTextarea.focus()}});px.Class.define("px.ui.Splitview",{extend:px.core.Object,construct:function(B,A,C){this.oParentNode;this.sId;this.oChild1;this.oChild2;this.iWidth=100;this.iHeight=100;this.bResize=C!=false;this._bFirstHidden=false;this.bVertical=B;this.bSnap=true;this.sSnapIcon="";this.iSnapSize=240;this._sSize=A;this._iSizeFactor=0.5;this.iSize;this.iOldSize;this._oFrame1;this._oFrame2;this._oDrag;this.oToolbar;this.oActionview;this.aPersistentButtons=[];this._bDragged=false;this._iSeparatorSize},destruct:function(){if(this.bResize){this._oDrag.onmousedown=null;this._oDrag.onmouseout=null}this.oParentNode.onclick=null;this._disposeFields("oParentNode","_oFrame1","_oFrame2","_oDrag","oActionview","aPersistentButtons");this._disposeObjects("oChild1","oChild2","oToolbar")}});Object.extend(px.Statics,{resizeH:function(B){var B=B||window.event;B.cancelBubble=true;var A=pxp.oSelectedControl;A.iSize=B.clientY-iDragOffset;if(A.iSize+A._iSeparatorSize>=A.iHeight){A.iSize=A.iHeight-A._iSeparatorSize}if(A.iSize<=0){A.iSize=1}A.resizeH();if(A.oChild1){A.oChild1.resize()}if(A.oChild2){A.oChild2.resize()}},resizeV:function(B){var B=B||window.event;B.cancelBubble=true;var A=pxp.oSelectedControl;A.iSize=B.clientX-iDragOffset;if(A.iSize+A._iSeparatorSize>=A.iWidth){A.iSize=A.iWidth-A._iSeparatorSize}if(A.iSize<=0){A.iSize=1}A.resizeV();if(A.oChild1){A.oChild1.resize()}if(A.oChild2){A.oChild2.resize()}}});Object.extend(px.Proto,{init:function(B){var F=px.lang.Function;this.oParentNode=B;this._oFrame1=document.createElement("div");if(this.sId){this._oFrame1.id=this.sId+"Frame1"}this.oParentNode.appendChild(this._oFrame1);var E=this._sSize;if(E){if(!isNaN(E)){this._iSizeFactor=E}else{if(E.indexOf("px")){this._iSizeFactor=parseInt(E);this._iSizeFactor=this._iSizeFactor/this.oParentNode.offsetHeight}else{this._iSizeFactor=parseInt(E)}}if(this._iSizeFactor>1){if(this._iSizeFactor>100){this._iSizeFactor=this._iSizeFactor/1000}else{this._iSizeFactor=this._iSizeFactor/100}}}if(this.bResize){this._oDrag=document.createElement("div");this.oParentNode.appendChild(this._oDrag);this._oDrag.onmousedown=F.bindEvent(this.separatorMouseDown,this);this._oDrag.onmouseout=F.bindEvent(this.separatorMouseOut,this);if(this.sId){this._oDrag.id=this.sId+"Separator"}}this._oFrame2=document.createElement("div");if(this.sId){this._oFrame2.id=this.sId+"Frame2"}this.oParentNode.appendChild(this._oFrame2);if(this.bSnap){this.oToolbar=new px.ui.toolbar.Toolbar(this,this.oParentNode);px.html.Element.addClassName(this.oToolbar.oDiv,"pxSplitToolbar");this.oToolbar.addButton({sId:"expand",sIcon:"expand"+this.sSnapIcon+".png",oOnClick:F.bind(this.showFirst,this,null),bHidden:true});var D=this.oActionview;if(D){for(var C in D.oActionData){var A=D.oActionData[C];this.oToolbar.addButton({sId:C,sIcon:A.sIcon,sTitle:A.sTitle,oOnClick:F.bind(this.showFirst,this,null,true,C),bHidden:!px.lang.Array.contains(this.aPersistentButtons,C)})}}this.oToolbar.addButton({sId:"collapse",sIcon:"collapse"+this.sSnapIcon+".png",oOnClick:F.bindEvent(this.hideFirst,this)})}this.resizeBorderFrame();if(this.bVertical){this.initV()}else{this.initH()}if(this.oChild1){this.oChild1.init(this._oFrame1);if(this.oChild1.update){this.oChild1.update()}}if(this.oChild2){this.oChild2.init(this._oFrame2);if(this.oChild2.update){this.oChild2.update()}}},changeOrientation:function(A){var B=A!=null?A:!this.bVertical;if(this.bVertical==B){return false}else{this.bVertical=B}if(this.bVertical){this.initV()}else{this.initH()}this.resize(true);if(this.oChild1&&this.oChild1.update){this.oChild1.update()}if(this.oChild2&&this.oChild2.update){this.oChild2.update()}if(this._bFirstHidden){this.showFirst(null,false)}},initH:function(){if(this.bResize){this._oDrag.className="pxSplitSeparatorH";if(!this._iSeparatorSize){this._iSeparatorSize=this._oDrag.offsetHeight}this._oDrag.style.height=this._iSeparatorSize+"px"}else{this._iSeparatorSize=0}this._oFrame1.className=this._oFrame2.className="pxSplitH";this.iOldSize=this.iSize=Math.round(this.iHeight*this._iSizeFactor);this.resizeH()},initV:function(){if(this.bResize){this._oDrag.className="pxSplitSeparatorV";if(!this._iSeparatorSize){this._iSeparatorSize=this._oDrag.offsetWidth}this._oDrag.style.width=this._iSeparatorSize+"px"}else{this._iSeparatorSize=0}this._oFrame1.className=this._oFrame2.className="pxSplitV";this.iOldSize=this.iSize=Math.round(this.iWidth*this._iSizeFactor);this.resizeV()},dragCleanup:function(C){var B=px.html.Element;if(!this._bDragged){this._bDragged=false;return false}if(this.bResize){var A=pxp.oSelectedControl;if(B.hasClassName(A._oDrag,"drag")){B.removeClassName(A._oDrag,"drag");if(this.iSize!=this.iOldSize){this.iOldSize=this.iSize;if(this.oChild1){this.oChild1.resize(true)}if(this.oChild2){this.oChild2.resize(true)}if(this._bFirstHidden){this.showFirst(null,false)}else{if(this.iSize<60){this.hideFirst(C)}}return false}else{var D=px.ui.ContextMenu;D.clear();D.addItem("changeOrientation",oTranslation["changeOrientation"],pxConst.sGraphicUrl+"/rotate.png");D.show(C,1)}}}},showFirst:function(F,D,B){var L=px.html.Element;if(F){var J=px.Event.element(F);if(J!=this.oParentNode&&!B){return true}}var H=this.oToolbar;var G=H.oDiv;var E="pxSplitToolbarVertical";var C=L.hasClassName(G,E);L.removeClassName(G,E);if(D!==false&&C){var A=this.iSnapSize;var K=this._iPreviousSize||A;if(K<A){K=A}this.iOldSize=this.iSize=K}if(C){for(var I in H.oButtons){if(!px.lang.Array.contains(this.aPersistentButtons,I)){H[I=="collapse"?"showButton":"hideButton"](I)}}this.resize(true);this._oFrame1.style.visibility="";this.oParentNode.onclick=null;this._bFirstHidden=false}if(this.oActionview&&B){this.oActionview.showAction(B)}return false},hideFirst:function(C){var B=this.oToolbar;this._oFrame1.style.visibility="hidden";px.html.Element.addClassName(B.oDiv,"pxSplitToolbarVertical");this._iPreviousSize=this.iSize;this.iOldSize=this.iSize=22;this.resize(true);this.oParentNode.onclick=px.lang.Function.bindEvent(this.showFirst,this);for(var A in B.oButtons){if(!px.lang.Array.contains(this.aPersistentButtons,A)){B[A=="collapse"?"hideButton":"showButton"](A)}}this._bFirstHidden=true;if(C){C.cancelBubble=true}return false},callAction:function(A){switch(A){case"changeOrientation":this.changeOrientation();break}},resizeBorderFrame:function(){if(this.oParentNode.offsetWidth>0){this.iWidth=this.oParentNode.offsetWidth}if(this.oParentNode.offsetHeight>0){this.iHeight=this.oParentNode.offsetHeight-this._oFrame1.offsetTop}},resize:function(A){this.resizeBorderFrame();if(this.bVertical){if(this.resizeV()){A=true}}else{if(this.resizeH()){A=true}}if(this.oChild1){this.oChild1.resize(A)}if(this.oChild2){this.oChild2.resize(A)}},save:function(){if(this.oChild1&&this.oChild1.save){this.oChild1.save()}if(this.oChild2&&this.oChild2.save){this.oChild2.save()}},resizeH:function(){this._bDragged=true;var B=false;if(this.bResize){if(this.iSize+this._iSeparatorSize+10>this.iHeight){this.iSize=this.iHeight-10;if(this.iSize<=0){this.iSize=1}B=true}}var A=this.iHeight-this.iSize-this._iSeparatorSize;if(A<=0){A=1}if(this.bResize){this._oDrag.style.width=this.iWidth+"px"}this._oFrame1.style.height=this.iSize+"px";this._oFrame1.style.width=this.iWidth+"px";this._oFrame2.style.height=A+"px";this._oFrame2.style.width=this.iWidth+"px";if(this.bSnap){this.oToolbar.oDiv.style.top="2px";this.oToolbar.oDiv.style.left=this._oFrame1.offsetWidth-this.oToolbar.oDiv.offsetWidth-4+"px"}return B},resizeV:function(){this._bDragged=true;var B=false;if(this.bResize){if(this.iSize+this._iSeparatorSize+10>this.iWidth){this.iSize=this.iWidth-10;if(this.iSize<=0){this.iSize=1}B=true}}var A=this.iWidth-this.iSize-this._iSeparatorSize;if(A<=0){A=1}if(this.bResize){this._oDrag.style.height=this.iHeight+"px"}this._oFrame1.style.height=this.iHeight+"px";this._oFrame1.style.width=this.iSize+"px";this._oFrame2.style.height=this.iHeight+"px";this._oFrame2.style.width=A+"px";if(this.bSnap){this.oToolbar.oDiv.style.top="2px";this.oToolbar.oDiv.style.left=this.iSize-this.oToolbar.oDiv.offsetWidth+"px"}return B},separatorMouseDown:function(B){var A=px.html.Element;pxp.setActiveControl(this);this._oDrag.className="pxSplitSeparator"+(this.bVertical?"V":"H")+" drag";pxp.startDrag("resize");if(this.bVertical){iDragOffset=B.clientX-A.getLeftOffset(this._oDrag)+A.getLeftOffset(pxp.oSelectedControl.oParentNode);document.onmousemove=px.ui.Splitview.resizeV}else{iDragOffset=B.clientY-A.getTopOffset(this._oDrag)+A.getTopOffset(pxp.oSelectedControl.oParentNode);document.onmousemove=px.ui.Splitview.resizeH}},separatorMouseOut:function(A){if(this._oDrag.className.indexOf("drag")>-1){this.resize()}}});px.Class.define("px.ui.Propertyview",{extend:px.io.RemoteView,construct:function(B,A){this.base(arguments,B,A);this.aWidgets=[];this.oGroups={};this.bReadonly=false;this.sSaveAction="editProperties";this.oParameters.bFull=true;this.oParameters.bFillOptions=true;this.oParameters.bFile=true;this.sId=px.util.getRandomId();this.oForm=document.createElement("form");this.oForm.method="post";this.oForm.action=pxp.sUrl;A.appendChild(this.oForm);this._oTable=document.createElement("table");this._oTable.cellSpacing=3;this._oTable.cellPadding=0;this._oTable.className="pxPropertyview";this.oForm.appendChild(this._oTable);this._oTableBody=document.createElement("tbody");this._oTable.appendChild(this._oTableBody)},destruct:function(){for(var A in this.oGroups){this.oGroups[A].firstChild.firstChild.onclick=null;this.oGroups[A]=null}this._disposeFields("oForm","_oTable","_oTableBody","oObject","oGroups");this._disposeContents("aWidgets")}});Object.extend(px.Proto,{_update:function(S){var R=px.html.Element;if(this._oTableBody.firstChild){this.clear()}this.oObject=this.oResults[S][0];var P=this.oObject.sType||this.oObject.sId;var O=pxp.oTypes[P];if(O.sSupertype){var N=pxp.oTypes[P].aSupertypes.concat([P])}else{var N=[P]}var L=null;var J=true;var H;var G=[];for(var E=0;E<N.length;E++){var O=pxp.oTypes[N[E]];for(var Q in O.aProperties){if(L!=N[E]){if(H){R.addClassName(H,"last")}L=N[E];var F=document.createElement("tr");this.oGroups[L]=this._oTableBody.appendChild(F);var M=document.createElement("td");M.colSpan=2;M.className="group";F.appendChild(M);var D=document.createElement("a");D.href=pxConst.DUMMY_LINK;M.appendChild(D);D.onclick=px.lang.Function.bind(this.switchGroup,this,L);var K=pxp.getExtendedType(L);R.appendImage(D,pxConst.sModuleUrl+"/System.pxm/graphics/collapse.png");D.appendChild(document.createTextNode(" "+oTranslation["type."+K]));J=true}F=document.createElement("tr");this._oTableBody.appendChild(F);M=document.createElement("td");M.className="label"+(J?" first":"");M.appendChild(document.createTextNode(oTranslation["property."+Q]));F.appendChild(M);M=document.createElement("td");M.id=this.sId+"_"+Q;M.className="value"+(J?" first":"");F.appendChild(M);var I=O.aProperties[Q];var C=I.sWidget;if(!pxp.oData[this.oParameters._sOptionCacheKey]){pxp.oData[this.oParameters._sOptionCacheKey]=this.oSettings[S].oOptions[P]}I.oOptions=pxp.oData[this.oParameters._sOptionCacheKey][Q];this.aWidgets.push(new (px.ui.widget[C]||px.ui.widget.Input)(this,M,O.sId,Q,this.oObject[Q]));J=false}H=M}H=null;var B=pxp.oTypes[P].aExpandSubtypes;if(B){for(var A in this.oGroups){if(!px.lang.Array.contains(B,A)){this.switchGroup(A)}}}this.resize(true)},clear:function(C){for(var B in this.oGroups){this.oGroups[B].firstChild.firstChild.onclick=null;this.oGroups[B]=null}this._disposeContents("aWidgets");this.aWidgets=[];delete this.oObject;if(!C){while(this._oTableBody.firstChild){var A=this._oTableBody.firstChild;while(A.firstChild){A.deleteCell(0)}this._oTableBody.deleteRow(0)}}},resize:function(D){for(var C=0,A=this.aWidgets.length;C<A;C++){var B=this.aWidgets[C];if(B.resize){B.resize(D)}}},save:function(){var B=this._oTableBody.firstChild;do{if(B.className!=""){B.className="";B.firstChild.title=null}}while(B=B.nextSibling);var A=this._save({sAction:this.sSaveAction});if(A.bOk){pxp.refreshView(px.util.dirname(this.oParameters.sPath));this.oParent.setChanged(false)}else{for(var D in A){var C=$(this.sId+"_"+D);if(C){var B=C.parentNode;B.className="error";B.firstChild.title=oTranslation["error."+A[D]]}else{pxp.showError({sId:A[D],aValues:[this.oParameters.sPath]})}}alert(oTranslation["error.validationError"])}return false},rename:function(B){var A=$(this.sId+"_sName");A.firstChild.nodeValue=px.util.basename(B)},switchGroup:function(B){var A=px.html.Element;var F=this.oGroups[B].firstChild;var C=F.firstChild.firstChild;var G=C.src.indexOf("expand")>-1;C.src=pxConst.sModuleUrl+"/System.pxm/graphics/"+(G?"collapse.png":"expand.png");var E=F.parentNode.nextSibling.firstChild;while(E.className.indexOf("group")==-1){var D=E.parentNode;A.switchElement(D);if(!D.nextSibling){break}E=D.nextSibling.firstChild}this.resize(true);return false}});px.Class.define("px.ui.listview.Listview",{extend:px.io.RemoteView,construct:function(C,B){this.base(arguments,C,B);var A=px.lang.Function;this.oColumns={};this.bChecklist=false;this.bHideExtension=false;this.aItems=[];this.oSelected={};this.iVisibleItems;this.onDirChange;this._iRowHeight;this._iOffset=0;this._iWidth=-1;this._iHeight=-1;this._bScrollH=false;this._bScrollV=false;this._bEditing=false;this._oEditCell=null;this._iScrollbarSize=pxp.bIe?19:20;px.html.Element.addClassName(B,"noSelect");this._oTable=document.createElement("table");var E=this._oTable;E.cellSpacing=0;E.cellPadding=0;E.className="pxListview";B.appendChild(E);this._oTableHead=document.createElement("thead");E.appendChild(this._oTableHead);this._oTableBody=document.createElement("tbody");E.appendChild(this._oTableBody);this._oScrollBar=document.createElement("div");var D=this._oScrollBar;D.className="scrollBar";D.style.width=this._iScrollbarSize+"px";B.appendChild(D);D.onscroll=A.bindEvent(this.scrollBarVChange,this);B.onscroll=A.bindEvent(this.scrollBarHChange,this);D.appendChild(document.createElement("div"));B.onmousewheel=A.bindEvent(this.mouseWheelChange,this);if(B.addEventListener){B.addEventListener("DOMMouseScroll",B.onmousewheel,false)}},destruct:function(A){this._oTableHead.firstChild.firstChild.onclick=null;this._oScrollBar.onscroll=null;this.oParentNode.onscroll=null;if(this.oParentNode.removeEventListener){this.oParentNode.removeEventListener("DOMMouseScroll",this.oParentNode.onmousewheel,false)}this.oParentNode.onmousewheel=null;this._disposeFields("oSelected","onDirChange","_oScrollBar","_oTable","_oTableHead","_oTableBody");this._disposeContents("oColumns","aItems")}});Object.extend(px.Statics,{_oColumnSelection:{base:["iBytes","dModified","sType"],os:["sOSystemPermissions","sOSystemOwner","sOSystemGroup"],full:["aTags","sTitle","sDescription"]}});Object.extend(px.Proto,{build:function(){var K=px.lang.Function;var H=px.html.Element;this._iWidth=this.oParentNode.offsetWidth;this._iHeight=this.oParentNode.offsetHeight;var F=0;var P=document;if(this._oTableHead.childNodes.length>0){this.clear()}var Q=this._oTableHead.insertRow(0);Q.className="header";if(this.bChecklist){var C=P.createElement("th");var O="checkbox";C.className=O;Q.appendChild(C)}var C=P.createElement("th");var O="icon";C.className=O;Q.appendChild(C);H.appendImage(C,pxConst.sGraphicUrl+"/configure.png");C.onclick=K.bindEvent(this._showConfig,this);for(var J in this.oColumns){var B=this.oColumns[J];B.oTh=P.createElement("th");B.oTh.id="header_"+J;B.oTh.style.width=this.oColumns[J]["iWidth"]+"px";B.oTh.appendChild(P.createTextNode(oTranslation["property."+J]));Q.appendChild(B.oTh);var M=new Image();M.className="orderIndicator";if(this._sOrderBy!=B.sId){M.style.display="none"}M.src=pxConst.sGraphicUrl+"/"+this._sOrderDirection+".png";M.style.width=M.style.height=13+"px";B.oTh.appendChild(M);B.oTh.onmousemove=K.bindEvent(B.headerMouseMove,B);B.oTh.onmousedown=K.bindEvent(B.headerMouseDown,B);B.oTh.onmouseup=K.bindEvent(B.headerMouseUp,B);B.oTh.onmouseover=K.bindEvent(B.headerMouseOver,B);B.oTh.onmouseout=K.bindEvent(B.headerMouseOut,B)}var L=this.oParentNode.offsetHeight-Q.offsetHeight;if(this._bScrollH){L-=this._iScrollbarSize}var I=0;this.iVisibleItems=0;var G=px.ui.listview.Row;while(I<L){var A=new G(this);this.aItems.push(A);A.oTr=this._oTableBody.insertRow(this._oTableBody.rows.length);Q=A.oTr;Q.style.visibility="hidden";if(this.bChecklist){var E=Q.insertCell(Q.cells.length);E.className="icon";var M=new Image();M.src=pxConst.sGraphicUrl+"/checkbox.png";E.appendChild(M)}var E=Q.insertCell(Q.cells.length);E.className="icon";H.appendImage(E,pxConst.sGraphicUrl+"/dummy16.png");for(var J in this.oColumns){E=Q.insertCell(Q.cells.length);E.style.textAlign=this.oColumns[J].sAlign;H.addClassName(E,J);Q.appendChild(E);var N=this.oColumns[J].sType;switch(N){case"link":A.oA=P.createElement("a");var D=A.oA;D.href=pxConst.DUMMY_LINK;D.appendChild(P.createTextNode("X"));E.appendChild(D);D.onclick=K.bindEvent(A.fileClick,A);A.oNameNode=D;break;case"select":A.oA=P.createElement("a");var D=A.oA;D.href=pxConst.DUMMY_LINK;D.appendChild(P.createTextNode("X"));E.appendChild(D);E.onclick=K.bindEvent(A.editClick,A);break;default:E.appendChild(P.createTextNode("X"));break}}Q.onclick=K.bindEvent(A.itemClick,A);Q.ondblclick=K.bindEvent(A.itemDblClick,A);Q.onmousedown=K.bindEvent(A.mouseDown,A);Q.onmouseover=K.bindEvent(A.rowMouseOver,A);Q.onmouseout=K.bindEvent(A.rowMouseOut,A);Q.onmouseup=K.bindEvent(A.rowMouseUp,A);if(!this._iRowHeight){this._iRowHeight=Q.offsetHeight}this.iVisibleItems++;I+=this._iRowHeight}Q=null;C=null;M=null;E=null;A=null},clear:function(){this._oTableHead.firstChild.firstChild.onclick=null;for(var F in this.oColumns){var E=this.oColumns[F];var C=E.oTh;C.onmousemove=null;C.onmousedown=null;C.onmouseup=null;C.onmouseover=null;C.onmouseout=null;E.oTh=null}for(var D=0,A=this.aItems.length;D<A;D++){this.aItems[D].dispose();this.aItems[D]=null}var B=this._oTableHead.firstChild;while(B.firstChild){B.deleteCell(0)}this._oTableHead.deleteRow(0);while(this._oTableBody.firstChild){var B=this._oTableBody.firstChild;while(B.firstChild){B.deleteCell(0)}this._oTableBody.deleteRow(0)}this.aItems.length=0},_update:function(A){if(this.oParameters.sSearchQuery){if(!this.oColumns["sRelDir"]){this.clear();this.addColumn("sRelDir",140,"text","left",null,true);this.build()}}else{if(this.oColumns["sRelDir"]&&this.oColumns["sRelDir"].bTemp){delete this.oColumns["sRelDir"];this.build()}}if(this.oParameters._bReload){this._fill(null,true)}else{this._fill(0,true)}},_fill:function(J,H){var F=this.oParameters.getPath();J=this._reloadCheck(F,J,H);if(J==-1){return false}var E=this.oResults[F];var D=this.oSettings[F].oOptions;for(var L=0,M=this.iVisibleItems;L<M;L++){var K=E[L+J];var A=this.aItems[L];oTr=A.oTr;if(!K){oTr.style.visibility="hidden";A.iIndex=-1;oTr.id=null;continue}else{oTr.style.visibility="";A.iIndex=(L+J);oTr.id="r"+A.iIndex}var F=K.sRelDir;if(F!="/"){F+="/"}A.sFilename=F+K.sName;A.bDirectory=K.bDirectory;var I=pxp.getExtendedType(K.sType,K.sExtension);var G=pxp.oTypes[K.sType]["sModule"];var T=this.oSelected[A.sFilename];if(this.bChecklist){oTr.childNodes[0].firstChild.src=pxConst.sGraphicUrl+"/checkbox"+(T?"Checked":"")+".png";var B=1}else{var B=0}oTr.childNodes[B].firstChild.src=pxConst.sModuleUrl+"/"+G+".pxm/graphics/types/"+I+".png";var S=B+1;for(var R in this.oColumns){var Q=this.oColumns[R];oTd=oTr.childNodes[S];oTd.style.textAlign=Q.sAlign;var P=K[R]||"";if(Q.oFormat){P=Q.oFormat(P)}switch(Q.sType){case"link":var C=oTd.firstChild;if(R=="sName"){if(T){C.className="selected"}else{if(C.className){C.className=null}}if(this.bHideExtension){P=K.sId}}C.firstChild.nodeValue=P;break;case"type":oTd.firstChild.nodeValue=oTranslation["type."+I];break;case"select":oTd.firstChild.firstChild.nodeValue=D[K.sType][R][P];break;case"multiple":var O="";if(P.join){O=P.join(", ")}oTd.firstChild.nodeValue=O;break;case"array":oTd.firstChild.nodeValue=P.join?P.join(", "):"";break;default:oTd.firstChild.nodeValue=P;break}S++}}this._iOffset=J;var N=0;if(E.length){N=Math.round(E.length*this._iRowHeight+2*this._iRowHeight)}if(N>this._oScrollBar.offsetHeight){this._oScrollBar.firstChild.style.height=N+"px";this._oScrollBar.style.visibility=""}else{this._oScrollBar.style.visibility="hidden"}if(!this._bReloading){delete this._bPopulating;delete this._bReloading}},addColumn:function(E,F,D,C,B,A){if(!this.oColumns[E]){this.oColumns[E]=new px.ui.listview.Column(this,E,F,D,C,B,A)}},removeColumn:function(A){this.oColumns[A].dispose();delete this.oColumns[A]},dragCleanup:function(){px.io.RemoteView.dragCleanup.call(this);var A=$("dragColumn");if(A){A.style.display="none"}A=null;var G=this.bChecklist?2:1;var E=pxp.oSelectedControl._oTableHead.firstChild.childNodes;for(var B=G;B<E.length;B++){if(E[B].className){if(px.html.Element.hasClassName(E[B],"drop")){var D={},C=G;for(var F in this.oColumns){if(C==B){D[this.oActiveItem.sId]=this.oActiveItem;D[F]=this.oColumns[F]}else{if(this.oColumns[F]!=this.oActiveItem){D[F]=this.oColumns[F]}}C++}this.oColumns=D;this.build();this._fill();return }E[B].className=null}}},clearSelection:function(){if(!this.bChecklist){delete this.oSelected;this.oSelected={};this._fill()}},sort:function(B){this.oColumns[this._sOrderBy].oTh.childNodes[1].style.display="none";this._clientSort(B);var A=this.oColumns[this._sOrderBy].oTh.childNodes[1];A.src=pxConst.sGraphicUrl+"/"+this._sOrderDirection+".png";A.style.display="inline"},scrollBarVChange:function(A){this._fill(Math.round(this._oScrollBar.scrollTop/this._iRowHeight+0.4555555))},scrollBarHChange:function(B){var A=(this._oTable.offsetWidth-this.oParentNode.offsetWidth)-this.oParentNode.scrollLeft;this._oScrollBar.style.left=(this._oTable.offsetWidth-A-this._oScrollBar.offsetWidth)+"px"},resize:function(A){if(A){this._bScrollH=this.oParentNode.offsetWidth<this._oTable.offsetWidth;this._bScrollV=this.oParentNode.offsetHeight<this._oTable.offsetHeight;this.build();this._fill();this.scrollBarHChange();this.scrollBarVChange()}},mouseWheelChange:function(C){var B=C.detail||(C.wheelDelta/40*-1);var A=this._iOffset+B;this._oScrollBar.scrollTop=A*this._iRowHeight;if(A>=0){this._fill(A)}},_showConfig:function(B){var D=px.ui.ContextMenu;var A=px.ui.listview.Listview._oColumnSelection;pxp.setActiveControl(this);D.clear();for(var C in pxp.oTypes["pxMeta"].aProperties){D.addItem("pxCol|"+C,oTranslation["property."+C],pxConst.sGraphicUrl+"/"+(this.oColumns[C]?"tick":"dummy16")+".png")}D.show(B)},callActionSub:function(G,F){var D=px.lang.Array;var C=px.ui.listview.Listview._oColumnSelection;if(G.indexOf("pxCol|")===0){var B=G.substr(G.indexOf("|")+1);this.clear();if(this.oColumns[B]){this.removeColumn(B)}else{var A=pxp.oTypes["pxMeta"].aProperties;var H=A[B];this.addColumn(B,140,H?H.sDataType:"text","left");if(H.sFormat){this.oColumns[B].oFormat=px.util.Format[H.sFormat]}}var J=false,E=false;for(var I in this.oColumns){if(D.contains(C.os,I)){J=true}if(D.contains(C.full,I)){E=true}}this.oParameters.bOsPermissions=J;this.oParameters.bFull=E;this.build();this.update()}else{this.callAction.call(this,G,F)}}});px.Class.define("px.ui.listview.Column",{extend:px.core.Object,construct:function(G,E,F,D,C,B,A){this.oParent=G;this.sId=E;this.iWidth=F;this.sType=D;this.sAlign=C;this.oFormat=B;this.bTemp=A;this.oTh},destruct:function(){var A=this.oTh;if(A){A.onmousemove=null;A.onmousedown=null;A.onmouseup=null;A.onmouseover=null;A.onmouseout=null}this._disposeFields("oParent","oFormat","oTh")}});Object.extend(px.Statics,{resize:function(B){var B=B||window.event;var A=B.clientX-px.html.Element.getLeftOffset(oActiveItem)+pxp.oSelectedControl.oParentNode.scrollLeft;if(A<8){A=8}pxp.oSelectedControl.oColumns[oActiveItem.id.substr(oActiveItem.id.indexOf("_")+1)]["iWidth"]=A;oActiveItem.style.width=A+"px"},move:function(H){var H=H||window.event;var G=H.clientX-iDragOffset;var C=pxp.oSelectedControl;var E=C.bChecklist?2:1;var B=$("dragColumn");if(!B){var B=document.createElement("div");B.id="dragColumn";B.appendChild(document.createTextNode(oActiveItem.firstChild.nodeValue));document.body.appendChild(B)}else{B.firstChild.nodeValue=oActiveItem.firstChild.nodeValue}B.style.width=oActiveItem.style.width;B.style.top=px.html.Element.getTopOffset(oActiveItem)+"px";if(G>0){B.style.left=G+"px"}B.style.display="";var A=C._oTableHead.firstChild.childNodes;for(var F=E;F<A.length;F++){var I=A[F];var D=px.html.Element.getLeftOffset(I);if(G>D&&G<(D+I.offsetWidth)){if(oActiveItem!=I&&oActiveItem.nextSibling!=I){if(I.className!="drop"){I.className="drop"}}}else{if(I.className!=null){I.className=null}}}B=null}});Object.extend(px.Proto,{headerMouseOver:function(A){A.cancelBubble=true;if(document.onmousemove==null){this.oTh.className="over"}},headerMouseOut:function(A){if(pxp.bDragging){return }this.oTh.className=null},headerMouseMove:function(D){if(pxp.bDragging){return }var C=px.html.Element;var B=C.getLeftOffset(this.oTh);var A=B+this.oTh.offsetWidth-D.clientX-this.oParent.oParentNode.scrollLeft;if(A<16){this.oTh.style.cursor="e-resize";px.ui.listview.Listview.bHeaderEdgeOver=true}else{this.oTh.style.cursor="move";iDragOffset=D.clientX-C.getLeftOffset(this.oTh);delete px.ui.listview.Listview.bHeaderEdgeOver}oActiveItem=this.oTh},headerMouseDown:function(A){this.oParent.oActiveItem=this;pxp.setActiveControl(this.oParent);pxp.startDrag("listviewColumn");if(px.ui.listview.Listview.bHeaderEdgeOver){document.onmousemove=px.ui.listview.Column.resize}else{document.onmousemove=px.ui.listview.Column.move}},headerMouseUp:function(A){if(!px.ui.listview.Listview.bHeaderEdgeOver){this.oParent.sort(this.sId)}}});px.Class.define("px.ui.listview.Row",{extend:px.ui.ListItem,construct:function(A){this.oParent=A;this.iIndex;this.oTr;this.sFilename;this.bDirectory;this.oA;this.oNameNode},destruct:function(){this.oA.onclick=null;var B=this.oTr;B.onclick=null;B.ondblclick=null;B.onmouseover=null;B.onmouseout=null;B.onmousedown=null;B.onmouseup=null;for(var D=0,A=B.childNodes.length;D<A;D++){var C=B.childNodes[D];if(C.onclick){C.onclick=null}}this._disposeFields("oParent","oTr","oA","oNameNode","_oEditCell")}});Object.extend(px.Proto,{selectItem:function(D,B){var C=this.oParent;var A=this.sFilename;if(D.ctrlKey||B||C.bChecklist){if(C.oSelected[A]&&!B){delete C.oSelected[A]}else{C.oSelected[A]=this}}else{C.oSelected={};C.oSelected[A]=this}C._fill()},editClick:function(Q){var P=px.lang.Function;var N=px.html.Element;var L=px.html.Form;var J=this.oParent;var H=px.Event.element(Q);var C=H.nodeName=="A"?H.parentNode:H;var D=J.oParameters.getPath();var O=J.oResults[D];var M=J.oSettings[D];var K=C.parentNode.id.substr(1);var I=C.className;var G=J.aItems[K-J._iOffset].getType();var F=M.oOptions[G][I];N.hide(C.firstChild);J._bEditing=true;this._oEditCell=C;if(C.childNodes.length<2){switch(J.oColumns[I]["sType"]){case"select":var E=document.createElement("select");E.onmousedown=E.onmouseup=E.onclick=P.cancelEvent;E.onblur=P.bindEvent(this.exitEdit,this);C.appendChild(E);for(var B in F){var A=new Option(F[B],B);E.options[E.options.length]=A;A.selected=B==O[K][I];E.appendChild(A)}L.activate(E);E=null;break;default:alert("def");break}}else{N.show(C.childNodes[1]);L.activate(C.childNodes[1])}Q.cancelBubble=true;return false},exitEdit:function(M){var L=px.html.Element;var J=this.oParent;var H=px.Event.element(M);var O=H.parentNode;var E=J.oParameters.getPath();var B=J.oResults[E];var N=J.oSettings[E];var K=O.parentNode.id.substr(1);var I=O.className;var G=B[K];switch(J.oColumns[I]["sType"]){case"select":var F=O.childNodes[1].options[O.childNodes[1].selectedIndex].value;var D=N.oOptions[G["sType"]][I][F];break;default:alert("def");break}if(G[I]!=F){G[I]=F;O.firstChild.firstChild.nodeValue=D||F;var C=px.util.buildPath(G["sRelDir"],G["sName"]);var A=J._save({sAction:"_editProperty"},"sPath="+C+"&sProperty="+I+"&&px_"+I+"="+F);J.oParameters.sAction="_openJson"}L.show(O.firstChild);L.hide(O.childNodes[1]);this._oEditCell=null;J._bEditing=false},rowMouseOver:function(A){A.cancelBubble=true;if(pxp.bIe){this.oTr.className="hover"}if(pxp.bDragging&&this.bDirectory&&pxp.sDragType=="item"&&!pxp.oSelectedControl.oSelected[this.sFilename]&&this.sFilename.indexOf(pxp.oSelectedControl.oActiveItem.sFilename)!=0&&this.getType()!="pxVirtualDirectory"){px.html.Element.addClassName(this.oNameNode,"drop")}},rowMouseOut:function(){if(pxp.bIe){this.oTr.className=null}if(this.bDirectory){px.html.Element.removeClassName(this.oNameNode,"drop")}},rowMouseUp:function(A){if(this.bDirectory&&px.html.Element.hasClassName(this.oNameNode,"drop")){px.action.pxObject_editClipboard.itemDrop(this)}}});px.Class.define("px.ui.gallery.Galleryview",{extend:px.io.RemoteView,construct:function(D,C){this.base(arguments,D,C);var B=px.lang.Function;this.aItems=[];this.oSelected={};this.iVisibleItems;this.iThumbnailSize=parseInt(this.oParent.oShare.iThumbnailSize);this.iPadding=10;this.iIconSize=32;this.bFloat=true;this.aAdditionalExtensions=null;this.bDirectUpdate=false;this.oPreviewParameter={};this.onDirChange;this._iX;this._iY;this._iItemHeight;this._iImageLib=this.oParent.oParent.oParent.oShare.iImageLibrary;this._iOffset=0;this._oLoadTimeout;px.html.Element.addClassName(C,"noSelect");this._oLoadingImage=new Image();this._oLoadingImage.onload=B.bind(this.imageLoadCallback,this);this._oLoadingImage.onerror=B.bind(this.imageLoadError,this);this._oScrollBar=document.createElement("div");this._oScrollBar.className="scrollBar";this._oScrollBar.style.width=pxp.bIe?"19px":"20px";C.appendChild(this._oScrollBar);this._oScrollBar.onscroll=B.bindEvent(this.scrollBarChange,this);var A=document.createElement("div");this._oScrollBar.appendChild(A);C.onmousewheel=B.bindEvent(this.mouseWheelChange,this);if(C.addEventListener){C.addEventListener("DOMMouseScroll",C.onmousewheel,false)}},destruct:function(){this._oLoadingImage.onload=null;this._oLoadingImage.onerror=null;this._oScrollBar.onscroll=null;if(this.oParentNode.removeEventListener){this.oParentNode.removeEventListener("DOMMouseScroll",this.oParentNode.onmousewheel,false)}this.oParentNode.onmousewheel=null;this._disposeFields("_oLoadingImage","_oScrollBar","onDirChange");this._disposeContents("aItems")}});Object.extend(px.Proto,{clear:function(){for(var A=0;A<this.aItems.length;A++){var B=this.aItems[A];while(B.oDiv.firstChild){B.oDiv.removeChild(B.oDiv.firstChild)}this.oParentNode.removeChild(B.oDiv);B.dispose()}this.aItems.length=0},build:function(){var C=px.lang.Function;var B=px.html.Element;var A=0;var J=document;if(this.oParentNode.childNodes.length>0){this.clear(true)}if(this.bFloat){B.addClassName(this.oParentNode,"pxGalleryviewFloat")}else{B.removeClassName(this.oParentNode,"pxGalleryviewFloat")}this._sIconMargin=(this.iThumbnailSize-this.iIconSize+this.iPadding)/2+"px";this._sPreviewParameter="";for(var E in this.oPreviewParameter){this._sPreviewParameter+="&"+E+"="+encodeURIComponent(this.oPreviewParameter[E])}delete this._iItemHeight;this._iItemWidth=this.iThumbnailSize+this.iPadding+20;this._iX=Math.round((this.oParentNode.offsetWidth)/(this._iItemWidth+10)-0.45555555);if(this._iX<1||!this.bFloat){this._iX=1}var I=this.oParentNode.offsetHeight;this.iVisibleItems=0;var H=0;while(I>0){var G=new px.ui.gallery.Item();G.oParent=this;this.aItems.push(G);G.oDiv=J.createElement("div");G.oDiv.style.visibility="hidden";this.oParentNode.appendChild(G.oDiv);var D=G.oDiv;D.className="pxGalleryview";G.oImage=new Image();G.oImage.src=pxConst.sGraphicUrl+"/dummy.png";D.appendChild(G.oImage);G.oNameNode=J.createElement("a");var F=G.oNameNode;F.className="pxGalleryview";F.href=pxConst.DUMMY_LINK;F.appendChild(J.createTextNode("X"));D.appendChild(F);F.onclick=C.bindEvent(G.fileClick,G);D.onclick=C.bindEvent(G.itemClick,G);D.ondblclick=C.bindEvent(G.itemDblClick,G);D.onmousedown=C.bindEvent(G.mouseDown,G);D.onmouseover=C.bindEvent(G.itemMouseOver,G);D.onmouseout=C.bindEvent(G.itemMouseOut,G);D.onmouseup=C.bindEvent(G.itemMouseUp,G);if(!this._iItemHeight){G.oImage.height=this.iThumbnailSize;if(this.bFloat){G.oImage.width=this.iThumbnailSize}this._iItemHeight=D.offsetHeight+this.iPadding;this._iY=Math.round(I/(this._iItemHeight+10)+0.4555555)||1;this.iVisibleItems=this._iX*this._iY}if(this.bFloat){D.style.width=this._iItemWidth+"px"}D.style.height=this._iItemHeight+"px";H++;if(this.iVisibleItems==H){break}}G=null;F=null;D=null},_update:function(A){if(this.oParameters._bReload){this._fill(null,true)}else{this._fill(0,true)}},_fill:function(I,H,F){var D=this.oParameters.getPath();I=this._reloadCheck(D,I,H);if(I==-1){return false}this._iOffset=I;var B=this.oResults[D];for(var A=0;A<this.iVisibleItems;A++){var K=B[A+I];var J=this.aItems[A];oDiv=J.oDiv;if(!K){oDiv.style.visibility="hidden";J.iIndex=-1;J.oImage.src=pxConst.sGraphicUrl+"/dummy.png"}else{oDiv.style.visibility="visible";J.iIndex=A+I;var D=K.sRelDir;if(D!="/"){D+="/"}J.sFilename=D+K.sName;J.oNameNode.firstChild.nodeValue=K.sName;J.bDirectory=K.bDirectory;J.oDiv.title=K.sTitle||K.sName;if(this._iImageLib!=2&&px.util.previewCheck(K.sExtension,this.aAdditionalExtensions)){J.bThumbnail=true}else{J.bThumbnail=false}if(!this.bDirectUpdate||!px.util.previewCheck(K.sExtension,this.aAdditionalExtensions)){J.oImage.style.height=this.iIconSize+"px";if(this.bFloat){J.oImage.style.width=this.iIconSize+"px"}J.oImage.style.marginTop=this._sIconMargin;J.oImage.style.marginBottom=this._sIconMargin;var G=pxp.getExtendedType(K.sType,K.sExtension);var E=pxp.oTypes[K.sType]["sModule"];J.oImage.src=pxConst.sModuleUrl+"/"+E+".pxm/graphics/types/"+G+".png"}if(this.bDirectUpdate){J.oImage.src="./preview.php?sShare="+this.oParent.oShare.sId+"&sAction=_openPreview&sPath="+encodeURIComponent(J.sFilename)+"&iWidth="+this.iThumbnailSize+"&iHeight="+this.iThumbnailSize+this._sPreviewParameter}}}var C=0;if(B.length){var C=(B.length/this._iX)*(this._iItemHeight+10)}if(C>this._oScrollBar.offsetHeight){this._oScrollBar.firstChild.style.height=C+"px";this._oScrollBar.style.visibility="visible"}else{this._oScrollBar.style.visibility="hidden"}this.setSelection();if(!this._bReloading){delete this._bPopulating;delete this._bReloading;if(this._iImageLib!=2){if(F==null){if(!this._bLoading){this._iCurrentItemIndex=0;if(!this.bDirectUpdate){this.loadNextImage()}}else{this._bReset=true}}}}},loadNextImage:function(){var A=this.aItems[this._iCurrentItemIndex];while(A&&!A.bThumbnail){this._iCurrentItemIndex++;var A=this.aItems[this._iCurrentItemIndex]}if(A&&A.iIndex>-1){if(this._bLoading){return }this._bLoading=true;if(A.bThumbnail){this._oLoadingImage.src="./preview.php?sShare="+this.oParent.oShare.sId+"&sAction=_openPreview&sPath="+encodeURIComponent(A.sFilename)+"&iWidth="+this.iThumbnailSize+"&iHeight="+this.iThumbnailSize+this._sPreviewParameter}}},imageLoadCallback:function(){if(this._bReset){delete this._bLoading;delete this._bReset;this._iCurrentItemIndex=0;this.loadNextImage();return false}var A=this.aItems[this._iCurrentItemIndex];A.oImage.src=this._oLoadingImage.src;A.oImage.style.width=this._oLoadingImage.width+"px";A.oImage.style.height=this._oLoadingImage.height+"px";var D=this.iThumbnailSize-this._oLoadingImage.height+10;var C=Math.round(D/2);var B=D-C;A.oImage.style.marginTop=C+"px";A.oImage.style.marginBottom=B+"px";this._iCurrentItemIndex++;delete this._bLoading;this.loadNextImage()},imageLoadError:function(){delete this._bLoading;this._iCurrentItemIndex++;this.loadNextImage()},dragCleanup:function(){px.io.RemoteView.dragCleanup.call(this)},clearSelection:function(){delete this.oSelected;this.oSelected={};this.setSelection()},setSelection:function(){for(var B=0;B<this.iVisibleItems;B++){var A=this.aItems[B];if(this.oSelected[A.sFilename]){px.html.Element.addClassName(A.oNameNode,"selected")}else{px.html.Element.removeClassName(A.oNameNode,"selected")}}},sort:function(A){this._clientSort(A)},scrollBarChange:function(B){var A=Math.round(this._oScrollBar.scrollTop/(this._iItemHeight+10)+0.4555555)*this._iX;if(A!=this._iOffset){if(this._oLoadTimeout){window.clearTimeout(this._oLoadTimeout)}this._oLoadTimeout=window.setTimeout(px.lang.Function.bind(this._fill,this,A),100)}},mouseWheelChange:function(C){var B=C.detail||(C.wheelDelta/40*-1);if(B>0){var A=this._iOffset+this._iX}else{var A=this._iOffset-this._iX}if(A>=0){this._iOffset=A;this._oScrollBar.scrollTop=A*(this._iItemHeight+10)/this._iX;this._fill(A)}},resize:function(A){if(A){this.build();this._fill()}}});px.Class.define("px.ui.gallery.Item",{extend:px.ui.ListItem,construct:function(){this.iIndex;this.oDiv;this.oParent;this.sFilename;this.bDirectory;this.oNameNode},destruct:function(){var A=this.oDiv;A.onclick=null;A.onmousedown=null;A.onmouseover=null;A.onmouseout=null;A.onmouseup=null;A.ondblclick=null;this.oNameNode.onclick=null;this._disposeFields("oParent","oDiv","oImage","oNameNode")}});Object.extend(px.Proto,{selectItem:function(B,C){var A=this.oParent;if(B.ctrlKey||C){if(A.oSelected[this.sFilename]&&!C){delete A.oSelected[this.sFilename]}else{A.oSelected[this.sFilename]=this}}else{A.oSelected={};A.oSelected[this.sFilename]=this}A.setSelection()},itemMouseOver:function(A){A.cancelBubble=true;if(pxp.bIe){px.html.Element.addClassName(this.oNameNode,"hover")}if(pxp.bDragging&&this.bDirectory&&pxp.sDragType=="item"&&!pxp.oSelectedControl.oSelected[this.sFilename]&&this.sFilename.indexOf(pxp.oSelectedControl.oActiveItem.sFilename)!=0&&this.getType()!="pxVirtualDirectory"){this.oNameNode.className="drop"}},itemMouseOut:function(){if(pxp.bIe){px.html.Element.removeClassName(this.oNameNode,"hover")}px.html.Element.removeClassName(this.oNameNode,"drop")},itemMouseUp:function(A){if(px.html.Element.hasClassName(this.oNameNode,"drop")){px.action.pxObject_editClipboard.itemDrop(this)}}});px.Class.define("px.ui.tabview.Tabview",{extend:px.core.Object,construct:function(C,B,A){this.oParent=C;this.oParentNode=B;this.oInsertBefore=A;this.oSelected;this.onTabClick;this.oTabs={}},destruct:function(){this._disposeFields("oParent","oParentNode","oInsertBefore","oSelected","onTabClick");this._disposeContents("oTabs")}});Object.extend(px.Proto,{addTab:function(A,C,B){this.oTabs[A]=new px.ui.tabview.Button(this,A,C);if(B){this.setSelected(A,true)}},removeTab:function(B){var A=this.oTabs[B].oDiv;this.oTabs[B].dispose();this.oParentNode.removeChild(A);delete this.oTabs[B]},setSelected:function(A,C){if(!this.oTabs[A]){return false}if(this.oSelected==this.oTabs[A]){return false}for(var B in this.oTabs){this.oTabs[B].oDiv.className="pxTab"}this.oTabs[A].oDiv.className="pxTab pxSelectedTab";this.oSelected=this.oTabs[A];if(this.onTabClick&&!C){this.onTabClick(A)}}});px.Class.define("px.ui.tabview.Button",{extend:px.core.Object,construct:function(C,A,B){this.oParent=C;this.sId=A;this.sTitle=B;this.oDiv=document.createElement("div");this.oDiv.className="pxTab";this.oDiv.appendChild(document.createTextNode(B));if(this.oParent.oInsertBefore){this.oParent.oParentNode.insertBefore(this.oDiv,this.oParent.oInsertBefore)}else{this.oParent.oParentNode.appendChild(this.oDiv)}this.oDiv.onclick=px.lang.Function.bind(this.click,this)},destruct:function(){this.oDiv.onclick=null;this._disposeFields("oParent","oDiv")}});Object.extend(px.Proto,{click:function(){this.oParent.setSelected(this.sId)}});px.Class.define("px.ui.toolbar.Toolbar",{extend:px.core.Object,construct:function(C,A,B){this.oParent=C;this.oParentNode=A;this.oButtons={};this.iIconSize=16;this.oDiv=document.createElement("div");this.oDiv.className="pxToolbar";if(B){this.oDiv.id=B}if(this.oParent.bToolbarFirst){this.oParentNode.insertBefore(this.oDiv,this.oParentNode.firstChild)}else{this.oParentNode.appendChild(this.oDiv)}},destruct:function(){this._disposeFields("oParent","oParentNode","oDiv");this._disposeContents("oButtons")}});Object.extend(px.Proto,{addButton:function(A){this.oButtons[A.sId]=new px.ui.toolbar.Button(this,A);if(A.bHidden){this.hideButton(A.sId)}},showButton:function(A){if(this.oButtons[A]){this.oButtons[A].oA.style.display="block"}},hideButton:function(A){if(this.oButtons[A]){this.oButtons[A].oA.style.display="none"}},removeButton:function(B){var A=this.oButtons[B].oA;this.oButtons[B].dispose();this.oDiv.removeChild(A);delete this.oButtons[B]},enableButton:function(A){var B=this.oButtons[A];px.html.Element.removeClassName(B.oA,"pxTbDisabled");if(B.oOnClick&&B.oOnClick instanceof Function){B.oA.onclick=B.oOnClick;B.changeImage(pxConst.sGraphicUrl+"/"+B.sIcon)}},disableButton:function(A){var E=this.oButtons[A];px.html.Element.addClassName(E.oA,"pxTbDisabled");E.oA.onclick=px.lang.Function.cancelEvent;var C=px.util.dirname(E.sIcon);var B=px.util.basename(E.sIcon);var D=px.util.buildPath(C,"disabled_"+B);E.changeImage(pxConst.sGraphicUrl+"/"+D)},addDivider:function(){var A=document.createElement("div");A.className="pxTbDivider";this.oDiv.appendChild(A)}});px.Class.define("px.ui.toolbar.Button",{extend:px.core.Object,construct:function(G,F){var E=px.lang.Function;var D=px.html.Element;this.oParent=G;this.oParentNode=G.oDiv;this.sId=F.sId;this.sLabel=pxp.translateTitle(F.sLabel);this.sIcon=F.sIcon;this.sTitle=F.sTitle;this.bRight=F.bRight;this.bDropDown=F.bDropDown||false;this.oOnClick=F.oOnClick;this.oDropHandler=F.oDropHandler;this.iType=F.iType||pxConst.TOOLBAR_BUTTON_LINK;this.sClass=F.sClass;if(F.bLabel){this.oA=document.createElement("span")}else{this.oA=document.createElement("a");this.oA.href=pxConst.DUMMY_LINK}this.oA.className=this.sClass||"pxTb";if(F.bDisabled){px.html.Element.addClassName(this.oA,"pxTbDisabled")}this.oParentNode.appendChild(this.oA);if(this.bRight){var C=0;for(var A in this.oParent.oButtons){if(this.oParent.oButtons[A].bRight){C+=2+this.oParent.oButtons[A].oA.offsetWidth}}this.oA.style.position="absolute";this.oA.style.right=C+"px"}if(this.sIcon){var B=this.sIcon.indexOf(".pxm")>-1?this.sIcon:pxConst.sGraphicUrl+"/"+this.sIcon;this.oImage=D.appendImage(this.oA,B,null,this.oParent.iIconSize,"icon");if(F.oOnIconClick&&F.oOnIconClick instanceof Function){this.oImage.onclick=F.oOnIconClick}}switch(this.iType){case pxConst.TOOLBAR_BUTTON_LINK:if(this.sLabel){this.oA.appendChild(document.createTextNode(" "+this.sLabel))}break;case pxConst.TOOLBAR_BUTTON_INPUT:this.oInput=document.createElement("input");this.oInput.type="text";if(this.sLabel){this.oInput.value=this.sLabel}this.oA.appendChild(this.oInput);this.oInput.onclick=E.cancelEvent;if(F.oInputOnKeyUp&&F.oInputOnKeyUp instanceof Function){this.oInput.onkeyup=F.oInputOnKeyUp}if(F.oInputOnFocus&&F.oInputOnFocus instanceof Function){this.oInput.onfocus=F.oInputOnFocus}if(F.oInputOnBlur&&F.oInputOnBlur instanceof Function){this.oInput.onblur=F.oInputOnBlur}break}var H=this.oParent.oParent.sDropDownIcon||"dropDown.png";if(this.bDropDown){D.appendImage(this.oA,pxConst.sGraphicUrl+"/"+H)}if(this.sTitle){this.oA.title=this.sTitle}if(this.oOnClick&&this.oOnClick instanceof Function&&!F.bDisabled){this.oA.onclick=this.oOnClick}if(this.oDropHandler){this.oA.onmouseover=E.bindEvent(px.ui.toolbar.Button.mouseOver,this);this.oA.onmouseout=E.bindEvent(px.ui.toolbar.Button.mouseOut,this);this.oA.onmouseup=E.bindEvent(px.ui.toolbar.Button.mouseUp,this)}},destruct:function(){switch(this.iType){case pxConst.TOOLBAR_BUTTON_LINK:break;case pxConst.TOOLBAR_BUTTON_INPUT:if(this.oInput.onkeyup){this.oInput.onkeyup=null}if(this.oInput.onfocus){this.oInput.onfocus=null}if(this.oInput.onblur){this.oInput.onblur=null}if(this.oInput.onclick){this.oInput.onclick=null}break}if(this.sIcon){if(this.oImage.onclick){this.oImage.onclick=null}this.oImage=null}if(this.oA.onclick){this.oA.onclick=null}if(this.oDropHandler){this.oA.onmouseover=null;this.oA.onmouseout=null;this.oA.onmouseup=null}this._disposeFields("oParent","oParentNode","oA","oOnClick","oDropHandler","oImage","oInput")}});Object.extend(px.Statics,{mouseOver:function(A){if(pxp.bDragging&&px.lang.Array.contains(this.oDropHandler.aDropTypes,pxp.sDragType)){px.html.Element.addClassName(this.oA,"drop")}},mouseOut:function(A){px.html.Element.removeClassName(this.oA,"drop")},mouseUp:function(A){if(px.html.Element.hasClassName(this.oA,"drop")){this.oDropHandler.run(pxp.oSelectedControl)}}});Object.extend(px.Proto,{showDropDown:function(){this.oA.lastChild.style.display="inline"},hideDropDown:function(){this.oA.lastChild.style.display="none"},changeImage:function(A){px.html.Element.changeImage(this.oA.firstChild,A)}});px.Class.define("px.ui.treeview.Treeview",{extend:px.io.RemoteView,construct:function(G,E,F){this.base(arguments,G,E);var D=px.lang.Function;this.oParameters.bHierarchical=true;this.oParameters.bFilesize=false;this.sTitle=F;this.aItems=[];this.oSelected={};this.sActiveItem="/";this.onNodeClick;px.html.Element.addClassName(E,"noSelect");this.oDiv=document.createElement("div");this.oDiv.className="pxTreeview";E.appendChild(this.oDiv);var C=new Image();C.src=pxConst.sGraphicUrl+"/dummy16.png";C.style.width=0;C.style.margin=0;this.oDiv.appendChild(C);C=new Image();C.src=pxConst.sGraphicUrl+"/types/pxDirectory_opened.png";this.oDiv.appendChild(C);this.oRootItem=new px.ui.treeview.Node();var B=this.oRootItem;B.oParent=this;B.sFilename="/";B.bDirectory=true;B.bExpanded=true;B.oDiv=this.oDiv;this.oDiv.onmouseover=D.bindEvent(B.nodeMouseOver,B);this.oDiv.onmouseout=D.bindEvent(B.nodeMouseOut,B);this.oDiv.onmouseup=D.bindEvent(B.nodeMouseUp,B);this.aItems.push(B);var A=document.createElement("a");A.href=pxConst.DUMMY_LINK;this.oDiv.appendChild(A);A.appendChild(document.createTextNode(this.sTitle));A.onclick=D.bindEvent(this.oRootItem.linkClick,this.oRootItem);C=null;A=null},destruct:function(){this.oDiv.onmouseover=null;this.oDiv.onmouseout=null;this.oDiv.onmouseup=null;this._disposeFields("oSelected","onNodeClick","oDiv","oRootItem");this._disposeContents("aItems")}});Object.extend(px.Proto,{getNode:function(B){for(var C=0,A=this.aItems.length;C<A;C++){if(this.aItems[C].sFilename==B){return this.aItems[C]}}return false},removeNode:function(B){for(var D=0,A=this.aItems.length;D<A;D++){if(this.aItems[D].sFilename==B){var C=this.aItems[D].oDiv;this.aItems[D].dispose();C.parentNode.removeChild(C);C=null;delete this.aItems[D];this.aItems.splice(D,1);return true}}return false},switchIconState:function(C,D){if(C.iIndex>-1){var A=this.oResults[C.getPath()][C.iIndex];var E=pxp.getExtendedType(A.sType,A.sExtension);var B=pxp.oTypes[A.sType]["sModule"];C.oDiv.childNodes[1].src=pxConst.sModuleUrl+"/"+B+".pxm/graphics/types/"+E+(D?"_opened":"")+".png"}else{C.oDiv.childNodes[1].src=pxConst.sModuleUrl+"/System.pxm/graphics/types/pxDirectory"+(D?"_opened":"")+".png"}},setActiveItem:function(A){if(A){var C=this.getNode(this.sActiveItem);if(C){this.switchIconState(C)}this.sActiveItem=A}var B=this.getNode(this.sActiveItem);if(B.bDirectory){this.switchIconState(B,true)}},collapseAll:function(){for(var B=0,A=this.aItems.length;B<A;B++){if(this.aItems[B].sFilename!="/"){if(this.aItems[B].bExpanded){this.aItems[B].expand()}}}return false},_update:function(J){var H=px.lang.Function;var Q=document;var G;var P=J.substr(J.indexOf(":")+1);var O=this.getNode(P);var N=O.oDiv;if(P!="/"){P+="/";var M=true}else{var M=false}var K=this.oResults[J];if(!K.length||K.length==0){N.firstChild.onclick=null;N.firstChild.src=pxConst.sGraphicUrl+"/dummy16.png";O.bExpanded=false}else{O.bExpanded=true}var I={};if(O.bRendered){for(var R=3,L=N.childNodes.length;R<L;R++){I[P+N.childNodes[R].childNodes[2].firstChild.nodeValue]=true}}for(var F=0,L=K.length;F<L;F++){var C=K[F];var B=P+C.sName;delete I[B];var A=this.getNode(B);if(A){A.iIndex=F;G=A;continue}A=new px.ui.treeview.Node();A.oParent=this;A.sFilename=B;A.bDirectory=C.bDirectory;A.iIndex=F;this.aItems.push(A);A.oDiv=Q.createElement("div");var D=A.oDiv;D.className="pxTreeviewNode";if(M){D.style.marginLeft="1.818em"}if(O.bRendered&&G&&G.oDiv.nextSibling){N.insertBefore(D,G.oDiv.nextSibling)}else{N.appendChild(D)}if(!O.bExpanded){D.style.display="none"}var U=pxp.getExtendedType(C.sType,C.sExtension);var T=pxp.oTypes[C.sType]["sModule"];var S=new Image();if(C.bDirectory){S.src=pxConst.sGraphicUrl+"/expand.png";S.onclick=H.bindEvent(A.expand,A);S.onmouseover=H.bindEvent(A.expandOver,A)}else{S.src=pxConst.sGraphicUrl+"/dummy16.png"}D.appendChild(S);S=new Image();S.src=pxConst.sModuleUrl+"/"+T+".pxm/graphics/types/"+U+".png";D.appendChild(S);var E=document.createElement("a");E.href=pxConst.DUMMY_LINK;E.onclick=H.bindEvent(A.linkClick,A);D.appendChild(E);E.appendChild(Q.createTextNode(C.sName));A.oNameNode=E;D.onclick=H.bindEvent(A.itemClick,A);D.onmouseover=H.bindEvent(A.nodeMouseOver,A);D.onmouseout=H.bindEvent(A.nodeMouseOut,A);D.onmousedown=H.bindEvent(A.mouseDown,A);if(C.bDirectory){D.onmouseup=H.bindEvent(A.nodeMouseUp,A)}G=A}if(O.bRendered){for(var B in I){this.removeNode(B)}}O.bRendered=true;this.setActiveItem();A=null;D=null;S=null;E=null},dragCleanup:function(){px.io.RemoteView.dragCleanup.call(this)},clearSelection:function(){for(var B in this.oSelected){try{this.oSelected[B].oDiv.childNodes[2].className=null}catch(A){}}}});px.Class.define("px.ui.treeview.Node",{extend:px.ui.ListItem,construct:function(){this.bExpanded=false;this.bRendered=false;this.bDirectory=false;this.oDiv;this.oParent;this.sFilename;this.iIndex=-1;this.oNameNode},destruct:function(){this.oDiv.onclick=null;this.oDiv.onmouseover=null;this.oDiv.onmouseout=null;this.oDiv.onmousedown=null;if(this.bDirectory){this.oDiv.onmouseup=null}if(this.oDiv.firstChild.onclick){this.oDiv.firstChild.onclick=null}if(this.oDiv.firstChild.onmouseover){this.oDiv.firstChild.onmouseover=null}if(this.oDiv.childNodes[2].onclick){this.oDiv.childNodes[2].onclick=null}this._disposeFields("oParent","oDiv","oNameNode")}});Object.extend(px.Proto,{expand:function(D){var C=this.oDiv.childNodes;if(this.bExpanded){for(var B=3,A=C.length;B<A;B++){C[B].style.display="none"}this.oDiv.firstChild.src=pxConst.sGraphicUrl+"/expand.png"}else{if(this.bRendered){for(var B=3,A=C.length;B<A;B++){C[B].style.display=""}}else{this.oParent.update({sPath:this.sFilename})}this.oDiv.firstChild.src=pxConst.sGraphicUrl+"/collapse.png"}this.bExpanded=!this.bExpanded;if(D){D.cancelBubble=true}},expandOver:function(A){if(pxp.bDragging&&pxp.sDragType=="item"&&!this.bExpanded&&this.oDiv.firstChild.src.indexOf("dummy")==-1){this.expand(A)}},linkClick:function(A){if(!A.ctrlKey){this.selectItem(A);if(!this.bDirectory){this.oParent.callAction(pxp.oTypes[this.getType()].aDefaultActions[0])}if(this.oParent.onNodeClick){this.oParent.onNodeClick(this)}}A.cancelBubble=true;return false},selectItem:function(C,B){var A=this.oParent;if(this==A.oRootItem){return }if(C.ctrlKey||B){if(A.oSelected[this.sFilename]&&!B){delete A.oSelected[this.sFilename]}else{A.oSelected[this.sFilename]=this}}else{A.clearSelection();A.oSelected={};A.oSelected[this.sFilename]=this}this.oDiv.childNodes[2].className=A.oSelected[this.sFilename]?"selected":""},nodeMouseOver:function(A){A.cancelBubble=true;if(!this.oParent.oSelected[this.sFilename]){if(pxp.bDragging&&pxp.sDragType=="item"&&!pxp.oSelectedControl.oSelected[this.sFilename]&&this.bDirectory&&this.getType()!="pxVirtualDirectory"){this.oDiv.childNodes[2].className="drop"}else{this.oDiv.childNodes[2].className="hover"}}},nodeMouseOut:function(A){A.cancelBubble=true;if(!this.oParent.oSelected[this.sFilename]){this.oDiv.childNodes[2].className=null}},nodeMouseUp:function(A){if(px.html.Element.hasClassName(this.oDiv.childNodes[2],"drop")){px.action.pxObject_editClipboard.itemDrop(this)}}});px.Class.define("px.ui.xplorerview.Xplorerview",{extend:px.io.RemoteView,construct:function(A){this.base(arguments,A);this.oParameters.bFull=true;this.oParameters.sAction="_openNew";this.oItems={};this.bSelection=true;this.onNodeClick},destruct:function(){this._disposeFields("oForm","oObject","onNodeClick");this._disposeContents("oItems")}});Object.extend(px.Proto,{clear:function(){for(var A in this.oItems){this.oItems[A].dispose()}},init:function(A,B){this.oParentNode=A;this.oForm=document.createElement("form");this.oForm.method="post";this.oForm.action=pxp.sUrl;this.oForm.className="xplorerview";this.oParentNode.appendChild(this.oForm);if(B){this._build()}},_checkId:function(B){var F=B.split(".");if(!pxp.oTypes[F[0]]){return false}if(F.length>1){var E=false;var D=pxp.oTypes[F[0]].aActions;for(var C=0,A=D.length;C<A;C++){if(pxp.oActions[D[C]][2]==F[1]){E=true;break}}if(!E){return false}}if(F.length>2){if(!px.lang.Array.contains(pxp.oTypes[F[0]].aActions,F[2])){return false}}return true},save:function(){var D=[];for(var C in this.oObject.aPermissions){if(this._checkId(C)){D.push(encodeURIComponent(C))}}var B=[];for(var C in this.oObject.aEvents){if(this._checkId(C)){B.push(C+"|"+this.oObject.aEvents[C])}}var A=this._save({sAction:"edit"},"sPermissions="+encodeURIComponent(D.join("|"))+"&sEvents="+encodeURIComponent(B.join("||")));if(A.bOk){pxp.refreshView(px.util.dirname(this.oParameters.sPath))}return false},_build:function(){var B=new Array("pxGlobal","pxObject");for(var C=0,A=B.length;C<A;C++){var D=B[C];this.oItems[D]=new px.ui.xplorerview.Type(D,this,this.oForm)}},_update:function(A){if(this.oForm.childNodes.length>0){this.clear()}this.oObject=this.oResults[this.oParameters.getPath()][0];this._build();for(var B in this.oObject.aPermissions){this._expandId(B)}for(var B in this.oObject.aEvents){this._expandId(B)}},_expandId:function(A){var C=A.split(".");this._expandSupertypes(C[0]);if(C.length>1){var B=this.oItems[C[0]];if(!B.bGroupsExpanded){B.expandGroups()}}if(C.length>2){var B=this.oItems[C[0]+"."+C[1]];if(!B.bExpanded){B.expand()}}},_expandSupertypes:function(E){if(this.oItems[E]){return }var F=pxp.oTypes[E].aSupertypes;for(var B=0,A=F.length;B<A;B++){var D=F[B];var C=this.oItems[D];if(!C.bExpanded){C.expand()}}}});px.Class.define("px.ui.xplorerview.Item",{extend:px.core.Object,type:"abstract",construct:function(B,I,G,E,C){var K=px.lang.Function;var J=px.html.Element;this.bRendered=false;this.bExpanded=false;this.sId=B;this.oParent=I;this.oParentNode=G;this.oDiv=document.createElement("div");var A=this.oDiv;A.className="xplorerNode";this.oParentNode.appendChild(A);this.oExpandImage1=new Image();var H=this.oExpandImage1;H.className="expand";if(this.hasChildren()){H.src=pxConst.sGraphicUrl+"/expand.png";A.appendChild(H);H.onclick=K.bind(this.expand,this)}else{H.src=pxConst.sGraphicUrl+"/dummy16.png";A.appendChild(H)}if(this.oParent.bSelection){this.oCheckbox=document.createElement("input");this.oCheckbox.type="checkbox";A.appendChild(this.oCheckbox);this.oCheckbox.onclick=K.bind(this.selectionChanged,this)}var F=new Image();F.src=pxConst.sGraphicUrl+"/"+E;F.title=B;A.appendChild(F);this.oA=document.createElement("a");if(this.oParent.onNodeClick){this.oA.href=pxConst.DUMMY_LINK;this.oA.onclick=K.bind(px.ui.xplorerview.Item._itemClick,this)}A.appendChild(this.oA);this.oA.appendChild(document.createTextNode(C));if(this.oParent.oObject.aEvents[this.sId]){J.appendImage(A,pxConst.sGraphicUrl+"/bulletGo.png")}if(this.expandGroups){this.oExpandImage2=new Image();var D=this.oExpandImage2;D.className="expand";D.src=pxConst.sGraphicUrl+"/expand.png";A.appendChild(D);D.onclick=K.bind(this.expandGroups,this);this.oDivActionGroups=document.createElement("div");this.oDivActionGroups.style.display="none";this.oDivActionGroups.className="xplorerNode";A.appendChild(this.oDivActionGroups)}this.oDivChildren=document.createElement("div");A.appendChild(this.oDivChildren);if(this.oParent.oObject.aPermissions[B]){this.oCheckbox.checked=true;J.addClassName(A,"selected");J.addClassName(this.oA,"selected")}},destruct:function(){this._disposeFields("oParent","oParentNode","oDiv","oDivChildren","oDivActionGroups","oA","oCheckbox","oExpandImage1","oExpandImage2")}});Object.extend(px.Statics,{_itemClick:function(){var A=px.html.Element;var B=this.oParent;if(B.oActiveItem){A.removeClassName(B.oActiveItem.oA,"active")}B.oActiveItem=this;A.addClassName(B.oActiveItem.oA,"active");if(this.oParent.onNodeClick){this.oParent.onNodeClick(this)}}});Object.extend(px.Proto,{selectionChanged:function(){var A=px.html.Element;if(this.oCheckbox.checked){A.addClassName(this.oDiv,"selected");A.addClassName(this.oA,"selected");this.oParent.oObject.aPermissions[this.sId]=true}else{A.removeClassName(this.oDiv,"selected");A.removeClassName(this.oA,"selected");delete this.oParent.oObject.aPermissions[this.sId]}},expand:function(){var C=px.html.Element;if(this.bRendered){this.bExpanded=!this.bExpanded;this.oDivChildren.style.display=this.bExpanded?"":"none"}else{var B=false;for(var A in pxp.oTypes){if(pxp.oTypes[A].sSupertype==this.sId){this.oParent.oItems[A]=new px.ui.xplorerview.Type(A,this.oParent,this.oDivChildren);if(!B){C.addClassName(this.oParent.oItems[A].oDiv,"firstNode");B=true}}}this.bRendered=this.bExpanded=true}this.oExpandImage1.src=pxConst.sGraphicUrl+(this.bExpanded?"/collapse.png":"/expand.png")}});px.Class.define("px.ui.xplorerview.Type",{extend:px.ui.xplorerview.Item,construct:function(B,C,A){this.bGroupsRendered=this.bGroupsExpanded=false;this.base(arguments,B,C,A,pxp.oTypes[B].bAbstract?"pxAbstract.png":"pxType.png",B)}});Object.extend(px.Proto,{hasChildren:function(){for(var A in pxp.oTypes){if(pxp.oTypes[A].sSupertype==this.sId){return true}}return false},expandGroups:function(){if(this.bGroupsRendered){this.bGroupsExpanded=!this.bGroupsExpanded}else{var E={};for(var B=0,A=pxp.oTypes[this.sId].aActions.length;B<A;B++){E[pxp.oActions[pxp.oTypes[this.sId].aActions[B]][2]]=true}for(var D in E){var C=this.sId+"."+D;this.oParent.oItems[C]=new px.ui.xplorerview.Actiongroup(C,this.oParent,this.oDivActionGroups)}this.bGroupsRendered=this.bGroupsExpanded=true}this.oDivActionGroups.style.display=this.bGroupsExpanded?"":"none";this.oExpandImage2.src=pxConst.sGraphicUrl+(this.bGroupsExpanded?"/collapse.png":"/expand.png")}});px.Class.define("px.ui.xplorerview.Action",{extend:px.ui.xplorerview.Item,construct:function(A,C,B){this.base(arguments,A,C,B,"pxAction.png",oTranslation["action."+A.split(".")[2]])}});Object.extend(px.Proto,{hasChildren:function(){return false}});px.Class.define("px.ui.xplorerview.Actiongroup",{extend:px.ui.xplorerview.Item,construct:function(A,C,B){this.bGroupsRendered=this.bGroupsExpanded=false;this.base(arguments,A,C,B,"pxActiongroup.png",oTranslation[A.split(".")[1]])}});Object.extend(px.Proto,{hasChildren:function(){return true},expand:function(){var H=px.html.Element;if(this.bRendered){this.bExpanded=!this.bExpanded;this.oDivChildren.style.display=this.bExpanded?"":"none"}else{var F=this.sId.split(".");var C=F[0];var B=F[1];var A=false;for(var J=0,G=pxp.oTypes[C].aActions.length;J<G;J++){var I=pxp.oTypes[C].aActions[J];var E=pxp.oActions[I][2];if(E!=B){continue}var D=C+"."+E+"."+I;this.oParent.oItems[D]=new px.ui.xplorerview.Action(D,this.oParent,this.oDivChildren);if(!A){H.addClassName(this.oParent.oItems[D].oDiv,"firstNode");A=true}}this.bRendered=this.bExpanded=true}this.oExpandImage1.src=pxConst.sGraphicUrl+(this.bExpanded?"/collapse.png":"/expand.png")}});px.Class.define("px.ui.xplorerview.Propertyview",{extend:px.core.Object,construct:function(A){this.oParent=A;this.sCurrentId},destruct:function(){this.oEventLabel.onclick=null;this.oEvent.onchange=null;this._disposeFields("oParent","oParentNode","oEventLabel","oEvent")}});Object.extend(px.Statics,{_eventLabelClick:function(A){pxp.oSelectedControl=this;var B=px.ui.ContextMenu;B.clear();B.addItem("action","Aktion ausl\xf6sen",pxConst.sGraphicUrl+"/types/pxAction_pxAction.php.png",false);B.addItem("email","E-Mail senden",pxConst.sGraphicUrl+"/actions/pxGlobal_sendMail.png",false);B.show(A)},_eventCodeChange:function(){var C=this.oParent.oXplorerview;var B=C.oActiveItem;if(B){var A=B.sId;if(this.oEvent.value!=""){if(!C.oObject.aEvents[A]){if(B.oA.nextSibling){px.html.Element.appendImage(B.oDiv,pxConst.sGraphicUrl+"/bulletGo.png",B.oA.nextSibling)}else{px.html.Element.appendImage(B.oDiv,pxConst.sGraphicUrl+"/bulletGo.png")}}C.oObject.aEvents[A]=this.oEvent.value}else{if(C.oObject.aEvents[A]){B.oDiv.removeChild(B.oA.nextSibling)}delete C.oObject.aEvents[A]}}}});Object.extend(px.Proto,{init:function(B){this.oParentNode=B;px.html.Element.addClassName(this.oParentNode,"pxXplorerview");this.oEventLabel=document.createElement("label");var A=this.oEventLabel;this.oParentNode.appendChild(A);A.appendChild(document.createTextNode(oTranslation["aEvents"]));A.onclick=px.lang.Function.bindEvent(px.ui.xplorerview.Propertyview._eventLabelClick,this);this.oEvent=document.createElement("textarea");this.oEvent.cols=40;this.oEvent.rows=9;this.oParentNode.appendChild(this.oEvent);this.oEvent.onchange=px.lang.Function.bind(px.ui.xplorerview.Propertyview._eventCodeChange,this)},callAction:function(A){switch(A){case"email":this.oEvent.value='<action id="sendMail">\n  <param id="from"></param>\n  <param id="to"></param>\n  <param id="cc"></param>\n  <param id="bcc"></param>\n  <param id="subject"></param>\n  <param id="text"></param>\n</action>';break;case"action":this.oEvent.value='<action id="">\n  <param id=""></param>\n</action>';break}},resize:function(A){this.oEvent.style.width=this.oParentNode.offsetWidth-30+"px";this.oEvent.style.height=this.oParentNode.offsetHeight-30+"px"}});px.Class.define("px.ui.widget.Widget",{extend:px.core.Object,construct:function(A,E,D,C,B){this._oParent=A;this._oParentNode=E;this._sType=D;this._sProperty=C;this._oProperty=pxp.oTypes[D].aProperties[C];this._mDefaultValue=B;this._bEdit=this._oProperty.sMode=="edit"&&!A.bReadonly;this._onchange=px.lang.Function.bind(this._setChanged,this)},destruct:function(){if(this._oWidget){if(this._oWidget.onchange){this._oWidget.onchange=null}if(this._oWidget.onkeyup){this._oWidget.onkeyup=null}this._oWidget=null}this._disposeFields("_oParent","_oParentNode","_oProperty","_mDefaultValue","_onchange")}});Object.extend(px.Proto,{_setChanged:function(){this._oParent.oParent.setChanged(true)}});px.Class.define("px.ui.widget.Select",{extend:px.ui.widget.Widget,construct:function(J,I,H,G,F){this.base(arguments,J,I,H,G,F);if(this._bEdit){var E=this._oProperty.oOptions;this._oWidget=document.createElement("select");var D=this._oWidget;D.name="px_"+G;D.size=1;I.appendChild(D);D.onchange=this._onchange;if(E instanceof Array){for(var A=0,B=E.length;A<B;A++){var C=new Option(E[A],A);D.options[D.options.length]=C;C.selected=F==A}}else{for(var A in E){var C=new Option(E[A],A);D.options[D.options.length]=C;C.selected=F==A}}}else{I.appendChild(document.createTextNode(F))}}});px.Class.define("px.ui.widget.SelectTranslated",{extend:px.ui.widget.Select,construct:function(F,D,J,I,H){this.base(arguments,F,D,J,I,H);var G=D.firstChild.options;for(var E=0,B=G.length;E<B;E++){var A=G[E].text;var C=this._oProperty.aParameters["namespace"]||String("option");G[E].text=oTranslation[C+"."+A]||A}}});px.Class.define("px.ui.widget.SelectManualOptions",{extend:px.ui.widget.Select,construct:function(C,B,A,H,G){if(C.oObject.bNew){this.base(arguments,C,B,A,H,G);this._oButton=document.createElement("button");var F=this._oButton;B.appendChild(F);F.appendChild(document.createTextNode("..."));F.onclick=px.lang.Function.bind(this._loadOptions,this)}else{var E=G==null?"":String(G);B.appendChild(document.createTextNode(E));var D=document.createElement("input");D.name="px_"+H;D.type="hidden";D.value=E;B.appendChild(D)}},desruct:function(){if(this._oButton){this._oButton.onclick=null;this._disposeFields("_oButton")}}});Object.extend(px.Proto,{_loadOptions:function(){var H=this._oParent.oObject;var G=this._oButton;G.disabled=true;G.style.display="none";var F=G.previousSibling;var E=H.sRelDir;var D=H.sName;var C=px.util.buildPath(E,D);var B="sRelDir";var A=px.io.Request.get("sAction=_openOptions&sShare="+encodeURIComponent(H.sShare)+"&sPath="+encodeURIComponent(C)+"&sProperty="+B+"&sType="+H.sType);for(var I in A){var K=A[I];var J=new Option(K,I);F.options[F.options.length]=J}return false}});px.Class.define("px.ui.widget.Multiple",{extend:px.ui.widget.Widget,construct:function(I,G,E,C,B){this.base(arguments,I,G,E,C,B);var K=px.lang.Array;var J=this._oProperty;var H=J.oOptions;this._oTagList=document.createElement("ul");var F=this._oTagList;F.className="checklist checklistFloat";if(J.aParameters["size"]){var D=J.aParameters["size"]}else{var D=px.util.getLength(H);if(D>7){D=7}if(D==0){D=1}}F.style.height=D*2.05+0.4+"em";G.appendChild(F);for(var A in H){this.addItem(A,H[A],K.contains(B,A))}},destruct:function(){for(var B=0,A=this._oParentNode.firstChild.childNodes.length;B<A;B++){var C=this._oParentNode.firstChild.childNodes[B];if(C.firstChild.onmouseover){C.firstChild.onmouseover=null}if(C.firstChild.onmouseout){C.firstChild.onmouseout=null}C.firstChild.firstChild.onchange=null}this._disposeFields("_oTagList")}});Object.extend(px.Proto,{resize:function(){if(this._bResized){return }var E=this._oTagList;var B=0;for(var D=0,A=E.childNodes.length;D<A;D++){var C=E.childNodes[D].offsetWidth;if(C>B){B=C}}if(B==0){return }B+=8;for(var D=0,A=E.childNodes.length;D<A;D++){if(B>0){E.childNodes[D].style.width=B+"px"}}this._bResized=true},addItem:function(A,H,D){var B=px.lang.Function;var C=px.util.getRandomId();var F=document.createElement("li");this._oTagList.appendChild(F);var G=document.createElement("label");G.htmlFor=C;F.appendChild(G);if(pxp.bIe){G.onmouseover=B.bindEvent(this._itemMouseOver,G);G.onmouseout=B.bindEvent(this._itemMouseOut,G)}var E=document.createElement("input");E.type="checkbox";E.id=C;E.name="px_"+this._sProperty+"[]";E.value=A;G.appendChild(E);E.checked=D;G.appendChild(document.createTextNode(H));E.onchange=this._onchange;E.disabled=!this._bEdit},_itemMouseOver:function(){this.className="hover"},_itemMouseOut:function(){this.className=null}});px.Class.define("px.ui.widget.MultipleTranslated",{extend:px.ui.widget.Multiple,construct:function(L,K,J,I,F){this.base(arguments,L,K,J,I,F);var D=this._oProperty.aParameters["namespace"];var B=K.firstChild;for(var M=0,H=B.childNodes.length;M<H;M++){var A=B.childNodes[M];var G=A.firstChild.childNodes[1];var E=G.nodeValue;var C=D?D+"."+E:aOptions[M].text;G.nodeValue=oTranslation[C]||E}}});px.Class.define("px.ui.widget.Checkbox",{extend:px.ui.widget.Widget,construct:function(E,D,B,C,A){this.base(arguments,E,D,B,C,A);this._oWidget=document.createElement("input");var F=this._oWidget;F.name="px_"+C;F.type="checkbox";F.value="true";D.appendChild(F);F.checked=A;F.onchange=this._onchange;F.disabled=!this._bEdit}});px.Class.define("px.ui.widget.Datetime",{extend:px.ui.widget.Widget,construct:function(G,F,E,D,C){this.base(arguments,G,F,E,D,C);var B=C?px.util.Format.datetime(C):"";if(this._bEdit){this._oWidget=document.createElement("input");var A=this._oWidget;A.name="px_"+D+"_formated";A.type="text";A.value=B;A.size=20;F.appendChild(A);A.onkeyup=this._changed;A.onchange=this._onchange;A=null;F.appendChild(document.createTextNode(" "));var A=document.createElement("input");A.name="px_"+D;A.type="text";A.value=C;A.size=12;F.appendChild(A)}else{F.appendChild(document.createTextNode(B))}}});Object.extend(px.Proto,{_changed:function(B){var A=px.Event.element(B);A.nextSibling.nextSibling.value=px.util.parseDateTime(A.value)}});px.Class.define("px.ui.widget.Input",{extend:px.ui.widget.Widget,construct:function(I,H,G,F,E,D){this.base(arguments,I,H,G,F,E);var C=E==null?"":String(E);if(this._bEdit){this._oWidget=document.createElement("input");var B=this._oWidget;B.name="px_"+F;B.type=D?"password":"text";B.value=C;B.size=this._calculateSize();H.appendChild(B);B.onkeyup=px.lang.Function.bind(this._resize,this);B.onchange=this._onchange;B=null}else{H.appendChild(document.createTextNode(C))}var A=this._oProperty.aParameters["unit"];if(A){H.appendChild(document.createTextNode(" "+A))}}});Object.extend(px.Proto,{_resize:function(){this._oWidget.size=this._calculateSize()},_calculateSize:function(){var B=this._oWidget.value;if(B.length>0){var A=Math.round(B.length*1.2);if(A>60){A=60}if(A<8){A=8}return A}else{return 8}}});px.Class.define("px.ui.widget.InputTranslated",{extend:px.ui.widget.Input,construct:function(E,C,A,G,F){this.base(arguments,E,C,A,G,F,false);var D=this._oProperty.aParameters["namespace"];var B=oTranslation[(D!=""?D+".":"")+F];if(this._bEdit){this._oWidget.value=B}else{C.firstChild.nodeValue=B}}});px.Class.define("px.ui.widget.Password",{extend:px.ui.widget.Input,construct:function(E,C,D,B,A){this.base(arguments,E,C,D,B,A,true)}});px.Class.define("px.ui.widget.Textarea",{extend:px.ui.widget.Widget,construct:function(G,F,D,C,B){this.base(arguments,G,F,D,C,B);var A=this._oProperty;var I=A.aParameters;if(B){if(B instanceof Array){var H=String(B.join(String.fromCharCode(13)))}else{if(B instanceof Object){var H=""}else{var H=String(B)}}}else{var H=""}if(this._bEdit){this._oWidget=document.createElement("textarea");var E=this._oWidget;E.name="px_"+C;E.cols=I.cols||60;E.rows=I.rows||6;if(!I.nowrap){E.setAttribute("wrap","off");E.style.overflow="auto"}E.value=H;F.appendChild(E);E.onchange=this._onchange;E=null}else{F.appendChild(document.createTextNode(H))}}});Object.extend(px.Proto,{resize:function(){if(this._bEdit){var A=this._oParent.oParentNode.offsetWidth-this._oParentNode.offsetLeft-35;if(A>0){this._oParentNode.firstChild.style.width=A-10+"px"}}}});px.Class.define("px.ui.widget.Array",{extend:px.ui.widget.Textarea,construct:function(E,C,A,D,B){this.base(arguments,E,C,A,D,B)}});px.Class.define("px.ui.widget.ImageClipping",{extend:px.ui.widget.Input,construct:function(F,E,D,C,B){this.base(arguments,F,E,D,C,B);if(this._bEdit){var A=document.createElement("button");E.appendChild(A);A.appendChild(document.createTextNode(oTranslation["choose"]));A.onclick=px.lang.Function.bindEvent(this._showPicker,F)}},destruct:function(){if(this._bEdit){this._oParentNode.childNodes[1].onclick=null}}});Object.extend(px.Proto,{_showPicker:function(A){var C=px.Event.element(A);var B=window.open("./modules/System.pxm/includes/imageClipper.php");pxp.oData["temp.oTargetElement"]=C.previousSibling;pxp.oData["temp.sImageUrl"]=this.oParent.oShare.sUrl+this.oParameters.sPath;return false}});px.Class.define("px.html.Form");Object.extend(px.Statics,{aIgnoreTypes:["file","submit","image","reset","button"],serialize:function(G){var E=px.lang.Array;var C=[];for(var I=0,H=G.elements.length;I<H;I++){var B=G.elements[I];var A=B.name;if(A&&B.type){if(E.contains(this.aIgnoreTypes,B.type)){continue}switch(B.type){case"checkbox":case"radio":if(B.checked){C.push(A+"="+encodeURIComponent(B.value))}break;case"select-multiple":for(var F=0,D=B.options.length;F<D;F++){if(B.options[F].selected){C.push(A+"="+encodeURIComponent(B.options[F].value))}}break;default:C.push(A+"="+encodeURIComponent(B.value));break}}}return C.join("&")},disable:function(D){for(var C=0,A=D.elements.length;C<A;C++){var B=D.elements[C];B.blur();B.disabled=true}},enable:function(B){for(var C=0,A=B.elements.length;C<A;C++){B.elements[C].disabled=null}},activate:function(A){try{A.focus();A.select()}catch(B){}}});px.Class.define("px.html.Element");Object.extend(px.Statics,{addClassName:function(C,B){var A=C.className.split(/\s+/);if(!px.lang.Array.contains(A,B)){A.push(B);C.className=A.join(" ")}},removeClassName:function(B,C){var A=B.className.split(/\s+/);px.lang.Array.remove(A,C);B.className=A.join(" ")},hasClassName:function(C,B){var A=C.className.split(/\s+/);return px.lang.Array.contains(A,B)},appendImage:function(F,A,D,C,B){var E=new Image();if(pxp.bIe&&A.indexOf(".png")>-1){E.src=pxConst.sGraphicUrl+"/dummy.png";E.style.filter=pxConst.ALPHA_IMAGE_START+A+pxConst.ALPHA_IMAGE_STOP}else{E.src=A}if(C){E.style.width=C+"px";E.style.height=C+"px"}if(B){E.className=B}if(D){return F.insertBefore(E,D)}else{return F.appendChild(E)}},changeImage:function(B,A){if(pxp.bIe&&A.indexOf(".gif")==-1){B.style.filter=pxConst.ALPHA_IMAGE_START+A+pxConst.ALPHA_IMAGE_STOP}else{B.src=A}},getLeftOffset:function(C,B){var A=0;for(var D=C;D;D=D.offsetParent){A+=D.offsetLeft;if(B&&D==B){break}}return A},getTopOffset:function(C,B){var A=0;for(var D=C;D;D=D.offsetParent){A+=D.offsetTop;if(B&&D==B){break}}return A},hideElements:function(B){var A=document.getElementsByTagName(B);for(var C=0;C<A.length;C++){A[C].style.visibility="hidden"}},showElements:function(B){var A=document.getElementsByTagName(B);for(var C=0;C<A.length;C++){if(A[C].style.visibility){A[C].style.visibility=""}}},hide:function(A){A.style.display="none"},show:function(A){A.style.display=""},switchElement:function(A){A.style.display=A.style.display=="none"?"":"none"},setOpacity:function(C,A){var B=C.style;if(B.MozOpacity!=undefined){B.MozOpacity=A}else{if(B.filter!=undefined){B.filter="alpha(opacity=0)";C.filters.alpha.opacity=A*100}else{if(B.opacity!=undefined){B.opacity=A}}}}});px.Class.define("px.lang.Array");Object.extend(px.Statics,{remove:function(D,B){for(var C=0,A=D.length;C<A;C++){if(D[C]==B){D.splice(C,1);break}}},contains:function(A,C){if(A.length){for(var B=0;B<A.length;B++){if(A[B]==C){return true}}}return false}});px.Class.define("px.lang.Function");Object.extend(px.Statics,{bind:function(D,C,A){if(arguments.length>2){var B=Array.prototype.slice.call(arguments,2);return function(){return D.apply(C,B.concat(Array.prototype.slice.call(arguments,0)))}}else{return function(){return D.apply(C,arguments)}}},bindEvent:function(B,A){return function(C){return B.call(A,C||window.event)}},cancelEvent:function(A){var A=A||window.event;if(A.preventDefault){A.preventDefault();A.stopPropagation()}else{A.returnValue=false;A.cancelBubble=true}return false},returnFalse:function(){return false}});px.Class.define("px.Event");Object.extend(px.Statics,{element:function(A){return A.target||A.srcElement},_aListeners:[],_addAndCache:function(D,C,B,A){if(D.attachEvent){D.attachEvent("on"+C,B)}else{D.addEventListener(C,B,A)}px.Event._aListeners.push([D,C,B,A])},unloadCache:function(){var B=px.Event;for(var C=0,A=B._aListeners.length;C<A;C++){B.removeListener.apply(this,B._aListeners[C]);B._aListeners[C][0]=null}B._aListeners=null},addListener:function(D,C,B,A){px.Event._addAndCache(D,C,B,A||false)},removeListener:function(A,E,D,C){if(A.removeEventListener){A.removeEventListener(E,D,C||false)}else{if(A.detachEvent){try{A.detachEvent("on"+E,D)}catch(B){}}}},pointerX:function(A){return A.pageX||(A.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft))},pointerY:function(A){return A.pageY||(A.clientY+(document.documentElement.scrollTop||document.body.scrollTop))}});px.Class.define("px.Action",{extend:px.core.Object,construct:function(C,B,A){this.sId=C;this.oParent=B;this.oParentNode=A;this.sTitle;this.sIcon;this.oChild;this.sBaseAction;this.sModule;this.bInitialized=false;this.oToolbar=this.oParent.oToolbars[C];try{this.oShare=this.oParent.oParent.oShare}catch(D){}this.oDiv=document.createElement("div");this.oDiv.className="pxAction "+this.oParent.sClass;this.oParentNode.appendChild(this.oDiv);this.resize(true)},destruct:function(){if(this._oBorder){this._disposeFields("_oBorder")}this._disposeFields("oParent","oParentNode","oDiv","_oFrame","oToolbar","oShare");this._disposeObjects("oChild")}});Object.extend(px.Proto,{addBorder:function(){this._oBorder=document.createElement("div");this._oBorder.className="contentFrame";return this.oDiv.appendChild(this._oBorder)},resize:function(A){var B=this.oParentNode.offsetHeight-this.oDiv.offsetTop;if(B>0){this.oDiv.style.height=B+"px"}if(this.oChild){this.oChild.resize(A)}if(!this._bResizing){this._bResizing=true;if(this._resizeStart){this._resizeStart()}}if(A){if(this._resizeStop){this._resizeStop()}delete this._bResizing}},save:function(){if(this.oParent.saveNew(this)){if(this.oChild&&this.oChild.save){this.oChild.save()}}return false},setChanged:function(A){this.oParent.oParent.setChanged(this.sId,A)},rename:function(B){var A=this.oChild2||this.oChild;if(A){if(A.oParameters){A.oParameters.sPath=B}if(A.rename){A.rename(B)}}}});px.Class.define("px.action.pxDirectories___open",{extend:px.Action,construct:function(A,F,E,D,C){this.base(arguments,A,F,E);var B=px.lang.Function;this.oChild=new C(this,this.oDiv);this.oChild.onDirChange=B.bind(this.onDirChange,this);this.oChild.iObjectsPerPage=this.oShare.iObjectsPerPage;if(D){this.oChild.oParameters.set(D)}else{if(this.oParent.oPrevious){this.oChild.oParameters.sync(this.oParent.oPrevious.oChild.oParameters)}}this.oToolbar.addButton({sId:"dirUp",sLabel:"Aufw\xe4rts",sIcon:"toolbar/dirUp.png",oOnClick:B.bindEvent(this.oChild.dirUp,this.oChild),sTitle:oTranslation["toolbar.dirUp"],bDisabled:true});this.oToolbar.addButton({sId:"create",sLabel:oTranslation["action.pxGlobal_openCreate"],sIcon:"toolbar/create.png",oOnClick:B.bindEvent(px.action.pxGlobal_openCreate.showMenu,this)});this.oToolbar.addButton({sId:"upload",sIcon:"toolbar/upload.png",sLabel:oTranslation["toolbar.upload"],oOnClick:px.action.pxDirectories_uploadHtml.run});this.oToolbar.addButton({sId:"share",sIcon:"toolbar/share.png",sLabel:oTranslation["toolbar.share"],oOnClick:px.action.pxDirectories__editShare.run});this.oToolbar.addButton({sId:"clipboard",sLabel:oTranslation["toolbar.clipboard"],sIcon:"toolbar/clipboard.png",sIconOver:"clipboardOver.png",oOnClick:B.bindEvent(px.action.pxObject_editClipboard.showMenu,this),bDropDown:true,oDropHandler:px.action.pxObject_editClipboard});if(pxp.aClipboard.length==0){this.oToolbar.oButtons["clipboard"].hideDropDown()}this.oToolbar.addButton({sId:"cancel",sIcon:"toolbar/cancel.png",sLabel:oTranslation["toolbar.cancel"],oOnClick:B.bindEvent(this._cancelSelection,this)});this.oToolbar.hideButton("upload");this.oToolbar.hideButton("create");this.oToolbar.hideButton("clipboard");this.oToolbar.hideButton("share");this.oToolbar.hideButton("cancel")}});Object.extend(px.Statics,{changeDirectory:function(E){var A=px.Event.element(E);var D=this.oParent.oParent.oToolbar.oButtons;for(var C in D){if(D[C].oA==A){var B=D[C].sId.substr(D[C].sId.indexOf("_")+1);this.oChild.oParameters.sPath=B;this.oChild.update()}}return false}});Object.extend(px.Proto,{onDirChange:function(){this.oParent.oParent.cancelSearch()},updateInterface:function(){var H=px.lang.Function;var F=this.oChild.oParameters.sPath;if(F!="/"){this.oToolbar.enableButton("dirUp")}else{this.oToolbar.disableButton("dirUp")}var D=this.oChild.oSettings[this.oChild.oParameters.getPath()];this.oParent.aAllowedActions=D.aAllowedActions[D.sDirectoryType];var C=this.oChild.oParameters.sSearchQuery;var B=D.bCreatePermission&&!C;var K=D.bUploadPermission&&!C&&pxp.oData.bUpload;var J=B||K;var I=D.bSharePermission&&!C;var P=this.oToolbar;K?P.showButton("upload"):P.hideButton("upload");B?P.showButton("create"):P.hideButton("create");J?P.showButton("clipboard"):P.hideButton("clipboard");I?P.showButton("share"):P.hideButton("share");C?P.showButton("cancel"):P.hideButton("cancel");for(var G in this.oParent.oParent.oToolbar.oButtons){if(G.indexOf("pxPath")==0){this.oParent.oParent.oToolbar.removeButton(G)}}var E="/";if(F!="/"){var Q=F.split("/");for(var R=1,L=Q.length;R<L;R++){E=px.util.buildPath(E,Q[R]);this.oParent.oParent.oToolbar.addButton({sId:"pxPath_"+E,sLabel:"/ "+Q[R],oOnClick:H.bindEvent(px.action.pxDirectories___open.changeDirectory,this)})}}var O=this.oParent.oParent.oActionviewSelection.oActions;if(O.pxDirectories_selectTags&&O.pxDirectories_selectTags.bInitialized){O.pxDirectories_selectTags.loadTags()}if(O.pxDirectories_selectTree&&O.pxDirectories_selectTree.bInitialized){var N=O.pxDirectories_selectTree.oChild;var F=this.oChild.oParameters.sPath;var A=F.lastIndexOf("/");if(A>0){var M=N.getNode(F.substr(0,A));if(!M.bExpanded){M.expand()}}N.setActiveItem(F)}},_cancelSelection:function(){var B=this.oParent.oParent;B.cancelSearch(false);var A=B.oActionviewSelection.oActions.pxDirectories_selectTags;if(A&&A.bInitialized){A.clearTagSelection(false)}B.updateSearch();return false}});px.Class.define("px.action.pxDirectories_selectTree",{extend:px.Action,construct:function(E,F,D,C){this.base(arguments,E,F,D);var B=this.oShare.sId;var A=oTranslation["share."+B]||pxp.oData.aBookmarks[B]||B;this.oChild=new px.ui.treeview.Treeview(this,this.oDiv,A);var G=this.oChild;G.onNodeClick=px.lang.Function.bind(this._onNodeClick,this);G.oParameters.sShare=this.oShare.sId;G.oParameters.bOnlyDirectories=!this.oShare.bFullTree;G.update()}});Object.extend(px.Proto,{_onNodeClick:function(A){if(A.bDirectory){var C=this.oParent.oParent.oActionviewList;if(C){var B=C.oSelected.oChild;B.oParameters.sPath=A.sFilename;B.update();if(B.onDirChange){B.onDirChange()}}}}});px.Class.define("px.action.pxDirectories_openPreview",{extend:px.action.pxDirectories___open,construct:function(A,E,D,C){this.base(arguments,A,E,D,C,px.ui.gallery.Galleryview);var B=this.oChild;B.oParameters.sShare=this.oShare.sId;B.update()}});px.Class.define("px.action.pxMetaDirectories_openDetails",{extend:px.action.pxDirectories___open,construct:function(B,A,E,D){this.base(arguments,B,A,E,D,px.ui.listview.Listview);var C=this.oChild;C.oParameters.sShare=this.oShare.sId;C.addColumn("sName",250,"link","left");C.addColumn("iBytes",70,"text","right",px.util.Format.number);C.addColumn("dModified",140,"text","left",px.util.Format.datetime);C.addColumn("sType",140,"type","left");C.update()}});px.Class.define("px.action.pxDirectories___upload");Object.extend(px.Statics,{run:function(I,H){var F=pxp.oShareview.oSelected.oShare.sId;var E=pxp.getListview();var D=E.oParameters.sPath;var C=H||"uploadHtml";if(I.bControl){for(var B in E.oSelected){D=B;break}}var G=(document.body.offsetHeight/2)-240;var A=(document.body.offsetWidth*0.4)-320;var J=window.open("./action.php?sShare="+F+"&sAction="+C+"&sPath="+encodeURIComponent(D),px.util.getRandomId(),"top="+G+",left="+A+",width=640,height=480,scrollbars=yes,resizable=yes");return false}});px.Class.define("px.action.pxMetaFiles_openDownload");Object.extend(px.Statics,{run:function(B){if(px.util.getLength(B.oSelected)==1){for(var A in B.oSelected){location.href=this.getUrl(B,A)}}else{for(var A in B.oSelected){window.open(this.getUrl(B,A),px.util.getRandomId())}}},getUrl:function(A,B){return"./action.php?sShare="+A.oParent.oShare.sId+"&sAction=openDownload&sPath="+encodeURIComponent(A.oSelected[B].sFilename)}});px.Class.define("px.action.pxFiles__openInline",{extend:px.Action,construct:function(B,E,D,C){this.base(arguments,B,E,D);this.oDiv.style.overflow="hidden";this.oIframe=document.createElement("iframe");this.oIframe.border=0;this.oIframe.frameBorder=0;this.oDiv.appendChild(this.oIframe);var A=C?C.sPath:"dummy.php";if(this.oShare){this.oIframe.src=px.util.buildPath(this.oShare.sUrl,A)}else{this.oIframe.src=A}},destruct:function(){this._disposeFields("oIframe")}});Object.extend(px.Proto,{_resizeStart:function(){if(this.oIframe){px.html.Element.hide(this.oIframe)}},_resizeStop:function(){if(this.oIframe){px.html.Element.show(this.oIframe)}}});px.Class.define("px.action.pxMetaFiles_openView");Object.extend(px.Statics,{run:function(D,C){for(var B in D.oSelected){var A=D.oSelected[B];window.open("./action.php?sShare="+D.oParent.oShare.sId+"&sAction="+(C||"openView")+"&sPath="+encodeURIComponent(A.sFilename),px.util.getRandomId(),"toolbar=no,location=yes,menubar=yes,resizable=yes,scrollbars=yes")}return false}});px.Class.define("px.action.pxFiles_openPreview");Object.extend(px.Statics,{bInitialized:false,oLightbox:null,oCurrentView:null,oActiveImage:null,_oLoadingImage:new Image(),sCurrentImage:null,init:function(){if(this.bInitialized){return }var A=px.lang.Function;this.oLightbox=$("lightbox");var B=this.oLightbox;B.onmousemove=A.bindEvent(this.boxMouseMove,this);B.onmouseout=A.bindEvent(this.boxMouseOut,this);B.onclick=A.bindEvent(this.boxClick,this);this.oPrevious=$("previousImage");this.oNext=$("nextImage");this.oPrevious.onclick=A.returnFalse;this.oNext.onclick=A.returnFalse;this.oActiveImage=B.firstChild;this.bInitialized=true},run:function(B,A){this.init();this.oCurrentView=B;pxp.showOverlay(true);this.sCurrentImage=this.oCurrentView.oActiveItem.sFilename.substr(1);this.loadImage()},loadImage:function(){var B=this.oCurrentView.oParent.oShare;if(B.iImageResize==0){var A="./preview.php?sShare="+B.sId+"&sAction=_openPreview&sPath="+encodeURIComponent(this.sCurrentImage)+"&iWidth="+Math.round(pxp.oParentNode.offsetWidth*0.75)+"&iHeight="+Math.round(pxp.oParentNode.offsetHeight*0.75)}else{var A=px.util.buildPath(B.sUrl,this.sCurrentImage)}$("loading").style.visibility="visible";this._oLoadingImage.onload=px.lang.Function.bind(this._onImageLoad,this);this._oLoadingImage.onerror=px.lang.Function.bind(this._onImageError,this);this._oLoadingImage.src=A},_onImageError:function(){pxp.hideOverlay()},_onImageLoad:function(){this._oLoadingImage.onload=null;if($("overlay").style.display=="none"){return false}this.resize();this.oActiveImage.src=this._oLoadingImage.src;this.oActiveImage.title=this.oCurrentView.oActiveItem.sFilename;$("loading").style.visibility="hidden";if(this.oLightbox.style.display!="block"){this.oLightbox.style.display="block"}if(navigator.appVersion.indexOf("MSIE")!=-1){px.util.sleep(200)}this.setArrows()},setArrows:function(){var B=this.oPrevious.offsetHeight;var A=this.oPrevious.offsetWidth;this.oPrevious.style.left="8px";this.oPrevious.style.top=this.oActiveImage.height/2-(B/2)+"px";this.oNext.style.left=this.oActiveImage.width+8-A+"px";this.oNext.style.top=this.oActiveImage.height/2-(B/2)+"px"},boxMouseOut:function(A){this.oPrevious.style.visibility="hidden";this.oNext.style.visibility="hidden"},boxMouseMove:function(F){var E=this.oLightbox;var C=E.offsetLeft;var D=E.offsetTop;var B=E.offsetWidth;var A=E.offsetHeight;this.oPrevious.style.visibility="hidden";this.oNext.style.visibility="hidden";this.setArrows();if(this._oLoadingImage.width>80&&this._oLoadingImage.height>60){if(F.clientY>D&&F.clientY<D+A){if(F.clientX>C&&F.clientX<C+(B/2)){this.oPrevious.style.visibility="visible"}if(F.clientX>C+(B/2)&&F.clientX<C+B){this.oNext.style.visibility="visible"}}}},boxClick:function(A){this.oLightbox.style.display="none";if(this.oNext.style.visibility=="hidden"){this._nextImage(true)}else{this._nextImage()}this.oPrevious.style.visibility="hidden";this.oNext.style.visibility="hidden";this.loadImage()},_nextImage:function(C){var B=this.oCurrentView;var A=B.oResults[B.oParameters.getPath()];var G;var F=false;var E=px.util.basename(this.sCurrentImage);var D=C?A.length-1:0;while(!G){if(px.util.previewCheck(A[D].sExtension)){if(F){G=px.util.buildPath(A[D].sRelDir,A[D].sName).substr(1);break}else{if(A[D].sName==E){F=true}}}D=C?D-1:D+1;if(D<0){D=A.length-1}if(D==A.length){D=0}}this.sCurrentImage=G},resize:function(){if(!this.bInitialized){return }var A=document.body.offsetWidth||window.innerWidth;var D=document.body.offsetHeight||window.innerHeight;var C=this._oLoadingImage.width;var B=this._oLoadingImage.height;if(this.oCurrentView.oParent.oShare.iImageResize==1){if(C>A||B>D){if(C>A){iNewWidth=A-60;B=B*(iNewWidth/C);C=iNewWidth}if(B>D){iNewHeight=D-60;C=C*(iNewHeight/B);B=iNewHeight}}}this.oActiveImage.width=C;this.oActiveImage.height=B;this.oLightbox.style.left=Math.round(A/2-C/2-5)+"px";this.oLightbox.style.top=Math.round(D/2-B/2-5)+"px"},dispose:function(){this.oCurrentView=null;delete this.oActiveImage;delete this._oLoadingImage;if(this.bInitialized){this.oLightbox.onmousemove=null;this.oLightbox.onmouseout=null;this.oLightbox.onclick=null;this.oPrevious.onclick=null;this.oNext.onclick=null;this.oPrevious=null;this.oNext=null;this.oLightbox=null}px.core.Object.dispose.call(this);pxp.log("dispose pxFiles_openPreview")}});px.Class.define("px.action.pxGlobal___openEditorview",{extend:px.Action,construct:function(A,F,E,D){this.base(arguments,A,F,E);this.oChild=new px.ui.Actionview(this);var C=this.oChild;C.iMenuType=pxConst.MENU_BUTTON;C.sClass="fileActionBar";if(D&&D._sCalledAction){var B=pxp.oActions[D._sCalledAction][2]}else{var B="edit"}C.sIcon=B+".png";C.addActions(Array(B),D);C.init(this.oDiv,D);this.oToolbar.addButton({sId:"close",sIcon:"close2.png",oOnClick:px.lang.Function.bindEvent(this.oParent.removeAction,this.oParent),bRight:true});this.oToolbar.addButton({sId:"maximize",sIcon:"maximize.png",oOnClick:px.lang.Function.bindEvent(this.switchSize,this),bRight:true});this.bChanged=false;this._aChanged=[]},destruct:function(){this._disposeFields("_aChanged")}});Object.extend(px.Proto,{switchSize:function(){var A=pxp.oShareview.oSelected;A.oSplitviewSelection.hideFirst();A.oSplitviewList.hideFirst();return false},rename:function(){this.oChild.oDefaultParameters.sPath=this.sId;for(var A in this.oChild.oActions){if(this.oChild.oActions[A].rename){this.oChild.oActions[A].rename(this.sId)}}},setChanged:function(B,A){if(A){if(!px.lang.Array.contains(this._aChanged,B)){this._aChanged.push(B)}}else{px.lang.Array.remove(this._aChanged,B)}this.bChanged=this._aChanged.length>0;this._updateTitle(this.oChild.oActions[B],A);this._updateTitle(this.oParent.oActions[this.sId],this.bChanged)},_updateTitle:function(E,D){var C=E.oParent;var B=C.oActionData[E.sId];var A=B.sTitle;if(D){if(A.indexOf("*")==-1){B.sTitle="*"+A}}else{if(B.sTitle.indexOf("*")==0){B.sTitle=B.sTitle.substr(1)}}C.updateMenu()},showChanged:function(){if(!px.lang.Array.contains(this._aChanged,this.oChild.oSelected.sId)){this.oChild.changeAction(this._aChanged[0])}}});px.Class.define("px.action.pxGlobal___openShareview",{extend:px.Action,construct:function(A,I,H,G){this.base(arguments,A,I,H);var F=px.lang.Function;this.bSearchInProgress=false;this.oShare=px.io.Request.get("sAction=openShare&sShare="+encodeURIComponent(this.sId));if(!this.oShare){return false}this.oActionviewSelection=new px.ui.Actionview(this);var E=this.oActionviewSelection;E.iMenuType=pxConst.MENU_TABS;E.sClass="selectionBar";E.sTitle=oTranslation["sAction"];this.oActionviewSelection.addActions(Array("select"),{sType:this.oShare.sBaseType,_sCalledAction:this.oShare.sDefaultSelection});this.oActionviewList=new px.ui.Actionview(this);var E=this.oActionviewList;E.iMenuType=pxConst.MENU_BUTTON;E.iIconSize=28;E.sClass="listBar";E.sTitle=oTranslation["sView"];E.bTitleOnly=true;E.sIcon="toolbar/pxMetaDirectories_openDetails.png";E.sDropDownIcon="dropDown.png";E.bToolbarFirst=true;E.bSyncParameter=true;E.iToolbarType=pxConst.TOOLBAR_VERTICAL;E.showContextMenu=px.action.pxGlobal___openShareview.showListContextMenu;E.callAction=px.action.pxGlobal___openShareview.callListActions;this.oActionviewList.addActions(Array("open","batch"),{sType:this.oShare.sBaseType,_sCalledAction:this.oShare.sDefaultView});this.oActionviewFiles=new px.ui.Actionview(this);var E=this.oActionviewFiles;E.iMenuType=pxConst.MENU_BUTTON;E.sClass="fileBar";E.sIcon="files.png";E.sLabelDrop="item";this.oSplitviewSelection=new px.ui.Splitview(true,this.oShare.sTreeviewWidth);this.oSplitviewSelection.sId="pxSplitSelection";this.oSplitviewSelection.oActionview=this.oActionviewSelection;this.oSplitviewList=new px.ui.Splitview(false,0.45);var D=this.oSplitviewList;D.sId="pxSplitList";this.oChild=this.oSplitviewSelection;this.oSplitviewSelection.oChild1=this.oActionviewSelection;this.oSplitviewSelection.oChild2=this.oSplitviewList;D.oChild1=this.oActionviewList;D.oChild2=this.oActionviewFiles;this.oChild.init(this.oDiv);if(!this.oShare.bSelectionView){this.oSplitviewSelection.hideFirst()}var C=px.action.pxGlobal___openShareview;this.oToolbar.addButton({sId:"search",sLabel:oTranslation["search"],iType:pxConst.TOOLBAR_BUTTON_INPUT,sIcon:"cancelSearch.png",oOnIconClick:F.bindEvent(C._iconClick,this),oOnClick:F.bindEvent(C._showSearchMenu,this),bDropDown:true,sClass:"pxTbSearch",oInputOnKeyUp:F.bindEvent(C._searchKeyUp,this),oInputOnFocus:F.bindEvent(C._searchFocus,this),oInputOnBlur:F.bindEvent(C._searchBlur,this)});if(this.oShare.sStartpage&&!this.oShare.bBookmark){var B=px.util.buildPath("/",this.oShare.sStartpage);this.oActionviewFiles.addAction(B,B.indexOf("/")==0?B.substr(1):B,px.action.pxGlobal___openEditorview,true,"types/pxHtml",{sPath:B,sType:"pxHtml",_sCalledAction:"pxFiles__openInline"});this.oActionviewFiles.showAction(B)}},destruct:function(){this._disposeFields("oActionviewSelection","oActionviewList","oActionviewFiles","oSplitviewSelection","oSplitviewList")}});Object.extend(px.Statics,{_iconClick:function(A){this.cancelSearch(true)},_searchKeyUp:function(A){if(this.oShare.bLiveSearch){this.updateSearch()}else{if(A.keyCode==13){this.updateSearch()}}},_searchFocus:function(A){var B=px.Event.element(A);if(B.value==oTranslation["search"]){B.value=""}this.startSearch(B.parentNode)},_searchBlur:function(B){var A=px.Event.element(B);if(A.value==""){this.cancelSearch()}},_showSearchMenu:function(A){return false},showListContextMenu:function(C){var B=px.lang.Array;pxp.setActiveControl(this);var G=px.ui.ContextMenu;G.clear();var A=false;for(var H in this.oActionData){if(this.aAllowedActions){if(!B.contains(this.aAllowedActions,H)){continue}}if(this.oActions[H]==this.oSelected){continue}var F=pxConst.sModuleUrl+"/"+pxp.oActions[H][0]+".pxm/graphics/toolbar/"+H+".png";G.addItem(H,"",F,false,"pxCMToolbar",oTranslation["action."+H]);A=true}if(A){G.addDivider()}G.addItem("refreshView",oTranslation["refreshView"],"./modules/System.pxm/graphics/refreshView.png");G.addDivider();var E=new Array("sName","iBytes","dModified","sType");for(var D=0;D<E.length;D++){G.addItem("sortBy_"+E[D],oTranslation["sortBy"]+" "+oTranslation["property."+E[D]],"./modules/System.pxm/graphics/sortBy.png")}G.show(C);return false},callListActions:function(C){if(C=="refreshView"){pxp.refreshView(this.oSelected.oChild.oParameters.sPath)}else{if(C.indexOf("sortBy_")>-1){var B=C.substr(C.indexOf("_")+1);var A=pxp.getListview();A.sort(B)}else{px.html.Element.changeImage(this.oLabel.firstChild,pxConst.sModuleUrl+"/"+pxp.oActions[C][0]+".pxm/graphics/toolbar/"+C+".png");this.changeAction(C)}}return false}});Object.extend(px.Proto,{dirUp:function(){this.oActionviewList.oSelected.oChild.dirUp()},updateSearch:function(){var A="";var D=this.oActionviewSelection.oActions.pxDirectories_selectTags;if(D&&D.bInitialized){A=D.getTagQuery()}if(this.bSearchInProgress){var C=px.util.trim(this.oToolbar.oButtons["search"].oInput.value);if(C!=""){if(C.indexOf(":")==-1){C="\""+C+"%\""}if(A!=""){A+=" and "}A+=C}}if(A==""){A=null}var B=this.oActionviewList.oSelected.oChild;if(B.oParameters.sSearchQuery!=A){B.oParameters.sSearchQuery=A;B.update()}},startSearch:function(A){if(!this.bSearchInProgress){this.bSearchInProgress=true;px.html.Element.addClassName(A,"pxTbSearchActive")}},cancelSearch:function(C){if(this.bSearchInProgress){var B=this.oToolbar;var D=B.oButtons["search"];var A=D.oA;D.oInput.value=oTranslation["search"];D.oInput.blur();this.bSearchInProgress=false;px.html.Element.removeClassName(A,"pxTbSearchActive");if(C==null||C==true){this.updateSearch()}}},refreshView:function(C){var B=this.oActionviewSelection.oActions.pxDirectories_selectTree;if(B){var A=B.oChild.getNode(C);if(A.bRendered){B.oChild.update({sPath:C})}}if(this.oActionviewList.oSelected.oChild.oParameters.sPath==C){this.oActionviewList.oSelected.oChild.update()}}});px.Class.define("px.action.pxGlobal___openXplorerview",{extend:px.Action,construct:function(A,E,D,C){this.base(arguments,A,E,D);this.oChild=new px.ui.xplorerview.Xplorerview(this);var B=this.oChild;B.oParameters.set(C);B.oParameters.sShare=this.oShare.sId;B.bSelection=false;B.onNodeClick=px.lang.Function.bind(this._onNodeClick,this);B.oObject={aEvents:[],aPermissions:[],aParameters:[]};B.init(this.oDiv,true)}});Object.extend(px.Proto,{_onNodeClick:function(E){var C=pxp.oShareview.oSelected.oActionviewFiles;var B="px:xplorerview";var A=E.sId;var D=A.indexOf(".");if(D>-1){A=A.substr(0,D)}if(!C.oActions[B]){C.addAction(B,"xplorer",px.action.pxGlobal___openEditorview,true,"types/pxType",{sShare:"kpw3",sPath:"/css.php",sType:"pxType",_sCalledAction:"pxObject_editProperties"})}C.showAction(B);C.oSelected.oChild.oSelected.show(A)}});px.Class.define("px.action.pxGlobal_openInfo");Object.extend(px.Statics,{bInitialized:false,oPanels:{},init:function(){if(this.bInitialized){return }this.oBox=$("infoBox");this.oBox.style.display="none";this.oTabview=new px.ui.tabview.Tabview(this,this.oBox,this.oBox.firstChild);var D=$("infoBox");for(var E=0,A=D.childNodes.length*2;E<A;E=E+2){var C=D.childNodes[E];this.oPanels[C.id]=C;this.oTabview.addTab(C.id,C.title)}this.oTabview.onTabClick=px.lang.Function.bind(this.tabClick,this);this.oTabview.setSelected("debugPane");if(pxp.bDebug){this.oDisposeButton=$("unloadButton");this.oDisposeButton.onclick=pxUnload;this.oPhpInfoButton=$("phpInfoButton");this.oPhpInfoButton.onclick=px.action.pxGlobal_openPhpInfo.run;var B=$("phpRuntime");B.appendChild(document.createTextNode(pxp.iPhpRuntime))}this.bInitialized=true},run:function(A){this.init();this.resize();this.oTabview.setSelected(A);pxp.showOverlay(true);this.oBox.style.display="block";return false},resize:function(){if(!this.bInitialized){return }var B=document.body.offsetWidth||window.innerWidth;var A=document.body.offsetHeight||window.innerHeight;var E=B>640?640:Math.round(B*0.75);var D=A>480?480:Math.round(A*0.75);this.oBox.style.width=E+"px";this.oBox.style.height=D+"px";this.oBox.style.left=B/2-E/2-5+"px";this.oBox.style.top=A/2-D/2-5+"px";var C=$("cachePane");if(C){$("cachePane").firstChild.style.height=D+"px"}},dispose:function(){if(this.bInitialized){this.oTabview.dispose();this.oBox.onclick=null;if(pxp.bDebug){this.oDisposeButton.onclick=null;this.oPhpInfoButton.onclick=null}px.core.Object.prototype._disposeFields.call(this,"oBox","oTabview","oPanels","oDisposeButton","oPhpInfoButton")}pxp.log("Dispose pxGlobal_openInfo")},tabClick:function(B){var A=this.oPanels[B];switch(B){case"cachePane":if(A.firstChild.src.indexOf("dummy")>-1){A.firstChild.src="./../build.php"}break}for(var C in this.oTabview.oTabs){this.oPanels[this.oTabview.oTabs[C].sId].style.display="none"}A.style.display="block"},build:function(){window.open("./../build.php",px.util.getRandomId(),"toolbar=no,location=yes,menubar=yes,resizable=yes,scrollbars=yes")}});px.Class.define("px.action.pxGlobal_openPhpInfo");Object.extend(px.Statics,{run:function(){window.open("./action.php?sShare=phpXplorer&sAction=openPhpInfo",px.util.getRandomId(),"toolbar=no,location=yes,menubar=yes,resizable=yes,scrollbars=yes")}});px.Class.define("px.action.pxDirectories_selectTags",{extend:px.Action,construct:function(A,D,B,C){this.base(arguments,A,D,B);this.sCurrentPath;this.oContainer;this.oTagList;this.bAndOperator=true;px.html.Element.addClassName(this.oDiv,"pxTagList");this.oTagList=document.createElement("ul");this.oTagList.className="checklist";this.oDiv.appendChild(this.oTagList);this.loadTags();this.oToolbar.addButton({sId:"clearTagSelection",sLabel:"",sIcon:"tagSettings.png",oOnClick:px.lang.Function.bindEvent(px.action.pxDirectories_selectTags.showMenu,this),sTitle:oTranslation["toolbar.settings"]});this.oToolbar.hideButton("previousType")},destruct:function(){this.clear(true);this._disposeFields("oTagList")}});Object.extend(px.Statics,{showMenu:function(A){pxp.setActiveControl(this);var B=px.ui.ContextMenu;B.clear();B.addItem("clearSelection",oTranslation["clearSelection"],"./modules/System.pxm/graphics/clearSelection.png");B.addDivider();B.addItem("andOperator",oTranslation["andOperator"],"./modules/System.pxm/graphics/"+(this.bAndOperator?"tick.png":"dummy16.png"));B.addItem("orOperator",oTranslation["orOperator"],"./modules/System.pxm/graphics/"+(!this.bAndOperator?"tick.png":"dummy16.png"));B.show(A);return false},itemMouseOver:function(B){var A=px.html.Element;if(pxp.bIe){A.addClassName(this,"hover")}if(pxp.bDragging&&pxp.sDragType=="item"){A.addClassName(this,"drop")}},itemMouseOut:function(B){var A=px.html.Element;if(pxp.bIe){A.removeClassName(this,"hover")}A.removeClassName(this,"drop")},itemMouseUp:function(B){if(px.html.Element.hasClassName(this,"drop")){for(var A in pxp.oSelectedControl.oSelected){var F=pxp.oSelectedControl.oSelected[A];var E=F.getShare();var C=F.sFilename;var D=this.childNodes[1].nodeValue;px.io.Request.post("sShare="+encodeURIComponent(E)+"&sAction=_editSwitchTag&sPath="+encodeURIComponent(C)+"&sTag="+D);pxp.getListview().update()}}}});Object.extend(px.Proto,{resize:function(){var A=px.html.Element;px.Action.prototype.resize.call(this);if(this.oParent.oParent.oSplitviewSelection.bVertical){}else{}},clear:function(C){if(this.oTagList){for(var A=this.oTagList.childNodes.length-1;A>-1;A--){var B=this.oTagList.childNodes[A];B.firstChild.firstChild.onclick=null;B.firstChild.onmouseover=null;B.firstChild.onmouseout=null;B.firstChild.onmouseup=null;if(!C){this.oTagList.removeChild(B)}}}},loadTags:function(){var J=px.lang.Function;var I=this.oParent.oParent;if(!I.oActionviewList.oSelected){return }var H=this.oShare.sId;var F=I.oActionviewList.oSelected.oChild.oParameters.sPath;if(this.sCurrentPath==F){return }this.sCurrentPath=F;this.clear();var D="tags."+H+"_"+F;if(!pxp.oData[D]){pxp.oData[D]=px.io.Request.get("sAction=_openDefaultTags&sShare="+encodeURIComponent(H)+"&sPath="+encodeURIComponent(F))}for(var K in pxp.oData[D]){var A=pxp.oData[D][K];A=oTranslation["tag."+A]||A;var B=document.createElement("li");B.title=A;if(this.oTagList.childNodes.length==0){this.oTagList.appendChild(B)}else{this.oTagList.insertBefore(B,this.oTagList.firstChild)}var C=document.createElement("label");C.htmlFor=H+"_tagLabel_"+K;B.appendChild(C);var G=px.action.pxDirectories_selectTags;C.onmouseover=J.bindEvent(G.itemMouseOver,C);C.onmouseout=J.bindEvent(G.itemMouseOut,C);C.onmouseup=J.bindEvent(G.itemMouseUp,C);var E=document.createElement("input");E.type="checkbox";E.id=H+"_tagLabel_"+K;E.name=H+"_tagLabel_"+K;E.value=A;C.appendChild(E);E.onclick=J.bindEvent(this._checkboxClick,this);C.appendChild(document.createTextNode(A))}},_checkboxClick:function(D){var C=px.html.Element;var B=px.Event.element(D);var A=B.parentNode;if(B.checked){C.addClassName(A,"active")}else{C.removeClassName(A,"active")}this.oParent.oParent.updateSearch()},getTagQuery:function(){var B=[];if(this.bInitialized){for(var C=0,A=this.oTagList.childNodes.length;C<A;C++){if(this.oTagList.childNodes[C].firstChild.firstChild.checked){B.push("aTags:\""+this.oTagList.childNodes[C].firstChild.firstChild.value+"\"")}}}return B.join(this.bAndOperator?" and ":" or ")},clearTagSelection:function(C){if(this.bInitialized){for(var B=0,A=this.oTagList.childNodes.length;B<A;B++){px.html.Element.removeClassName(this.oTagList.childNodes[B].firstChild,"active");this.oTagList.childNodes[B].firstChild.firstChild.checked=false}if(C==null||C==true){this.oParent.oParent.updateSearch()}}},callAction:function(A){switch(A){case"clearSelection":this.clearTagSelection();break;case"andOperator":this.bAndOperator=true;this.oParent.oParent.updateSearch();break;case"orOperator":this.bAndOperator=false;this.oParent.oParent.updateSearch();break}}});px.Class.define("px.action.pxGlobal_openCreate");Object.extend(px.Statics,{run:function(F,D){var B=F+"__editCreate";if(px.action[B]&&px.action[B].run){px.action[B].run();return }var H=pxp.oTypes[F];if(!D){var D="";if(F!="pxData"){D=(H.bDirectory?oTranslation["newDirectory"]:oTranslation["newFile"])+" "+pxp.iNewFileCount++}D=pxp.addValidExtension(D,F)}var G=pxp.getListview();var E=G.oParameters.sPath;var C=px.util.buildPath(E,D);var A=pxp.oShareview.oSelected.oActionviewFiles;if(!A.oActions[C]){A.addAction(C,C.indexOf("/")==0?C.substr(1):C,px.action.pxGlobal___openEditorview,true,"types/"+F,{sPath:C,sType:F,_bNew:true,sNewName:D})}A.showAction(C)},showMenu:function(C){pxp.setActiveControl(px.action.pxGlobal_openCreate);var D=this.oParent.oParent.sId;var B=this.oChild.oParameters.sPath;var A=px.io.Request.get("sAction=openCreate&sShare="+encodeURIComponent(D)+"&sPath="+encodeURIComponent(B));var H=px.ui.ContextMenu;H.clear();for(var E=0;E<A.length;E++){var G=pxp.oTypes[A[E]];var F=pxp.getExtendedType(G.sId);H.addItem(G.sId,oTranslation["type."+F],"./modules/"+G.sModule+".pxm/graphics/types/"+F+".png")}H.show(C);return false},callAction:function(A){this.run(A)}});px.Class.define("px.action.pxGlobal_openHome",{extend:px.Action,construct:function(A,B,H,G){this.base(arguments,A,B,H);px.html.Element.addClassName(this.oDiv,"pxHomepage");var F=this.addBorder();var E=pxp.oData.oProfile.sFullName;if(!E){E=pxp.oData["sUser"]}else{E=pxp.translateTitle(E)}var D=pxp.oData.sLogoUrl;if(D!=""){var C=new Image();C.src=D;C.id="logo";F.appendChild(C)}F.appendChild(document.createTextNode(oTranslation["welcome"]+" "+E+","));F.appendChild(document.createElement("br"));F.appendChild(document.createTextNode(oTranslation["home.introduction"]));if(pxp.sUser!="everyone"){this._oToolbar=new px.ui.toolbar.Toolbar(this,F);this._oToolbar.addButton({sId:"editProfile",sLabel:oTranslation["editProfile"],oOnClick:px.lang.Function.bind(px.action.pxGlobal_openHome._editProfile,this)});this._oToolbar.addButton({sId:"changePassword",sLabel:oTranslation["changePassword"],oOnClick:px.lang.Function.bind(px.action.pxGlobal_openHome._editPassword,this)})}F.appendChild(document.createTextNode(oTranslation["home.shares"]));this._oToolbarShares=new px.ui.toolbar.Toolbar(this,F,"SharesList");for(var I in pxp.oData.aBookmarks){this._oToolbarShares.addButton({sId:I,sLabel:oTranslation["share."+I]||pxp.oData.aBookmarks[I]||I,oOnClick:px.lang.Function.bind(pxp.oShareview.showAction,pxp.oShareview,I)})}},destruct:function(){this._disposeObjects("_oToolbar","_oToolbarShares")}});Object.extend(px.Statics,{_editProfile:function(){var A="profiles/"+pxp.oData.sUser+".pxProfile";var B=pxp.oShareview.oSelected.oActionviewFiles;B.addAction("px:editProfile",A,px.action.pxGlobal___openEditorview,true,"types/pxProfile",{sShare:"phpXplorer",sPath:A,sType:"pxProfile"});B.showAction("px:editProfile");return false},_editPassword:function(){var B=pxp.oData.sUser;var A=pxp.oShareview.oSelected.oActionviewFiles;A.addAction("px:editPassword",B,px.action.pxGlobal___openEditorview,true,"types/pxVfsAuthenticationUser",{sShare:"Authentication",sPath:B,sType:"pxVfsAuthenticationUser"});A.showAction("px:editPassword");return false}});px.Class.define("px.action.pxObject___edit",{extend:px.Action,construct:function(B,E,D,C){this.base(arguments,B,E,D);var A=px.lang.Function;this.oToolbar.addButton({sId:"__docLink",sLabel:oTranslation["toolbar.documentation"],sIcon:"helpLight.png",oOnClick:A.bind(this.openDocs,this),bRight:true});this.oToolbar.addButton({sId:"save",sLabel:oTranslation["toolbar.save"],sIcon:"disk.png",oOnClick:A.bind(this.save,this),bRight:true})}});Object.extend(px.Statics,{checkSelection:function(E){if(E instanceof px.ui.treeview.Treeview){var D;var C=true;for(var B in E.oSelected){var A=E.getNode(B);if(D&&D!=A.getDirname()){C=false;break}D=A.getDirname()}if(!C){alert(oTranslation["allInSameDir"]);return false}}return true},runSelectionAction:function(I){var H=pxp.oSelectedControl;var G=pxp.oShareview.oSelected.oShare.sId;if(!px.action.pxObject___edit.checkSelection(H)){return false}var F=pxp.getListview();var E=false;var D=[];for(var C in H.oSelected){if(H.oSelected[C].getType()!="pxVirtualDirectory"){if(C==F.oParameters.sPath){E=true}D.push(px.util.basename(C));if(!B){var B=px.util.dirname(C)}}}if(E){F.oParameters.sPath="/";F.update()}I=I.replace(/{@share}/g,encodeURIComponent(G));I=I.replace(/{@dirname}/g,encodeURIComponent(B));var A=px.io.Request.post("sShare="+encodeURIComponent(G)+"&sPath="+encodeURIComponent(B)+"&aNames="+encodeURIComponent(D.join("|"))+"&"+I);if(A.bOk){pxp.refreshView(B)}}});Object.extend(px.Proto,{openDocs:function(){if(this.oChild.oObject.sType){pxp.showDoc("type/"+this.oChild.oObject.sType)}else{pxp.showDoc("action/"+this.oParent.oSelected.sId)}}});px.Class.define("px.action.pxObject_editDelete");Object.extend(px.Statics,{run:function(A){if(confirm(oTranslation["reallyDelete"])){px.action.pxObject___edit.runSelectionAction("sAction=_editDeleteSelection")}}});px.Class.define("px.action.pxObject_editProperties",{extend:px.action.pxObject___edit,construct:function(A,E,D,C){this.base(arguments,A,E,D,C);this.oToolbar.addButton({sId:"metaData",sTitle:oTranslation["toolbar.loadFileMetaData"],sIcon:"loadFileMetaData.png",oOnClick:px.lang.Function.bind(this.loadMetaData,this)});this.oChild=new px.ui.Propertyview(this,this.oDiv);var B=this.oChild.oParameters;B.set(C);if(!B.sShare){B.sShare=this.oShare.sId}B._sOptionCacheKey="options."+B.sShare+"_"+px.util.dirname(B.sPath)+"_"+B.sType;B.bFillOptions=!pxp.oData[B._sOptionCacheKey];if(B._bNew){this.oChild.update({sAction:"_openNew"})}else{this.oChild.update({sAction:"_openJson"})}}});Object.extend(px.Proto,{loadMetaData:function(){this.oChild.oParameters.bReloadFileMetaData=true;this.oChild.update();return false}});px.Class.define("px.action.pxObject_editRename");Object.extend(px.Statics,{run:function(G){var E=px.lang.Function;var F;if(!G){return false}G.setAllowSelection(true);px.ui.ContextMenu.hide();for(var D in G.oSelected){var C=G.oSelected[D];var B=C.oNameNode;if(B.style.display=="none"){continue}B.style.display="none";var A=document.createElement("input");A.setAttribute("autocomplete","off");if(B.nextSibling){B.parentNode.insertBefore(A,B.nextSibling)}else{B.parentNode.appendChild(A)}A.value=B.firstChild.nodeValue;A.onblur=E.bindEvent(this.exitControl,this);A.onclick=E.cancelEvent;A.onmousedown=E.cancelEvent;A.onkeydown=E.bindEvent(this.controlKeyDown,A);A.onkeyup=E.bindEvent(this.controlKeyUp,A);A.oView=G;A.oItem=C;A.focus();A.select();break}},controlKeyDown:function(A){if(A.keyCode){if(pxp.bAltDown&&A.keyCode==219){return false}if(pxp.bShiftDown&&A.keyCode==55){return false}if(pxp.bShiftDown&&A.keyCode==61){return false}if(pxp.bShiftDown&&A.keyCode==190){return false}if(pxp.bShiftDown&&A.keyCode==187){return false}if(pxp.bShiftDown&&A.keyCode==219){return false}if(A.keyCode==226){return false}}},controlKeyUp:function(A){if(A.keyCode){if(A.keyCode==27){px.action.pxObject_editRename.hideControl(this)}else{if(A.keyCode==13){this.onblur=null;px.action.pxObject_editRename.exitControl(A)}}}},hideControl:function(A){A.oView.setAllowSelection(false);A.onblur=null;A.onclick=null;A.onmousedown=null;A.onkeydown=null;A.onkeyup=null;A.oView=null;A.oItem=null;A.previousSibling.style.display="inline";A.parentNode.removeChild(A)},exitControl:function(H){document.onmousemove=null;var F=px.Event.element(H);var C=F.previousSibling;var B=F.oView;if(C.firstChild.nodeValue!=F.value){if(!px.action.pxObject_editRename.checkFilename(F)){alert(oTranslation["error.invalidFilename"]);px.action.pxObject_editRename.hideControl(F);return false}var A=F.oItem;var K=A.oParent.oParameters.sShare;var J=A.getDirname();var I=A.getFilename();var G=F.value;var E=px.io.Request.post("sAction=_editClipboard&sShare="+encodeURIComponent(K)+"&sPath="+encodeURIComponent(J)+"&aNames="+encodeURIComponent(I)+"&aNewNames="+encodeURIComponent(G)+"&sDestinationPath="+encodeURIComponent(J)+"&sDestinationShare="+encodeURIComponent(K)+"&sMode=move",true,null,false);if(E.bOk){var D=px.util.buildPath(J,G);B.oParent.oParent.oParent.oActionviewFiles.renameAction(A.sFilename,D,D.substr(1));C.firstChild.nodeValue=G;pxp.refreshView(J)}else{pxp.showError(E)}}px.action.pxObject_editRename.hideControl(F)},checkFilename:function(A){return px.util.checkFilename(A.value)&&px.util.trim(A.value)!=""}});px.Class.define("px.action.pxObject_editClipboard");Object.extend(px.Statics,{aDropTypes:Array("item"),run:function(C){var B=pxp.oSelectedControl;if(!px.action.pxObject___edit.checkSelection(B)){return false}pxp.aClipboard.length=0;pxp.oClipboardSourceShare=C.oParent.oShare;for(var A in B.oSelected){if(B.oSelected[A].getType()!="pxVirtualDirectory"){pxp.aClipboard.push(A)}}this.switchClipboardState(true)},switchClipboardState:function(B){for(var F in pxp.oShareview.oActions){var E=pxp.oShareview.oActions[F];if(E.bInitialized){for(var D in E.oActionviewList.oActions){var C=E.oActionviewList.oActions[D];if(C.bInitialized){var A=C.oToolbar.oButtons["clipboard"];if(B){A.showDropDown();A.changeImage(pxConst.sGraphicUrl+"/toolbar/clipboardOn.png")}else{A.hideDropDown();A.changeImage(pxConst.sGraphicUrl+"/toolbar/clipboard.png")}}}}}},clear:function(){pxp.aClipboard.length=0;this.switchClipboardState(false)},showMenu:function(H){pxp.oSelectedControl=px.action.pxObject_editClipboard;if(pxp.aClipboard.length>0){var G=px.ui.ContextMenu;G.clear();var E=pxp.oClipboardSourceShare.sTitle||pxp.oClipboardSourceShare.sId;var F=G.addItem("__copy",E,pxConst.sGraphicUrl+"/pxShareLoaded.png",true);F.style.color="#999";var D;for(var A=0;A<pxp.aClipboard.length;A++){if(!D){D=px.util.dirname(pxp.aClipboard[A])}G.addItem(pxp.aClipboard[A],pxp.aClipboard[A].substr(1),pxConst.sGraphicUrl+"/dummy16.png",true)}G.addDivider();G.addItem("__copy","Kopieren",pxConst.sGraphicUrl+"/copy.png");var C=pxp.getListview().oParameters;var B=px.util.buildPath(pxp.oClipboardSourceShare.sId+":",D);if(B!=C.getPath()){G.addItem("__move","Verschieben",pxConst.sGraphicUrl+"/move.png")}G.addDivider();G.addItem("__clear","Leeren",pxConst.sGraphicUrl+"/close.png");G.show(H)}return false},callAction:function(A){switch(A){case"__copy":this.runAction("copy");break;case"__move":this.runAction("move");break;case"__clear":this.clear();break}},itemDrop:function(A){this.run(A.oParent);this.runAction("move",A.getShare(),A.sFilename)},runAction:function(F,E,B){var J=pxp.getListview();if(!E){var I=J.oParameters;var E=I.sShare;var B=I.sPath}var H=false;var G=[];for(var K=0;K<pxp.aClipboard.length;K++){if(pxp.aClipboard[K]==J.oParameters.sPath&&F=="move"){H=true}G.push(px.util.basename(pxp.aClipboard[K]));if(!D){var D=pxp.oClipboardSourceShare.sId;var C=px.util.dirname(pxp.aClipboard[K])}}if(H){J.oParameters.sPath="/";J.update()}var A=px.io.Request.post("sAction=_editClipboard&sShare="+encodeURIComponent(D)+"&sPath="+encodeURIComponent(C)+"&aNames="+encodeURIComponent(G.join("|"))+"&sDestinationPath="+encodeURIComponent(B)+"&sDestinationShare="+encodeURIComponent(E)+"&sMode="+F);if(A.bOk){pxp.oShareview.oSelected.refreshView(C);pxp.oShareview.oSelected.refreshView(B);if(F=="move"){this.clear()}}}});px.Class.define("px.action.pxPhp_openSource");Object.extend(px.Statics,{run:function(A){px.action.pxMetaFiles_openView.run(A,"openSource")}});px.Class.define("px.action.pxTextFiles_edit",{extend:px.action.pxObject___edit,construct:function(A,D,C,B){this.base(arguments,A,D,C,B);this.oChild=new px.ui.Textview(this,this.oDiv);this.oChild.oParameters.sShare=this.oShare.sId;this.oChild.oParameters.set(B);if(!B._bNew){px.html.Form.disable(this.oChild.oForm);this.oChild.update({sAction:"_open"})}else{this.oChild.oTextarea.focus()}}});px.Class.define("px.action.pxSetting_edit",{extend:px.action.pxObject___edit,construct:function(C,B,A,D){this.base(arguments,C,B,A,D);this.oXplorerview=new px.ui.xplorerview.Xplorerview(this);this.oXplorerview.oParameters.set(D);this.oXplorerview.oParameters.sShare=this.oShare.sId;this.oXplorerview.onNodeClick=px.lang.Function.bind(this._onNodeClick,this);this.oXplorerviewPropertyview=new px.ui.xplorerview.Propertyview(this);this.oSplitview=new px.ui.Splitview(true,0.4);this.oChild=this.oSplitview;this.oChild2=this.oXplorerview;this.oChild.oChild1=this.oXplorerview;this.oChild.oChild2=this.oXplorerviewPropertyview;this.oChild.bSnap=false;this.oChild.init(this.oDiv)},destruct:function(){this._disposeFields("oSplitview","oXplorerview","oXplorerviewPropertyview","oChild2")}});Object.extend(px.Proto,{_onNodeClick:function(D){var C=D.oParent;var B=C.oParent.oXplorerviewPropertyview;var A=C.oObject.aEvents[D.sId];B.oEvent.value=A||""}});px.Class.define("px.action.pxShare_editUpdateIndex");Object.extend(px.Statics,{run:function(C){var D=[];for(var B in C.oSelected){var A=C.oSelected[B];D.push(A.sFilename.replace("/shares/",""))}if(confirm("Do you really want to index '"+D.join(",")+"'?")){px.action.pxMetaFiles_openView.run(C,"editUpdateIndex")}}});px.Class.define("px.action.pxShare_editBuildIndex");Object.extend(px.Statics,{run:function(D){var C=[];for(var B in D.oSelected){var A=D.oSelected[B];C.push(A.sFilename.replace("/shares/",""))}if(confirm("Do you really want to index '"+C.join(",")+"'?")){px.action.pxMetaFiles_openView.run(D,"editBuildIndex")}}});px.Class.define("px.action.pxMetaDirectories_batchShares",{extend:px.action.pxDirectories___open,construct:function(A,C,B,F){this.base(arguments,A,C,B,F,px.ui.listview.Listview);var E=this.oChild;var D=E.oParameters;D.sShare=this.oShare.sId;D.bFull=true;D.bFillOptions=true;D.bRecursiveFlat=true;D.aTypes=Array("pxUser");E.addColumn("sName",250,"link","left");E.addColumn("sRelDir",200,"text","left");E.addColumn("aRoles",200,"multiple","left");E.update()}});px.Class.define("px.action.pxDirectories__editShare");Object.extend(px.Statics,{run:function(){var C=pxp.getListview();var B=C.oParameters.sPath;var A=px.util.basename(B);if(A!=".phpXplorer"&&A.indexOf(".pxShare")==-1){px.action.pxDirectory__editCreate.run("pxData",".phpXplorer",false,false);C.oParameters.sPath=px.util.buildPath(B,".phpXplorer");C.update()}px.action.pxGlobal_openCreate.run("pxUser");return false}});px.Class.define("px.action.pxDirectory__editCreate");Object.extend(px.Statics,{run:function(I,H,G,F){if(!I){var I="pxDirectory"}var E=pxp.getListview();var C=E.oParameters.sShare;var D=E.oParameters.sPath;if(!H||G){var H=px.util.getNewFilename(H,"pxDirectory",true);if(H==null){return false}}var B=px.util.buildPath(D,H);var A=px.io.Request.exists(C,B);if(A.bOk){if(!F&&F!=false){alert(oTranslation["error.objectExists"]);px.action.pxDirectory__editCreate.run(I,H,true)}return false}var A=px.io.Request.post("sShare="+encodeURIComponent(C)+"&sAction=_editCreate&sPath="+encodeURIComponent(B)+"&sType="+encodeURIComponent(I));if(A.bOk){pxp.refreshView(D)}return false}});px.Class.define("px.action.pxObject_editCopy");Object.extend(px.Statics,{run:function(A){px.action.pxObject___edit.runSelectionAction("sAction=_editClipboard&sDestinationShare={@share}&sDestinationPath={@dirname}&sMode=copy")}});px.Class.define("px.action.pxDirectories_uploadHtml");Object.extend(px.Statics,{sInputId:"file_input",run:function(A){px.action.pxDirectories___upload.run(A);return false},changeMethod:function(A){location.href="./action.php?"+A.options[A.selectedIndex].value},addFileInput:function(){var C=$("file_attach");var B=document.createElement("input");B.setAttribute("type","file");B.setAttribute("name","aFiles[]");B.setAttribute("class","upload");B.className="upload";B.onchange=function(){px.action.pxDirectories_uploadHtml.attachFile(this)};var A=Math.random();var A=A*10;B.setAttribute("id","file_"+A);this.sInputId="file_"+A;$("submitButton").disabled=false;return C.appendChild(B)},hideInput:function(){var A=document.getElementById(this.sInputId);if(A.value!=""){A.style.display="none";this.addFileToList();return true}else{return false}},addFileToList:function(){var D=$(this.sInputId);var C=$("aFileSelection");var B=document.createElement("option");var A=document.createTextNode(D.value);B.appendChild(A);C.appendChild(B)},fileExists:function(B){var A=document.forms[0].aFileSelection.options;for(var C=0;C<A.length;C++){if(A[C].text==B){return true}}return false},removeSelectedFile:function(){var D=document.forms[0].aFileSelection.options;if(D.selectedIndex>-1){for(var A=D.length-1;A>-1;A--){if(D[A].selected){var B=$("file_attach");for(var C=0;C<B.childNodes.length;C++){if(B.childNodes[C].value==D[A].text){B.removeChild(B.childNodes[C]);break}}D[A]=null}}}$("submitButton").disabled=!(D.length>0)},attachFile:function(A){if(!this.fileExists(A.value)){if(this.hideInput()){var B=this.addFileInput();B.focus()}}},validate:function(){if(document.forms[0].aFileSelection.options.length==0){pxp_alert(getTranslation("validFilename"));return false}return true},dispose:function(){var C=$("file_attach");if(C){for(var B=0,A=C.childNodes.length;B<A;B++){C.childNodes[B].onchange=null}}}});var iDragOffset=0;var oActiveItem;function $(A){return document.getElementById(A)}function pxInit(){pxp.init($("main"))}function pxUnload(){delete oActiveItem;pxp.oSelectedControl=null;px.ui.ContextMenu.dispose();var D=px.action;for(var A in D){if(D[A].dispose){D[A].dispose()}}var C=$("overlay");if(C){C.onclick=null}if(pxp.bIe){for(var B=0;B<document.images.length;B++){if(document.images[B].style.filter){document.images[B].style.filter=pxConst.EMPTY}}if(C&&C.style.filter){C.style.filter=pxConst.EMPTY}}pxp.dispose();delete pxp;delete px}px.Event.addListener(window,"load",pxInit);px.Event.addListener(window,"unload",pxUnload);px.Event.addListener(window,"unload",px.Event.unloadCache);px.Class.define("px.action.pxDirectories_selectFacets",{extend:px.Action,construct:function(D,C,B,A){this.base(arguments,D,C,B);this.oChild=new px.ui.facetview.Facetview(this,this.oDiv);var E=this.oChild;E.oParameters.sShare=this.oShare.sId;E.update()},destruct:function(){}});Object.extend(px.Statics,{});Object.extend(px.Proto,{});px.Class.define("px.action.pxFacet_editAssignTags");Object.extend(px.Statics,{run:function(D){var C=[];for(var B in D.oSelected){var A=D.oSelected[B];C.push(A.sFilename.replace("/shares/",""))}if(confirm("Do you really want to assign tags to '"+C.join(",")+"'?")){px.action.pxMetaFiles_openView.run(D,"editAssignTags")}}});px.Class.define("px.ui.facetview.Facetview",{extend:px.core.Object,construct:function(B,A){this.oFacets={};this.oParent=B;this.oParentNode=A;this.iFacetHeight=200;this.oParameters=new px.io.RequestParameters();this.oDiv=document.createElement("div");this.oDiv.className="pxFacetview";A.appendChild(this.oDiv)},destruct:function(){}});Object.extend(px.Proto,{update:function(){var A=px.io.Request.get("sAction=_openFacets&sShare="+encodeURIComponent(this.oParameters.sShare)+"&sPath="+encodeURIComponent("/"));for(var B=0;B<A.length;B++){var C=A[B];this.oFacets[C.sId]=new px.ui.facetview.Facet(this,C)}},resize:function(B){for(var A in this.oFacets){this.oFacets[A].resize(B)}}});px.Class.define("px.ui.facetview.Facet",{extend:px.core.Object,construct:function(E,D){var C=px.lang.Function;this.oParent=E;this.oParentNode=E.oDiv;this._iHeight;this._bHidden;this.oDiv=document.createElement("div");this.oDiv.className="pxFacet";this.oParentNode.appendChild(this.oDiv);this._oMenu=document.createElement("div");this._oMenu.className="pxBar facetBarMenu";this.oDiv.appendChild(this._oMenu);this._oToolbar=new px.ui.toolbar.Toolbar(this,this._oMenu);var B=px.util.basename(D.sDriver);B=B.substr(0,B.indexOf("."));this._oToolbar.addButton({sId:"title",sLabel:oTranslation["facet."+B],sIcon:"collapseDark.png",oOnClick:C.bindEvent(this.switchVisibility,this)});this._oToolbar.addButton({sId:"add",sIcon:"add.png"});this._oBody=document.createElement("div");this._oBody.className="pxAction facetBar";this._oBody.style.height=this.oParent.iFacetHeight+"px";this.oDiv.appendChild(this._oBody);this._oDrag=document.createElement("div");this._oDrag.className="resize";this.oDiv.appendChild(this._oDrag);this._oDrag.onmousedown=C.bindEvent(this._startDrag,this);this._oListview=new px.ui.listview.Listview(this,this._oBody);var A=this._oListview;A.oParameters.sShare="fontXplorer";A.oParameters.sPath="/";A.bChecklist=true;A.bHideExtension=true;A.addColumn("sName",180,"link","left");A.update()},destruct:function(){}});Object.extend(px.Statics,{resize:function(C){var C=C||window.event;C.cancelBubble=true;var A=pxp.oSelectedControl;var B=C.clientY-iDragOffset;if(B<=0){B=0}A.setHeight(B)}});Object.extend(px.Proto,{resize:function(A){if(!this._bHidden){this._oListview.resize(A)}},setHeight:function(A){this._oBody.style.height=A+"px";this._iHeight=A},switchVisibility:function(){var A=this._oBody.style.display=="none";this._bHidden=!A;this._oBody.style.display=A?"":"none";if(A&&!pxp.bDragging&&this._iHeight<40){this.setHeight(160);this.resize(true)}this._oToolbar.oButtons["title"].oA.firstChild.src=pxConst.sGraphicUrl+"/"+(A?"collapse":"expand")+"Dark.png";return false},dragCleanup:function(A){this._oDrag.className="resize";this._oListview.resize(true);if(this._iHeight<50){this.setHeight(0);this.switchVisibility()}},_startDrag:function(B){var A=px.html.Element;pxp.startDrag("resize");if(this._oBody.style.display=="none"){this.setHeight(0);this.switchVisibility()}pxp.setActiveControl(this);this._oDrag.className="resize drag";iDragOffset=B.clientY-A.getTopOffset(this._oDrag)+A.getTopOffset(pxp.oSelectedControl._oBody);document.onmousemove=px.ui.facetview.Facet.resize}});px.Class.define("px.action.pxDirectories_uploadPostlet");Object.extend(px.Statics,{run:function(A){px.action.pxDirectories___upload.run(A,"uploadPostlet")},postletFinished:function(){opener.pxp.oShareview.oSelected.refreshView(pxp.sRelPathIn)}});px.Class.define("px.action.pxMetaDirectories_openPreviewFonts",{extend:px.action.pxDirectories___open,construct:function(A,E,D,C){this.base(arguments,A,E,D,C,px.ui.gallery.Galleryview);var B=this.oChild;B.aAdditionalExtensions=["ttf","otf","pfm"];B.bFloat=false;B.iPadding=2;B.iThumbnailSize=32;B.bDirectUpdate=true;B.oPreviewParameter.sText="phpXplorer PHPXPLORER";B.oParameters.sShare=this.oShare.sId;B.update()}})